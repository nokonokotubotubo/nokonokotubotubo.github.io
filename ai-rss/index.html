<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🤖 AI RSS ダッシュボード</title>
    
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
          --primary-light: #E0F7FF;
          --primary-accent: #5BA8C4;
          --background-gradient: linear-gradient(135deg, #E0F7FF 0%, #F0FBFF 100%);
          --card-shadow: 0 4px 20px rgba(91, 168, 196, 0.12);
          --text-primary: #2C3E50;
          --text-secondary: #5A6C7D;
          --text-light: #8FA0B3;
          --border-color: #E8F4F8;
          --interested-color: #10B981;
          --neutral-color: #F59E0B;
          --not-interested-color: #EF4444;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
          font-family: 'Noto Sans JP', sans-serif;
          background: var(--background-gradient);
          color: var(--text-primary);
          line-height: 1.7;
          min-height: 100vh;
        }

        .loading {
          text-align: center;
          padding: 4rem;
          font-size: 1.5rem;
          color: var(--primary-accent);
        }

        .header {
          background: linear-gradient(135deg, #87CEEB 0%, var(--primary-accent) 100%);
          padding: 2rem;
          text-align: center;
          margin-bottom: 3rem;
        }

        .header h1 {
          color: #fff;
          font-size: 3.5rem;
          font-weight: 900;
          margin-bottom: 1rem;
        }

        .header p {
          color: rgba(255, 255, 255, 0.95);
          font-size: 1.3rem;
          margin-bottom: 1rem;
        }

        .header-stats {
          display: flex;
          justify-content: center;
          gap: 2rem;
          color: rgba(255, 255, 255, 0.8);
          font-size: 0.9rem;
        }

        .stats-section {
          max-width: 1200px;
          margin: 0 auto 3rem;
          padding: 0 2rem;
        }

        .stats-tabs {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 1.5rem;
        }

        .stat-tab-card {
          background: linear-gradient(135deg, #fff 0%, #F8FDFF 100%);
          border: 2px solid var(--border-color);
          border-radius: 20px;
          padding: 2rem;
          text-align: center;
          box-shadow: var(--card-shadow);
          transition: all 0.4s ease;
          cursor: pointer;
        }

        .stat-tab-card.active {
          background: linear-gradient(135deg, var(--primary-accent) 0%, #87CEEB 100%);
          color: #fff;
        }

        .stat-number { font-size: 3rem; font-weight: 900; margin-bottom: 0.5rem; }
        .stat-label { font-size: 1rem; font-weight: 600; }

        .articles-container {
          max-width: 1200px;
          margin: 0 auto;
          padding: 0 2rem;
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
          gap: 2rem;
        }

        .article-card {
          background: linear-gradient(135deg, #fff 0%, #F8FDFF 100%);
          border: 2px solid var(--border-color);
          border-radius: 24px;
          overflow: hidden;
          transition: all 0.4s ease;
          box-shadow: var(--card-shadow);
        }

        .article-card:hover { transform: translateY(-8px) scale(1.02); }

        .article-content { padding: 2.5rem; }

        .article-title {
          font-size: 1.4rem;
          font-weight: 700;
          color: var(--text-primary);
          margin-bottom: 1rem;
          cursor: pointer;
          transition: color 0.3s ease;
        }

        .article-title:hover { color: var(--primary-accent); }

        .article-meta {
          display: flex;
          align-items: center;
          gap: 1rem;
          margin-bottom: 1.5rem;
          flex-wrap: wrap;
        }

        .preference-badge {
          padding: 0.5rem 1rem;
          border-radius: 20px;
          font-size: 0.8rem;
          font-weight: 700;
          color: #fff;
        }

        .badge-interested { background: var(--interested-color); }
        .badge-neutral { background: var(--neutral-color); }
        .badge-not-interested { background: var(--not-interested-color); }

        .article-info {
          font-size: 0.9rem;
          color: var(--text-light);
          font-weight: 500;
        }

        .article-description {
          color: var(--text-secondary);
          font-size: 1rem;
          line-height: 1.8;
          margin-bottom: 2rem;
        }

        .rating-section {
          display: flex;
          align-items: center;
          padding-top: 1.5rem;
          border-top: 2px solid var(--border-color);
        }

        .rating-stars { display: flex; gap: 0.5rem; }

        .star {
          cursor: pointer;
          font-size: 1.8rem;
          color: #E5E7EB;
          transition: all 0.3s ease;
          user-select: none;
        }

        .star.filled { color: #FBBF24; transform: scale(1.1); }
        .star:hover { color: #FBBF24; transform: scale(1.2); }

        @media (max-width: 768px) {
          .stats-tabs { grid-template-columns: repeat(2, 1fr); }
          .articles-container { grid-template-columns: 1fr; padding: 0 1rem; }
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        🤖 最新のAI分析ニュースを読み込み中...
    </div>
    
    <div id="dashboard-container" style="display: none;"></div>

    <script>
        async function loadLatestData() {
            try {
                const cacheBuster = Date.now();
                const response = await fetch(`./data/articles.json?v=${cacheBuster}`, {
                    headers: { 'Cache-Control': 'no-cache' }
                });
                
                const data = await response.json();
                console.log('✅ データ読み込み完了:', data.articles.length + '件');
                
                renderDashboard(data);
                
            } catch (error) {
                console.error('❌ データ読み込み失敗:', error);
                document.getElementById('loading').innerHTML = '⚠️ データの読み込みに失敗しました';
            }
        }
        
        function renderDashboard(data) {
            const articles = data.articles;
            const updateTime = new Date(data.timestamp).toLocaleString('ja-JP');
            
            const articlesByPreference = {
                interested: articles.filter(a => a.preference === 'interested'),
                neutral: articles.filter(a => a.preference === 'neutral'),
                'not-interested': articles.filter(a => a.preference === 'not-interested')
            };
            
            const html = `
            <header class="header">
                <h1>🤖 AI RSS ダッシュボード</h1>
                <p>AIが厳選したあなた好みのニュースをお届け</p>
                <div class="header-stats">
                    <span>最終更新: ${updateTime}</span>
                    <span>総記事数: ${articles.length}件</span>
                    <span>🔄 データ自動更新</span>
                </div>
            </header>

            <div class="stats-section">
                <div class="stats-tabs">
                    <div class="stat-tab-card interested">
                        <div class="stat-number">${articlesByPreference.interested.length}</div>
                        <div class="stat-label">😍 興味ありそう</div>
                    </div>
                    <div class="stat-tab-card neutral">
                        <div class="stat-number">${articlesByPreference.neutral.length}</div>
                        <div class="stat-label">😐 普通</div>
                    </div>
                    <div class="stat-tab-card not-interested">
                        <div class="stat-number">${articlesByPreference['not-interested'].length}</div>
                        <div class="stat-label">😕 興味なさそう</div>
                    </div>
                    <div class="stat-tab-card all active">
                        <div class="stat-number">${articles.length}</div>
                        <div class="stat-label">📄 総記事数</div>
                    </div>
                </div>
            </div>

            <div class="articles-container">
                ${articles.map(article => generateArticleCard(article)).join('')}
            </div>`;
            
            document.getElementById('dashboard-container').innerHTML = html;
            document.getElementById('loading').style.display = 'none';
            document.getElementById('dashboard-container').style.display = 'block';
            
            restoreUserRatings();
        }
        
        function generateArticleCard(article) {
            const publishDate = new Date(article.pubDate).toLocaleDateString('ja-JP');
            const userRating = getUserRating(article.id);
            
            return `
            <div class="article-card ${article.preference}" data-article-id="${article.id}">
                <div class="article-content">
                    <h2 class="article-title" onclick="window.open('${article.link}', '_blank')">
                        ${article.title}
                    </h2>
                    <div class="article-meta">
                        <span class="preference-badge badge-${article.preference}">
                            ${article.preference === 'interested' ? '😍 興味ありそう' : 
                              article.preference === 'neutral' ? '😐 普通' : '😕 興味なさそう'}
                        </span>
                        <span class="article-info">📅 ${publishDate}</span>
                        <span class="article-info">📰 ${article.feedName}</span>
                    </div>
                    <div class="article-description">
                        ${article.description.substring(0, 200)}${article.description.length > 200 ? '...' : ''}
                    </div>
                    <div class="rating-section">
                        <div class="rating-stars">
                            ${[1,2,3,4,5].map(rating => 
                                `<span class="star ${rating <= userRating ? 'filled' : ''}" 
                                      data-rating="${rating}" 
                                      onclick="setRating('${article.id}', ${rating})" 
                                      title="${rating}つ星">⭐</span>`
                            ).join('')}
                        </div>
                    </div>
                </div>
            </div>`;
        }
        
        function getUserRating(articleId) {
            const feedback = JSON.parse(localStorage.getItem('ai-rss-feedback') || '{}');
            return feedback[articleId]?.rating || 0;
        }
        
        function setRating(articleId, rating) {
            let userFeedback = JSON.parse(localStorage.getItem('ai-rss-feedback') || '{}');
            
            if (!userFeedback[articleId]) {
                userFeedback[articleId] = {};
            }
            userFeedback[articleId].rating = rating;
            userFeedback[articleId].timestamp = new Date().toISOString();
            
            localStorage.setItem('ai-rss-feedback', JSON.stringify(userFeedback));
            
            const stars = document.querySelectorAll(`[data-article-id="${articleId}"] .star`);
            stars.forEach((star, index) => {
                star.classList.toggle('filled', index < rating);
            });
            
            console.log('評価保存:', articleId, rating);
        }
        
        function restoreUserRatings() {
            const userFeedback = JSON.parse(localStorage.getItem('ai-rss-feedback') || '{}');
            Object.keys(userFeedback).forEach(articleId => {
                const feedback = userFeedback[articleId];
                if (feedback.rating) {
                    const stars = document.querySelectorAll(`[data-article-id="${articleId}"] .star`);
                    stars.forEach((star, index) => {
                        star.classList.toggle('filled', index < feedback.rating);
                    });
                }
            });
        }
        
        // ページ読み込み時に実行
        document.addEventListener('DOMContentLoaded', loadLatestData);
        
        // 5分ごとに自動更新
        setInterval(loadLatestData, 300000);
    </script>
</body>
</html>
