<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Fukuãªã³ - å¤©æ°—äºˆå ±ã‚¢ãƒ—ãƒª</title>
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#3385ff">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Fukuãªã³">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
*{box-sizing:border-box}html,body,#app{height:100vh;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif}body{background:#e6f2ff;overflow:hidden}#app{display:flex;flex-direction:column;background:#fff}.th{background:linear-gradient(135deg,#66a3ff,#3385ff,#0059b3);border-radius:0 0 10px 10px;padding:8px 0;text-align:center;box-shadow:0 2px 6px rgba(0,89,179,.1);flex:0 0 31px;display:flex;align-items:center;position:relative}.tc{display:flex;align-items:center;justify-content:center;gap:6px;height:100%;width:100%}.ti{font-size:1.4em;color:#fff;text-shadow:0 2px 4px rgba(0,0,0,.2)}.tt{color:#fff;font-size:1.1em;font-weight:bold;letter-spacing:2px;line-height:1.2}.mc{display:none}.dr{display:flex;align-items:center;gap:10px;margin:6px 0 6px 2vw;flex:0 0 36px;flex-wrap:wrap}.la{width:8em;font-size:.9em;color:#0059b3;background:#f0f8ff;padding:4px 8px;border-radius:3px;border:1px solid #cce0ff;margin-right:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.rb{margin-left:auto;margin-right:10px;padding:7px 12px;border:1.2px solid #66a3ff;border-radius:5px;background:#cce0ff;color:#003366;font-size:.8em;cursor:pointer;transition:all .2s;white-space:nowrap;font-weight:600;user-select:none}.rb:hover{background:#99c2ff;border-color:#3385ff;transform:translateY(-1px)}.mg,.dg{display:flex;align-items:center;gap:8px;margin-left:30px;min-height:40px}.mgi,.dgi{font-size:1.2em;color:#0059b3;width:1.5em;height:1.5em;display:flex;align-items:center;justify-content:center;margin-right:4px}.mbs,.dbs{display:flex;gap:5px;flex-wrap:wrap}.mb,.db{padding:7px 12px;border:1.2px solid #66a3ff;border-radius:5px;background:#cce0ff;color:#003366;font-size:.85em;cursor:pointer;transition:all .2s ease;min-width:70px;text-align:center;position:relative;user-select:none;font-weight:600;white-space:pre-line;line-height:1.1;box-shadow:0 1px 3px rgba(0,0,0,.1);display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:36px}.mb:hover,.db:hover{background:#99c2ff;border-color:#3385ff;transform:translateY(-1px);box-shadow:0 2px 6px rgba(51,133,255,.2)}.mb.saved,.db.active{background:#3385ff;color:#fff;border-color:#0059b3;box-shadow:0 2px 8px rgba(51,133,255,.22)}.mb.saved:hover,.db.active:hover{background:#0059b3;transform:translateY(-1px);box-shadow:0 3px 10px rgba(51,133,255,.3)}.db{font-size:.95em;min-width:70px}.dbc{display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:.85em;line-height:1.1;width:100%}.dl{font-weight:bold;margin-bottom:2px;text-align:center;width:100%}.dd{font-size:1.2em;font-weight:600;width:100%;font-family:'Hiragino Sans','ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ã‚·ãƒƒã‚¯','Yu Gothic UI','Meiryo UI','MS UI Gothic',sans-serif;letter-spacing:2px;color:#003366;text-shadow:0 1px 2px rgba(51,133,255,.1);text-align:center}.db.active .dd{color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.2)}.mcnt{flex:1;display:flex;flex-direction:column;height:100%;width:100vw;min-height:0}.ma{flex:0 0 39%;min-height:260px;max-height:45.5vh;position:relative;width:100vw;background:#e6f2ff;border-bottom:2px solid #99c2ff;display:flex;align-items:stretch;justify-content:center}#map{flex:1;min-width:0;min-height:260px;width:100vw;height:100%;border-radius:8px;border:2px solid #99c2ff;margin:0}.clb{position:absolute;bottom:12px;left:12px;z-index:1000;padding:8px 16px;background:linear-gradient(135deg,#66a3ff,#3385ff);color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:1em;box-shadow:0 3px 8px rgba(51,133,255,.25);transition:all .3s ease;user-select:none;outline:none}.clb:hover{background:linear-gradient(135deg,#3385ff,#0059b3);transform:translateY(-2px);box-shadow:0 5px 15px rgba(51,133,255,.35)}.ta{flex:0 0 61%;overflow:hidden;display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch;background:#fff;padding-top:6px;min-height:0}.em{color:#dc2626;background:linear-gradient(135deg,#fef2f2,#fee2e2);border:1px solid #fca5a5;border-radius:8px;padding:12px 16px;margin-bottom:12px;font-weight:600;font-size:1em;width:90vw;margin:0 auto 12px;box-shadow:0 2px 8px rgba(220,38,38,.1)}.tcon{width:99vw;height:100%;overflow:auto;margin:0 auto;display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch;background:#fff}table{width:100%;border-collapse:collapse;font-size:14px;table-layout:auto;background:#f8fbff}th,td{border:1px solid #99c2ff;padding:18px 6px;text-align:center;color:#003366;font-size:14px;white-space:normal;word-break:break-word}th{background:linear-gradient(135deg,#f0f8ff,#e6f2ff);font-weight:bold;position:sticky;top:0;z-index:10}.cth{background-color:rgba(255,235,153,.3)!important}.ht{background:#dc2626!important;color:#fff!important;font-weight:bold}.ct{background:#1e40af!important;color:#fff!important;font-weight:bold}.we{font-size:2.25em;vertical-align:middle;filter:drop-shadow(0 1px 2px rgba(0,0,0,.1))}.pc{background:#e6f2ff;border-radius:6px;width:100%;height:14px;position:relative;margin:1px 0;overflow:hidden}.pb{height:100%;background:linear-gradient(135deg,#3385ff,#0059b3);border-radius:6px;transition:width .4s ease;position:relative}.ndm{text-align:center;padding:16px;color:#64748b;background:linear-gradient(135deg,#f8fafc,#f1f5f9);border-radius:8px;border:1px solid #e2e8f0;font-size:1em;width:90vw;margin:0 auto;box-shadow:0 2px 8px rgba(0,0,0,.05)}.cic{display:flex;flex-direction:column;align-items:center;justify-content:center;line-height:1.2}.cii{font-size:2.25em;margin-bottom:2px;filter:drop-shadow(0 1px 2px rgba(0,0,0,.1))}.cil{font-size:.96em;margin-top:2px;word-break:break-word;font-weight:500}.mt{display:none}.ft{background:linear-gradient(135deg,#f8fafc,#e2e8f0);border-top:1px solid #cbd5e1;padding:12px 0;text-align:center;position:relative;z-index:1}.ft small{color:#64748b;font-size:.875em;font-weight:500;letter-spacing:.5px}.cmo{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.3);z-index:999998;backdrop-filter:blur(2px)}.cm{position:absolute;background:#fff;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,.3),0 2px 8px rgba(0,0,0,.1);min-width:180px;overflow:hidden;border:1px solid rgba(51,133,255,.2);animation:cmfi .2s ease-out}.cmh{background:linear-gradient(135deg,#f0f8ff,#e6f2ff);color:#0059b3;font-weight:bold;font-size:.9em;padding:12px 16px;text-align:center;border-bottom:1px solid #e0e9ff}.cmi{padding:14px 18px;cursor:pointer;display:flex;align-items:center;gap:12px;font-size:1em;font-weight:500;transition:all .2s ease;user-select:none;border-bottom:1px solid #f0f0f0}.cmi:last-child{border-bottom:none}.cmi i{font-size:1.1em;width:16px;text-align:center}.ri{color:#0059b3}.ri:hover{background:linear-gradient(135deg,#f0f8ff,#e6f2ff);color:#003d80}.di{color:#dc2626}.di:hover{background:linear-gradient(135deg,#fef2f2,#fee2e2);color:#b91c1c}.lsm{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.65);display:flex;align-items:center;justify-content:center;z-index:999999;backdrop-filter:blur(3px);animation:mbfi .3s ease-out}.lsc{background:#fff;padding:28px;border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.3),0 4px 12px rgba(0,0,0,.1);max-width:340px;width:88%;max-height:85vh;overflow-y:auto;position:relative;margin:20px;border:1px solid rgba(51,133,255,.1);animation:mcfi .3s ease-out}.lst{color:#0059b3;font-weight:bold;font-size:1.2em;margin-bottom:20px;text-align:center;line-height:1.4;display:flex;align-items:center;justify-content:center;gap:8px}.lst::before{content:"ğŸ“";font-size:1.1em}.lsi{width:100%;padding:14px 16px;border:2px solid #e0e9ff;border-radius:10px;margin-bottom:24px;font-size:1em;outline:none;transition:all .3s ease;background:#fafcff;font-family:inherit}.lsi:focus{border-color:#3385ff;background:#fff;box-shadow:0 0 0 4px rgba(51,133,255,.1),0 2px 8px rgba(51,133,255,.15);transform:translateY(-1px)}.lsbs{display:flex;gap:14px;justify-content:center;flex-wrap:wrap}.lsb{padding:14px 24px;border:none;border-radius:10px;cursor:pointer;font-weight:600;font-size:1em;transition:all .3s ease;min-width:100px;text-align:center;user-select:none;position:relative;overflow:hidden;font-family:inherit}.sb{background:linear-gradient(135deg,#3385ff,#0059b3);color:#fff;box-shadow:0 4px 12px rgba(51,133,255,.3)}.sb:hover{background:linear-gradient(135deg,#0059b3,#003d80);transform:translateY(-2px);box-shadow:0 6px 20px rgba(51,133,255,.4)}.cb{background:linear-gradient(135deg,#f1f5f9,#e2e8f0);color:#475569;border:1px solid #cbd5e1;box-shadow:0 2px 6px rgba(0,0,0,.1)}.cb:hover{background:linear-gradient(135deg,#e2e8f0,#cbd5e1);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.15)}@keyframes cmfi{from{opacity:0;transform:scale(.8)translateY(-10px)}to{opacity:1;transform:scale(1)translateY(0)}}@keyframes mbfi{from{opacity:0}to{opacity:1}}@keyframes mcfi{from{opacity:0;transform:scale(.85)translateY(-30px)}to{opacity:1;transform:scale(1)translateY(0)}}@media(max-width:900px){.th{flex:0 0 28px}.tt{font-size:1em}.ti{font-size:1.2em}th,td{font-size:13px;padding:6px 3px}.dr{margin:6px 0 6px 1vw}.ma{flex:0 0 32.5%;min-height:234px;max-height:39vh}.ta{flex:0 0 67.5%}.we{font-size:2.34em}.cii{font-size:2.34em}#map{min-height:234px}.mb{padding:6px 10px;font-size:.88em;min-width:60px;min-height:34px}.mg,.dg{min-height:36px}}@media(max-width:600px){.tt{font-size:.9em;letter-spacing:.5px}.ti{font-size:1.1em}.la{display:none}.mb{padding:6px 10px;font-size:.8em;min-width:55px;min-height:32px}.rb{display:none}.mg{margin-left:5px}.dr{margin:6px 0 6px 1vw;align-items:center}.dg{margin-left:8px}.dbc{font-size:.75em}.dd{font-size:1.1em;letter-spacing:1px}.db{min-width:60px}.mgi,.dgi{font-size:1.1em;margin-right:4px;width:1.3em;height:1.3em}.mg,.dg{min-height:36px}.ma{flex:0 0 26%;min-height:208px;max-height:39vh}#map{min-height:208px}.ta{flex:0 0 74%;overflow:hidden;position:relative}.dt{display:none}.mt{display:table;width:100%;table-layout:fixed;border-spacing:0;margin:0}.tcon{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;overflow:auto;background:#fff;padding:0 0 120px 0}.mt td{padding:12px 4px;font-size:11px;line-height:1.4;vertical-align:middle;height:auto;min-height:48px}.mt th{font-size:11px;padding:6px 3px}.mt .we{font-size:2.2em}.mt .cii{font-size:2.2em}.mt .cil{font-size:.75em}.mt .pc{height:12px}.mt tr:last-child td{padding-bottom:20px}.lsc{width:92%;margin:8px;padding:24px;border-radius:12px}.lsi{font-size:16px;padding:16px}.lsbs{flex-direction:row;gap:12px}.lsb{flex:1;min-width:0;padding:16px 20px;font-size:1.05em}.dbs .db:nth-child(n+4){display:none}.ft{display:none}.mc{display:block;position:absolute;top:50%;right:8px;transform:translateY(-50%);z-index:5000;line-height:1;font-size:.65em;color:rgba(255,255,255,.8);font-weight:500;text-shadow:0 1px 2px rgba(0,0,0,.2);user-select:none;pointer-events:none;font-family:Verdana,"Droid Sans","ãƒ¡ã‚¤ãƒªã‚ª",Meiryo,sans-serif}}@media(max-width:400px){.lsbs{flex-direction:column}.lsb{width:100%}.lsc{padding:20px;margin:6px}.ma{flex:0 0 20.8%;min-height:156px}.ta{flex:0 0 79.2%}.mgi,.dgi{font-size:1em;margin-right:3px;width:1.2em;height:1.2em}.mc{right:6px;font-size:.6em}}
</style>
</head>
<body>
<div id="app">
<div class="th">
<div class="tc">
<i class="fas fa-shirt ti"></i>
<div class="tt">Fukuãªã³ <i class="fas fa-cloud-sun ti"></i></div>
</div>
<div class="mc">&copy; 2025 nokotubo</div>
</div>
<div class="dr">
<div class="la">ğŸ“ {{ currentAddress || 'ä½ç½®ã‚’é¸æŠ' }}</div>
<div class="mg">
<div class="mgi">ğŸ“’</div>
<div class="mbs">
<button v-for="(memory, index) in locationMemories" :key="index" @click="loadMem(index)" @mousedown="startPress(index, $event)" @mouseup="endPress" @mouseleave="endPress" @touchstart="startPress(index, $event)" @touchend="endPress" :class="['mb', { saved: memory.name }]">
{{ memory.name || `ãƒ¡ãƒ¢ãƒªãƒ¼\n${getMemNum(index)}` }}
</button>
</div>
</div>
<div class="dg">
<div class="dgi">ğŸ“…</div>
<div class="dbs">
<button v-for="(date, index) in dateList" :key="date" @click="selDate(index)" :class="['db', { active: selectedDateIndex === index }]">
<div class="dbc">
<div class="dl">{{ dateLbl(date, index) }}</div>
<div class="dd">{{ fmtDate(date) }}</div>
</div>
</button>
</div>
</div>
<button class="rb" @click="refresh">ğŸ”„ æ›´æ–°</button>
</div>
<div class="mcnt">
<div class="ma">
<div id="map">
<button class="clb" @click="getPos" @touchend.prevent="getPos" type="button">ğŸ“ ç¾åœ¨åœ°</button>
</div>
</div>
<div class="ta">
<div v-if="errorMessage" class="em">âŒ {{ errorMessage }}</div>
<div class="tcon" ref="tableContainer">
<table v-if="hasWeatherData" class="dt">
<thead>
<tr>
<th>â›… å¤©æ°—</th>
<th v-for="hour in hours" :key="hour" :class="{ 'cth': isCurHour(hour) }" :id="`hour-${hour}`">
<span class="we">{{ wIcon(weatherData[hour]?.weather_code, weatherData[hour]?.precipitation_probability) }}</span> {{ hour }}:00
</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ğŸŒ§ï¸ é™æ°´ç¢ºç‡</strong></td>
<td v-for="hour in hours" :key="hour" :class="{ 'cth': isCurHour(hour) }">
<div class="pc">
<div class="pb" :style="{ width: (weatherData[hour]?.precipitation_probability ?? 0) + '%' }"></div>
</div>
{{ weatherData[hour]?.precipitation_probability !== undefined ? weatherData[hour].precipitation_probability + "%" : '-' }}
</td>
</tr>
<tr>
<td><strong>ğŸŒ¡ï¸ æ°—æ¸©</strong></td>
<td v-for="hour in hours" :key="hour" :class="[{ 'cth': isCurHour(hour) }, tmpClass(weatherData[hour]?.temperature_2m)]">
{{ weatherData[hour]?.temperature_2m !== undefined ? weatherData[hour].temperature_2m + "â„ƒ" : '-' }}
</td>
</tr>
<tr>
<td><strong>ğŸ¤’ ä½“æ„Ÿæ¸©åº¦</strong></td>
<td v-for="hour in hours" :key="hour" :class="[{ 'cth': isCurHour(hour) }, tmpClass(weatherData[hour]?.apparent_temperature)]">
{{ weatherData[hour]?.apparent_temperature !== undefined ? weatherData[hour].apparent_temperature + "â„ƒ" : '-' }}
</td>
</tr>
<tr>
<td><strong>ğŸ’§ æ¹¿åº¦</strong></td>
<td v-for="hour in hours" :key="hour" :class="{ 'cth': isCurHour(hour) }">
{{ weatherData[hour]?.relative_humidity_2m !== undefined ? weatherData[hour].relative_humidity_2m + "%" : '-' }}
</td>
</tr>
<tr>
<td><strong>ğŸ˜° ä¸å¿«æŒ‡æ•°</strong></td>
<td v-for="hour in hours" :key="hour" :class="{ 'cth': isCurHour(hour) }">
<div style="font-size: 0.9em; font-weight: bold;">
{{ calcDI(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m) !== null ? calcDI(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m) : '-' }}
</div>
<div style="font-size: 0.8em; color: #666; margin-top: 2px;">
{{ diLvl(calcDI(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m)) }}
</div>
</td>
</tr>
<tr>
<td><strong>ğŸ‘• æœè£…æŒ‡æ•°</strong></td>
<td v-for="hour in hours" :key="hour" :class="{ 'cth': isCurHour(hour) }">
<div class="cic">
<span class="cii">{{ cIcon(weatherData[hour]?.apparent_temperature, hour) }}</span>
<span class="cil">{{ cLbl(weatherData[hour]?.apparent_temperature, hour) }}</span>
</div>
</td>
</tr>
</tbody>
</table>
<table v-if="hasWeatherData" class="mt">
<thead>
<tr>
<th>â›…<br>å¤©æ°—</th>
<th>ğŸŒ§ï¸<br>é™æ°´ç¢ºç‡</th>
<th>ğŸŒ¡ï¸<br>æ°—æ¸©</th>
<th>ğŸ¤’<br>ä½“æ„Ÿæ¸©åº¦</th>
<th>ğŸ’§<br>æ¹¿åº¦</th>
<th>ğŸ˜°<br>ä¸å¿«æŒ‡æ•°</th>
<th>ğŸ‘•<br>æœè£…</th>
</tr>
</thead>
<tbody>
<tr v-for="hour in hours" :key="hour" :class="{ 'cth': isCurHour(hour) }" :id="`mobile-hour-${hour}`">
<td>
<span class="we">{{ wIcon(weatherData[hour]?.weather_code, weatherData[hour]?.precipitation_probability) }}</span><br>
{{ hour }}:00
</td>
<td>
<div class="pc">
<div class="pb" :style="{ width: (weatherData[hour]?.precipitation_probability ?? 0) + '%' }"></div>
</div>
{{ weatherData[hour]?.precipitation_probability !== undefined ? weatherData[hour].precipitation_probability + "%" : '-' }}
</td>
<td :class="tmpClass(weatherData[hour]?.temperature_2m)">
{{ weatherData[hour]?.temperature_2m !== undefined ? weatherData[hour].temperature_2m + "â„ƒ" : '-' }}
</td>
<td :class="tmpClass(weatherData[hour]?.apparent_temperature)">
{{ weatherData[hour]?.apparent_temperature !== undefined ? weatherData[hour].apparent_temperature + "â„ƒ" : '-' }}
</td>
<td>
{{ weatherData[hour]?.relative_humidity_2m !== undefined ? weatherData[hour].relative_humidity_2m + "%" : '-' }}
</td>
<td>
<div style="font-size: 0.8em; font-weight: bold;">
{{ calcDI(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m) !== null ? calcDI(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m) : '-' }}
</div>
<div style="font-size: 0.7em; color: #666;">
{{ diLvl(calcDI(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m)) }}
</div>
</td>
<td>
<div class="cic">
<span class="cii">{{ cIcon(weatherData[hour]?.apparent_temperature, hour) }}</span>
<span class="cil">{{ cLbl(weatherData[hour]?.apparent_temperature, hour) }}</span>
</div>
</td>
</tr>
</tbody>
</table>
<div v-if="!hasWeatherData && !errorMessage" class="ndm">
ğŸ—ºï¸åœ°å›³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãã ã•ã„
</div>
</div>
</div>
</div>
<footer class="ft">
<small>&copy; 2025 nokotubo</small>
</footer>
<div v-if="showCM" class="cmo" @click="closeCM">
<div class="cm" @click.stop :style="{ left: cmPos.x + 'px', top: cmPos.y + 'px' }">
<div class="cmh">ãƒ¡ãƒ¢ãƒªãƒ¼{{ getMemNum(cmIdx) }}</div>
<div v-if="!isMemSaved(cmIdx)" class="cmi ri" @click="openSave">
<i class="fas fa-plus"></i>ä½ç½®ã‚’ç™»éŒ²
</div>
<div v-if="isMemSaved(cmIdx)" class="cmi di" @click="confDel">
<i class="fas fa-trash"></i>å‰Šé™¤
</div>
</div>
</div>
<div v-if="showSave" class="lsm" @click="closeSave">
<div class="lsc" @click.stop>
<div class="lst">ä½ç½®ã‚’ç™»éŒ²</div>
<input v-model="saveName" class="lsi" placeholder="ä¾‹: è‡ªå®…ã€è·å ´ã€å­¦æ ¡..." @keyup.enter="saveMem" ref="saveInput" maxlength="20">
<div class="lsbs">
<button class="lsb sb" @click="saveMem">ç™»éŒ²</button>
<button class="lsb cb" @click="closeSave">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
</div>
</div>
</div>
</div>
<script src="https://unpkg.com/vue@3.0.0"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
<script>
const{createApp,ref,reactive,onMounted,computed,nextTick,watch}=Vue;createApp({setup(){const map=ref(null),marker=ref(null);const selLL=reactive({lat:34.6937,lng:135.5023});const dateList=ref([]),selDateIdx=ref(0),wData=reactive({});const errorMessage=ref(''),curAddr=ref('');const hours=Array.from({length:17},(_,i)=>i+6);const tCon=ref(null);const addrCache=new Map(),addrReq=ref(false);const showCM=ref(false),cmPos=reactive({x:0,y:0});const cmIdx=ref(0),showSave=ref(false);const lMems=ref([{name:'',lat:null,lng:null,address:''},{name:'',lat:null,lng:null,address:''},{name:'',lat:null,lng:null,address:''}]);const saveName=ref(''),saveIdx=ref(0),longTimer=ref(null),saveInput=ref(null);const hasWeatherData=computed(()=>Object.keys(wData).length>0);const getMemNum=i=>['â‘ ','â‘¡','â‘¢'][i]||`${i+1}`;const isMemSaved=i=>{const m=lMems.value[i];return m.name&&m.lat&&m.lng;};const startPress=(i,e)=>{if(longTimer.value)clearTimeout(longTimer.value);longTimer.value=setTimeout(()=>{if(!selLL.lat||!selLL.lng){errorMessage.value='å…ˆã«åœ°å›³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä½ç½®ã‚’é¸æŠã—ã¦ãã ã•ã„';setTimeout(()=>{errorMessage.value='';},3000);return;}showCMDlg(i,e);},600);};const showCMDlg=(i,e)=>{cmIdx.value=i;let x,y;if(e&&e.type.startsWith('touch')){const t=e.touches[0]||e.changedTouches[0];x=t.clientX;y=t.clientY;}else if(e){x=e.clientX;y=e.clientY;}else{x=window.innerWidth/2;y=window.innerHeight/2;}const w=180,h=120;if(x+w>window.innerWidth-20)x=window.innerWidth-w-20;if(y+h>window.innerHeight-20)y=y-h-10;cmPos.x=Math.max(20,x);cmPos.y=Math.max(20,y);showCM.value=true;};const openSave=()=>{saveIdx.value=cmIdx.value;saveName.value='';closeCM();showSave.value=true;nextTick(()=>{setTimeout(()=>{if(saveInput.value)saveInput.value.focus();},200);});};const confDel=()=>{const m=lMems.value[cmIdx.value];if(confirm(`ã€Œ${m.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`))delMem();closeCM();};const delMem=()=>{lMems.value[cmIdx.value]={name:'',lat:null,lng:null,address:''};saveMemsToStore();errorMessage.value='ãƒ¡ãƒ¢ãƒªãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ';setTimeout(()=>{errorMessage.value='';},2000);};const closeCM=()=>{showCM.value=false;cmPos.x=0;cmPos.y=0;cmIdx.value=0;};const closeSave=()=>{showSave.value=false;saveName.value='';saveIdx.value=0;};const endPress=()=>{if(longTimer.value){clearTimeout(longTimer.value);longTimer.value=null;}};const getJSTDate=(d=new Date())=>{const y=d.getFullYear();const m=String(d.getMonth()+1).padStart(2,'0');const day=String(d.getDate()).padStart(2,'0');return`${y}-${m}-${day}`;};const refresh=()=>{const now=new Date();const arr=[];for(let i=0;i<=7;i++){const t=new Date(now);t.setDate(now.getDate()+i);arr.push(getJSTDate(t));}dateList.value=[...arr];selDateIdx.value=0;if(selLL.lat&&selLL.lng)fetchWData();};const isCurHour=h=>{if(selDateIdx.value!==0)return false;return new Date().getHours()===h;};const scrollToCur=()=>{if(selDateIdx.value!==0)return;const now=new Date(),h=now.getHours();if(h<6||h>22||window.innerWidth>600)return;setTimeout(()=>{const el=document.getElementById(`mobile-hour-${h}`);if(el&&tCon.value){const c=tCon.value;const rect=c.getBoundingClientRect();const top=c.scrollTop;const abs=el.offsetTop;const vh=rect.height;const rh=el.offsetHeight;const target=abs-(vh/2)+(rh/2);c.scrollTo({top:Math.max(0,target),behavior:'smooth'});}},1000);};watch(hasWeatherData,v=>{if(v)scrollToCur();});const tmpClass=t=>{if(t===undefined||t===null)return'';if(t>=35)return'ht';if(t<=0)return'ct';return'';};const wIcon=(c,p)=>{if(p!==undefined){if(p<=10)return c===0?'â˜€ï¸':'â›…';if(p>=50)return'â˜”';if(p>=30)return'ğŸŒ§ï¸';if(p>=11)return'ğŸŒ¦ï¸';return'â›…';}if(c===undefined||c===null)return'â˜€ï¸';const icons={0:'â˜€ï¸',1:'â›…',2:'â›…',3:'â›…',45:'ğŸŒ«ï¸',48:'ğŸŒ«ï¸',51:'ğŸŒ¦ï¸',53:'ğŸŒ¦ï¸',55:'ğŸŒ¦ï¸',56:'ğŸŒ¨ï¸',57:'ğŸŒ¨ï¸',61:'ğŸŒ§ï¸',63:'ğŸŒ§ï¸',65:'ğŸŒ§ï¸',66:'ğŸŒ¨ï¸',67:'ğŸŒ¨ï¸',71:'â„ï¸',73:'â„ï¸',75:'â„ï¸',77:'â„ï¸',80:'ğŸŒ¦ï¸',81:'ğŸŒ¦ï¸',82:'ğŸŒ¦ï¸',85:'ğŸŒ¨ï¸',86:'ğŸŒ¨ï¸',95:'â›ˆï¸',96:'â›ˆï¸',99:'â›ˆï¸'};return icons[c]||'â˜€ï¸';};const calcDI=(t,h)=>{if(t===undefined||t===null||h===undefined||h===null)return null;const d=0.81*t+0.01*h*(0.99*t-14.3)+46.3;return Math.round(d*10)/10;};const diLvl=d=>{if(d===null||d===undefined)return'-';if(d<55)return'å¯’ã„';if(d<60)return'è‚Œå¯’ã„';if(d<65)return'ä½•ã‚‚æ„Ÿã˜ãªã„';if(d<70)return'å¿«ã„';if(d<75)return'æš‘ããªã„';if(d<80)return'ã‚„ã‚„æš‘ã„';if(d<85)return'æš‘ãã¦æ±—ãŒå‡ºã‚‹';return'æš‘ãã¦ãŸã¾ã‚‰ãªã„';};const loadMemsFromStore=()=>{const s=localStorage.getItem('fukuanvi-location-memories');if(s){try{lMems.value=JSON.parse(s);}catch(e){console.error('ä½ç½®ãƒ¡ãƒ¢ãƒªãƒ¼ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:',e);}}};const saveMemsToStore=()=>{localStorage.setItem('fukuanvi-location-memories',JSON.stringify(lMems.value));};const saveMem=()=>{const n=saveName.value.trim();if(n&&n.length<=20){lMems.value[saveIdx.value]={name:n,lat:selLL.lat,lng:selLL.lng,address:curAddr.value};saveMemsToStore();closeSave();}else if(!n){if(saveInput.value)saveInput.value.focus();}else{errorMessage.value='ä½ç½®åã¯20æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';setTimeout(()=>{errorMessage.value='';},3000);}};const loadMem=i=>{const m=lMems.value[i];if(m.name&&m.lat&&m.lng){selLL.lat=m.lat;selLL.lng=m.lng;curAddr.value='ä½ç½®æƒ…å ±å–å¾—ä¸­...';if(map.value){map.value.setView([m.lat,m.lng],10);updMarker();}fetchAddr(m.lat,m.lng);fetchWData();}};const fetchAddr=async(lat,lng)=>{const k=`${lat.toFixed(3)},${lng.toFixed(3)}`;if(addrCache.has(k)){curAddr.value=addrCache.get(k);return;}if(addrReq.value)return;addrReq.value=true;try{const c=new AbortController();const tid=setTimeout(()=>c.abort(),3000);const r=await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json&addressdetails=1&accept-language=ja&zoom=10`,{signal:c.signal});clearTimeout(tid);if(!r.ok)throw new Error('ä½æ‰€å–å¾—ã«å¤±æ•—');const d=await r.json();const a=d.address;let display='ä½ç½®ã‚’é¸æŠ';if(a){const pref=a.state||a.prefecture||'';const city=a.city||a.town||a.village||a.municipality||'';if(pref&&city)display=`${pref} ${city}`;else if(pref||city)display=pref||city;}if(addrCache.size>=100){const first=addrCache.keys().next().value;addrCache.delete(first);}addrCache.set(k,display);curAddr.value=display;}catch(e){curAddr.value='ä½ç½®ã‚’é¸æŠ';}finally{addrReq.value=false;}};const initMap=()=>{const el=document.getElementById('map');if(!el)return;if(map.value){map.value.remove();map.value=null;}try{map.value=L.map('map',{preferCanvas:true,zoomControl:true}).setView([selLL.lat,selLL.lng],8);L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'Â© OpenStreetMap contributors',loading:'lazy'}).addTo(map.value);const icon=L.divIcon({html:'<div style="background: linear-gradient(135deg, #3385ff, #0059b3); color: white; width: 32px; height: 32px; border-radius: 50% 50% 50% 0; transform: rotate(-45deg); display: flex; align-items: center; justify-content: center; box-shadow: 0 3px 8px rgba(51, 133, 255, 0.4); border: 3px solid white;"><i class="fas fa-shirt" style="transform: rotate(45deg); font-size: 14px;"></i></div>',className:'custom-location-marker',iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]});marker.value=L.marker([selLL.lat,selLL.lng],{icon:icon}).addTo(map.value);map.value.on('click',e=>{selLL.lat=e.latlng.lat;selLL.lng=e.latlng.lng;updMarker();fetchWData();fetchAddr(e.latlng.lat,e.latlng.lng);});setTimeout(()=>{if(map.value)map.value.invalidateSize();},100);}catch(e){errorMessage.value='åœ°å›³ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚';}};const updMarker=()=>{if(marker.value)marker.value.setLatLng([selLL.lat,selLL.lng]);};const getPos=()=>{if(!navigator.geolocation){errorMessage.value='âŒ ã“ã®ãƒ‡ãƒã‚¤ã‚¹ã¯ä½ç½®æƒ…å ±ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚\næ‰‹å‹•ã§åœ°å›³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä½ç½®ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚';return;}curAddr.value='ğŸ”„ ä½ç½®æƒ…å ±å–å¾—ä¸­...';errorMessage.value='';const opts={enableHighAccuracy:true,timeout:15000,maximumAge:60000};navigator.geolocation.getCurrentPosition(pos=>{selLL.lat=pos.coords.latitude;selLL.lng=pos.coords.longitude;if(map.value){map.value.setView([selLL.lat,selLL.lng],12);updMarker();}fetchWData();fetchAddr(pos.coords.latitude,pos.coords.longitude);},err=>{let msg='';switch(err.code){case err.PERMISSION_DENIED:msg='ğŸš« ä½ç½®æƒ…å ±ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚\n\nã€è§£æ±ºæ–¹æ³•ã€‘\n1. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼å·¦ã®ğŸ”’ãƒãƒ¼ã‚¯ã‚’ã‚¿ãƒƒãƒ—\n2. ä½ç½®æƒ…å ±ã‚’ã€Œè¨±å¯ã€ã«å¤‰æ›´\n3. ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„';break;case err.POSITION_UNAVAILABLE:msg='ğŸ“ ä½ç½®æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã€‚\n\nã€ç¢ºèªäº‹é …ã€‘\nâ€¢ GPSãŒã‚ªãƒ³ã«ãªã£ã¦ã„ã‚‹ã‹\nâ€¢ å±‹å¤–ã«ã„ã‚‹ã‹ï¼ˆå±‹å†…ã§ã¯å–å¾—å›°é›£ï¼‰\nâ€¢ æ©Ÿå†…ãƒ¢ãƒ¼ãƒ‰ãŒã‚ªãƒ•ã«ãªã£ã¦ã„ã‚‹ã‹';break;case err.TIMEOUT:msg='â±ï¸ ä½ç½®æƒ…å ±ã®å–å¾—ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚\n\nã€ãŠè©¦ã—ãã ã•ã„ã€‘\nâ€¢ é›»æ³¢ã®è‰¯ã„å ´æ‰€ã«ç§»å‹•\nâ€¢ å°‘ã—æ™‚é–“ã‚’ãŠã„ã¦å†åº¦å®Ÿè¡Œ\nâ€¢ æ‰‹å‹•ã§åœ°å›³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä½ç½®é¸æŠ';break;default:msg=`âŒ ä½ç½®æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼\n\nã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰: ${err.code}\nãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ${err.message}\n\næ‰‹å‹•ã§åœ°å›³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä½ç½®ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚`;break;}errorMessage.value=msg;curAddr.value='ä½ç½®ã‚’é¸æŠ';setTimeout(()=>{errorMessage.value='';},15000);},opts);};const genDateList=()=>{const today=new Date();dateList.value=[];for(let i=0;i<=7;i++){const d=new Date(today);d.setDate(today.getDate()+i);dateList.value.push(getJSTDate(d));}};const dateLbl=(s,i)=>{if(i===0)return'ä»Šæ—¥';if(i===1)return'æ˜æ—¥';if(i===2)return'æ˜å¾Œæ—¥';return`${i}æ—¥å¾Œ`;};const fmtDate=s=>{const d=new Date(s);const m=d.getMonth()+1;const day=d.getDate();const w=d.toLocaleDateString('ja-JP',{weekday:'short'});return`${m}/${day}ï¼ˆ${w}ï¼‰`;};const selDate=i=>{selDateIdx.value=i;fetchWData();};const fetchWData=()=>{errorMessage.value='';Object.keys(wData).forEach(k=>delete wData[k]);const d=dateList.value[selDateIdx.value];const lat=selLL.lat.toFixed(4);const lng=selLL.lng.toFixed(4);const url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lng}&hourly=temperature_2m,apparent_temperature,relative_humidity_2m,precipitation_probability,weather_code&start_date=${d}&end_date=${d}&timezone=Asia/Tokyo`;const c=new AbortController();const tid=setTimeout(()=>c.abort(),15000);fetch(url,{signal:c.signal}).then(r=>{clearTimeout(tid);if(!r.ok)throw new Error('å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');return r.json();}).then(data=>{if(!data.hourly)throw new Error('å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚');for(const h of hours){const idx=data.hourly.time.findIndex(t=>t.endsWith(`T${h.toString().padStart(2,'0')}:00`));if(idx!==-1){wData[h]={temperature_2m:Math.round(data.hourly.temperature_2m[idx]),apparent_temperature:Math.round(data.hourly.apparent_temperature[idx]),relative_humidity_2m:Math.round(data.hourly.relative_humidity_2m[idx]),precipitation_probability:Math.round(data.hourly.precipitation_probability[idx]||0),weather_code:data.hourly.weather_code[idx]};}}}).catch(e=>{clearTimeout(tid);errorMessage.value=e.name==='AbortError'?'å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚':e.message;setTimeout(()=>{errorMessage.value='';},8000);});};const cIcon=(t,h)=>{if(t===undefined||t===null)return'';let adj=t;if((h>=6&&h<=9)||(h>=18&&h<=21))adj-=1.5;else if(h>=22||h<=5)adj-=1;if(adj>=35)return'ğŸ§˜â€â™‚ï¸';if(adj>=30)return'ğŸ‹ï¸â€â™‚ï¸';if(adj>=27)return'ğŸ‘•';if(adj>=24)return'ğŸ‘”';if(adj>=21)return'ğŸ¦º';if(adj>=18)return'ğŸ§¥';if(adj>=15)return'ğŸ§¥';if(adj>=12)return'ğŸ§¥';if(adj>=9)return'ğŸ§¥';if(adj>=6)return'ğŸ§¥';if(adj>=3)return'ğŸ§¥';return'ğŸ§¥';};const cLbl=(t,h)=>{if(t===undefined||t===null)return'-';let adj=t;if((h>=6&&h<=9)||(h>=18&&h<=21))adj-=1.5;else if(h>=22||h<=5)adj-=1;if(adj>=35)return'å…¨è£¸ãƒ¬ãƒ™ãƒ«';if(adj>=30)return'ã‚¿ãƒ³ã‚¯ãƒˆãƒƒãƒ—';if(adj>=27)return'åŠè¢–Tã‚·ãƒ£ãƒ„';if(adj>=24)return'é•·è¢–Tã‚·ãƒ£ãƒ„';if(adj>=21)return'è–„æ‰‹ã‚«ãƒ¼ãƒ‡ã‚£ã‚¬ãƒ³';if(adj>=18)return'ã‚»ãƒ¼ã‚¿ãƒ¼';if(adj>=15)return'ãƒ‘ãƒ¼ã‚«ãƒ¼';if(adj>=12)return'ã‚¸ãƒ£ã‚±ãƒƒãƒˆ';if(adj>=9)return'ã‚³ãƒ¼ãƒˆ';if(adj>=6)return'åšæ‰‹ã‚³ãƒ¼ãƒˆ';if(adj>=3)return'ãƒ€ã‚¦ãƒ³ã‚¸ãƒ£ã‚±ãƒƒãƒˆ';return'é˜²å¯’ç€å®Œå…¨è£…å‚™';};onMounted(()=>{genDateList();nextTick(()=>{setTimeout(()=>{initMap();fetchWData();loadMemsFromStore();},200);});});return{dateList,selDateIdx,selDate,dateLbl,fmtDate,wData,hours,cIcon,cLbl,wIcon,calcDI,diLvl,errorMessage,hasWeatherData,getPos,currentAddress:curAddr,isCurHour,tmpClass,locationMemories:lMems,showSave,saveName,saveInput,startPress,endPress,saveMem,closeSave,loadMem,refresh,tableContainer:tCon,scrollToCur,getMemNum,showCM,cmPos,cmIdx,isMemSaved,openSave,confDel,delMem,closeCM};}}).mount('#app');if('serviceWorker'in navigator&&(location.protocol==='https:'||location.hostname==='localhost')){window.addEventListener('load',()=>{navigator.serviceWorker.register('/sw.js').then(r=>console.log('SW registered: ',r)).catch(e=>console.log('SW registration failed: ',e));})}
</script>
</body>
</html>
