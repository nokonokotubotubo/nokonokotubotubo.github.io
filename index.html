<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Fukuなび - 天気予報アプリ</title>
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#3385ff">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Fukuなび">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
:root{--primary:#3385ff;--primary-dark:#0059b3;--primary-darker:#003d80;--primary-light:#66a3ff;--primary-bg:#e6f2ff;--primary-bg-light:#f0f8ff;--primary-border:#99c2ff;--primary-border-light:#cce0ff;--text-primary:#003366;--text-light:#fff;--shadow-light:0 2px 6px rgba(0,89,179,.1);--shadow-medium:0 3px 8px rgba(51,133,255,.25);--shadow-heavy:0 8px 32px rgba(0,0,0,.3);--gradient-primary:linear-gradient(135deg,var(--primary-light),var(--primary-dark));--gradient-bg:linear-gradient(135deg,var(--primary-bg-light),var(--primary-bg));--transition:all .2s ease}
*{box-sizing:border-box}
html,body,#app{height:100vh;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif}
body{background:var(--primary-bg);overflow:hidden}
#app{display:flex;flex-direction:column;background:var(--text-light)}
.btn-base{border:1.2px solid var(--primary-light);border-radius:5px;cursor:pointer;transition:var(--transition);user-select:none;font-weight:600;white-space:nowrap;display:flex;align-items:center;justify-content:center}
.btn-base:hover{transform:translateY(-1px)}
.title-header{background:var(--gradient-primary);border-radius:0 0 10px 10px;padding:8px 16px;text-align:center;box-shadow:var(--shadow-light);flex:0 0 31px;display:flex;align-items:center;justify-content:space-between;position:relative}
.desktop-location-address{width:12em;font-size:.9em;color:var(--text-light);background:rgba(255,255,255,.2);padding:4px 8px;border-radius:3px;border:1px solid rgba(255,255,255,.3);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;backdrop-filter:blur(10px)}
.desktop-refresh-btn{padding:4px 12px;border:1.2px solid rgba(255,255,255,.3);border-radius:5px;background:rgba(255,255,255,.2);color:var(--text-light);font-size:.8em;cursor:pointer;transition:var(--transition);white-space:nowrap;font-weight:600;user-select:none;backdrop-filter:blur(10px)}
.desktop-refresh-btn:hover{background:rgba(255,255,255,.3);border-color:rgba(255,255,255,.5);transform:translateY(-1px)}
.title-content{display:flex;align-items:center;justify-content:center;gap:6px;height:100%}
.title-icon{font-size:1.4em;color:var(--text-light);text-shadow:0 2px 4px rgba(0,0,0,.2)}
.title-text{color:var(--text-light);font-size:1.1em;font-weight:bold;letter-spacing:2px;line-height:1.2}
.mobile-copyright{display:none}
.date-row{display:flex;align-items:flex-start;gap:10px;margin:6px 0 6px 2vw;flex:0 0 36px;flex-wrap:wrap}
.location-address{width:8em;font-size:.9em;color:var(--primary-dark);background:var(--primary-bg-light);padding:4px 8px;border-radius:3px;border:1px solid var(--primary-border-light);margin-right:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.refresh-btn{margin-left:auto;margin-right:10px;padding:7px 12px;background:var(--primary-border-light);color:var(--text-primary)}
.refresh-btn:extend(.btn-base){}
.refresh-btn:hover{background:var(--primary-border);border-color:var(--primary)}
.memory-group,.date-group{display:flex;align-items:flex-start;gap:8px;margin-left:30px;min-height:40px}
.group-icon{font-size:1.8em;color:var(--primary-dark);width:1.5em;height:1.5em;display:flex;align-items:center;justify-content:center;margin:2px 4px 0 0}
.buttons-container{display:flex;gap:5px;flex-wrap:wrap}
.button-common{padding:7px 12px;background:var(--primary-border-light);color:var(--text-primary);font-size:.85em;min-width:70px;text-align:center;position:relative;white-space:pre-line;line-height:1.1;box-shadow:0 1px 3px rgba(0,0,0,.1);flex-direction:column;min-height:36px}
.button-common:extend(.btn-base){}
.button-common:hover{background:var(--primary-border);border-color:var(--primary);box-shadow:0 2px 6px rgba(51,133,255,.2)}
.memory-btn:extend(.button-common){}
.memory-btn.saved{background:var(--primary);color:var(--text-light);border-color:var(--primary-dark);box-shadow:0 2px 8px rgba(51,133,255,.22)}
.memory-btn.memory-selected{background:var(--primary-dark)!important;color:var(--text-light)!important;border-color:var(--primary-darker)!important;box-shadow:0 3px 12px rgba(0,89,179,.35)!important}
.date-button:extend(.button-common){font-size:.95em}
.date-button.active{background:var(--primary-dark);color:var(--text-light);border-color:var(--primary-darker);box-shadow:0 2px 8px rgba(0,89,179,.25)}
.saved-active-hover:hover{background:var(--primary-darker);box-shadow:0 3px 12px rgba(0,89,179,.35)}
.memory-btn.saved:hover:extend(.saved-active-hover){}
.date-button.active:hover:extend(.saved-active-hover){}
.memory-btn.memory-selected:hover{background:var(--primary-darker)!important;box-shadow:0 4px 16px rgba(0,89,179,.45)!important}
.date-button-content{display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:.85em;line-height:1.1;width:100%}
.date-label{font-weight:bold;margin-bottom:2px;text-align:center;width:100%}
.date-detail{font-size:1.2em;font-weight:600;width:100%;font-family:'Hiragino Sans','ヒラギノ角ゴシック','Yu Gothic UI','Meiryo UI','MS UI Gothic',sans-serif;letter-spacing:2px;color:var(--text-primary);text-shadow:0 1px 2px rgba(51,133,255,.1);text-align:center}
.date-button.active .date-detail{color:var(--text-light);text-shadow:0 1px 2px rgba(0,0,0,.2)}
.main-content{flex:1;display:flex;flex-direction:column;height:100%;width:100vw;min-height:0}
.map-area{flex:0 0 39%;min-height:260px;max-height:45.5vh;position:relative;width:100vw;background:var(--primary-bg);border-bottom:2px solid var(--primary-border);display:flex;align-items:stretch;justify-content:center}
#map{flex:1;min-width:0;min-height:260px;width:100vw;height:100%;border-radius:8px;border:2px solid var(--primary-border);margin:0}
.current-location-btn{position:absolute;bottom:12px;left:12px;z-index:1000;padding:8px 16px;background:var(--gradient-primary);color:var(--text-light);border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:1em;box-shadow:var(--shadow-medium);transition:all .3s ease;user-select:none;outline:none}
.current-location-btn:hover{background:linear-gradient(135deg,var(--primary),var(--primary-dark));transform:translateY(-2px);box-shadow:0 5px 15px rgba(51,133,255,.35)}
.table-area{flex:0 0 61%;overflow:hidden;display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch;background:var(--text-light);padding-top:6px;min-height:0}
.message-base{border-radius:8px;padding:12px 16px;margin:0 auto 12px;font-weight:600;font-size:1em;width:90vw}
.error-message:extend(.message-base){color:#dc2626;background:linear-gradient(135deg,#fef2f2,#fee2e2);border:1px solid #fca5a5;box-shadow:0 2px 8px rgba(220,38,38,.1)}
.no-data-message:extend(.message-base){text-align:center;color:#64748b;background:linear-gradient(135deg,#f8fafc,#f1f5f9);border:1px solid #e2e8f0;box-shadow:0 2px 8px rgba(0,0,0,.05)}
.table-container{width:99vw;height:100%;overflow:auto;margin:0 auto;display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch;background:var(--text-light)}
table{width:100%;border-collapse:collapse;font-size:14px;table-layout:auto;background:#f8fbff}
th,td{border:1px solid var(--primary-border);padding:18px 6px;text-align:center;color:var(--text-primary);font-size:14px;white-space:normal;word-break:break-word}
th{background:var(--gradient-bg);font-weight:bold;position:sticky;top:0;z-index:10}
.current-time-highlight{background-color:rgba(255,235,153,.3)!important}
.hot-temperature{background:#dc2626!important;color:var(--text-light)!important;font-weight:bold}
.cold-temperature{background:#1e40af!important;color:var(--text-light)!important;font-weight:bold}
.weather-emoji{font-size:2.25em;vertical-align:middle;filter:drop-shadow(0 1px 2px rgba(0,0,0,.1))}
.progress-container{background:var(--primary-bg);border-radius:6px;width:100%;height:14px;position:relative;margin:1px 0;overflow:hidden}
.progress-bar{height:100%;background:linear-gradient(135deg,var(--primary),var(--primary-dark));border-radius:6px;transition:width .4s ease;position:relative}
.clothing-index-cell{display:flex;flex-direction:column;align-items:center;justify-content:center;line-height:1.2}
.clothing-index-icon{font-size:2.25em;margin-bottom:2px;filter:drop-shadow(0 1px 2px rgba(0,0,0,.1))}
.clothing-index-label{font-size:.96em;margin-top:2px;word-break:break-word;font-weight:500}
.mobile-table{display:none}
.row-highlighted{background:rgba(51,133,255,.15)!important;border:2px solid var(--primary)!important;box-shadow:0 0 8px rgba(51,133,255,.3)!important}
.row-clickable{cursor:pointer;transition:all .2s ease}
.row-clickable:hover{background:rgba(51,133,255,.08)!important}
.footer{background:linear-gradient(135deg,#f8fafc,#e2e8f0);border-top:1px solid #cbd5e1;padding:12px 0;text-align:center;position:relative;z-index:1}
.footer small{color:#64748b;font-size:.875em;font-weight:500;letter-spacing:.5px}
.context-menu-overlay{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.3);z-index:999998;backdrop-filter:blur(2px)}
.context-menu{position:absolute;background:var(--text-light);border-radius:12px;box-shadow:var(--shadow-heavy),0 2px 8px rgba(0,0,0,.1);min-width:180px;overflow:hidden;border:1px solid rgba(51,133,255,.2);animation:contextMenuFadeIn .2s ease-out}
.context-menu-header{background:var(--gradient-bg);color:var(--primary-dark);font-weight:bold;font-size:.9em;padding:12px 16px;text-align:center;border-bottom:1px solid #e0e9ff}
.context-menu-item{padding:14px 18px;cursor:pointer;display:flex;align-items:center;gap:12px;font-size:1em;font-weight:500;transition:var(--transition);user-select:none;border-bottom:1px solid #f0f0f0}
.context-menu-item:last-child{border-bottom:none}
.context-menu-item i{font-size:1.1em;width:16px;text-align:center}
.register-item{color:var(--primary-dark)}
.register-item:hover{background:var(--gradient-bg);color:var(--primary-darker)}
.delete-item{color:#dc2626}
.delete-item:hover{background:linear-gradient(135deg,#fef2f2,#fee2e2);color:#b91c1c}
.modal-base{position:fixed;top:0;left:0;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;z-index:999999}
.location-save-modal:extend(.modal-base){background:rgba(0,0,0,.65);backdrop-filter:blur(3px);animation:modalBackdropFadeIn .3s ease-out}
.location-save-content{background:var(--text-light);padding:28px;border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.3),0 4px 12px rgba(0,0,0,.1);max-width:340px;width:88%;max-height:85vh;overflow-y:auto;position:relative;margin:20px;border:1px solid rgba(51,133,255,.1);animation:modalContentFadeIn .3s ease-out}
.location-save-title{color:var(--primary-dark);font-weight:bold;font-size:1.2em;margin-bottom:20px;text-align:center;line-height:1.4;display:flex;align-items:center;justify-content:center;gap:8px}
.location-save-title::before{content:"📍";font-size:1.1em}
.location-save-input{width:100%;padding:14px 16px;border:2px solid #e0e9ff;border-radius:10px;margin-bottom:24px;font-size:1em;outline:none;transition:all .3s ease;background:#fafcff;font-family:inherit}
.location-save-input:focus{border-color:var(--primary);background:var(--text-light);box-shadow:0 0 0 4px rgba(51,133,255,.1),0 2px 8px rgba(51,133,255,.15);transform:translateY(-1px)}
.location-save-buttons{display:flex;gap:14px;justify-content:center;flex-wrap:wrap}
.location-save-btn{padding:14px 24px;border:none;border-radius:10px;cursor:pointer;font-weight:600;font-size:1em;transition:all .3s ease;min-width:100px;text-align:center;user-select:none;position:relative;overflow:hidden;font-family:inherit}
.save-btn{background:var(--gradient-primary);color:var(--text-light);box-shadow:0 4px 12px rgba(51,133,255,.3)}
.save-btn:hover{background:linear-gradient(135deg,var(--primary-dark),var(--primary-darker));transform:translateY(-2px);box-shadow:0 6px 20px rgba(51,133,255,.4)}
.cancel-btn{background:linear-gradient(135deg,#f1f5f9,#e2e8f0);color:#475569;border:1px solid #cbd5e1;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.cancel-btn:hover{background:linear-gradient(135deg,#e2e8f0,#cbd5e1);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.15)}
@keyframes contextMenuFadeIn{from{opacity:0;transform:scale(.8)translateY(-10px)}to{opacity:1;transform:scale(1)translateY(0)}}
@keyframes modalBackdropFadeIn{from{opacity:0}to{opacity:1}}
@keyframes modalContentFadeIn{from{opacity:0;transform:scale(.85)translateY(-30px)}to{opacity:1;transform:scale(1)translateY(0)}}
@media(max-width:900px){
.title-header{padding:8px 0;justify-content:center;flex:0 0 28px}
.desktop-refresh-btn{display:none}
.title-text{font-size:1em}
.title-icon{font-size:1.2em}
th,td{font-size:13px;padding:6px 3px}
.date-row{margin:6px 0 6px 1vw}
.map-area{flex:0 0 32.5%;min-height:234px;max-height:39vh}
.table-area{flex:0 0 67.5%}
.weather-emoji,.clothing-index-icon{font-size:2.34em}
#map{min-height:234px}
.memory-btn{padding:6px 10px;font-size:.88em;min-width:60px;min-height:34px}
.memory-group,.date-group{min-height:36px}
.group-icon{font-size:1.65em;margin-right:4px;width:1.3em;height:1.3em}
}
@media(max-width:600px){
.title-text{font-size:.9em;letter-spacing:.5px}
.title-icon{font-size:1.1em}
.desktop-location-address{display:block!important;width:7em;font-size:.75em;padding:3px 6px;border-radius:2px}
.title-header{padding:8px 6px;justify-content:space-between;flex:0 0 28px}
.title-content{position:absolute;left:50%;transform:translateX(-50%);display:flex;align-items:center;justify-content:center;gap:6px;height:100%}
.location-address,.refresh-btn{display:none}
.date-row{margin:6px 0 6px 1vw;align-items:flex-start;width:calc(100% - 2vw);flex-direction:column;gap:4px;flex:0 0 76px}
.memory-group,.date-group{margin:0 5px;gap:3px;width:calc(100% - 10px);align-items:flex-start}
.buttons-container{flex-wrap:nowrap;overflow-x:auto;-webkit-overflow-scrolling:touch;width:100%;gap:3px}
.memory-btn,.date-button{min-width:55px;flex-shrink:0}
.memory-btn{padding:6px 10px;font-size:.8em;min-height:32px}
.date-button-content{font-size:.75em}
.date-detail{font-size:1.1em;letter-spacing:1px}
.map-area{flex:0 0 26%;min-height:208px;max-height:39vh}
#map{min-height:208px}
.table-area{flex:0 0 74%;overflow:hidden;position:relative}
.map-area.map-hidden{flex:0 0 0;min-height:0;max-height:0;overflow:hidden}
.table-area.table-full{flex:0 0 100%}
.desktop-table{display:none}
.mobile-table{display:table;width:100%;table-layout:fixed;border-spacing:0;margin:0}
.table-container{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;overflow:auto;background:var(--text-light);padding:0 0 120px 0}
.mobile-table td{padding:12px 4px;font-size:11px;line-height:1.4;vertical-align:middle;height:auto;min-height:48px}
.mobile-table th{font-size:11px;padding:6px 3px}
.mobile-table .weather-emoji,.mobile-table .clothing-index-icon{font-size:2.2em}
.mobile-table .clothing-index-label{font-size:.75em}
.mobile-table .progress-container{height:12px}
.mobile-table tr:last-child td{padding-bottom:20px}
.location-save-content{width:92%;margin:8px;padding:24px;border-radius:12px}
.location-save-input{font-size:16px;padding:16px}
.location-save-buttons{flex-direction:row;gap:12px}
.location-save-btn{flex:1;min-width:0;padding:16px 20px;font-size:1.05em}
.footer{display:none}
.mobile-copyright{display:block;position:absolute;top:50%;right:8px;transform:translateY(-50%);z-index:5000;line-height:1;font-size:.65em;color:rgba(255,255,255,.8);font-weight:500;text-shadow:0 1px 2px rgba(0,0,0,.2);user-select:none;pointer-events:none;font-family:Verdana,"Droid Sans","メイリオ",Meiryo,sans-serif}
}
@media(max-width:400px){
.location-save-buttons{flex-direction:column}
.location-save-btn{width:100%}
.location-save-content{padding:20px;margin:6px}
.map-area{flex:0 0 20.8%;min-height:156px}
.table-area{flex:0 0 79.2%}
.map-area.map-hidden{flex:0 0 0;min-height:0}
.table-area.table-full{flex:0 0 100%}
.group-icon{font-size:1.5em;margin-right:3px;width:1.2em;height:1.2em}
.mobile-copyright{right:6px;font-size:.6em}
.date-button{min-width:50px}
.buttons-container{gap:2px}
}
</style>
</head>
<body>
<div id="app">
<div class="title-header">
<div class="desktop-location-address">📍 {{ currentAddress || '位置を選択' }}</div>
<div class="title-content" @click="isMobile ? toggleMap() : null" :style="{ cursor: isMobile ? 'pointer' : 'default' }">
<i class="fas fa-shirt title-icon"></i>
<div class="title-text">Fukuなび <i class="fas fa-cloud-sun title-icon"></i></div>
</div>
<button class="desktop-refresh-btn" @click="refreshDateAndWeather">🔄 更新</button>
<div class="mobile-copyright">&copy; 2025 nokotubo</div>
</div>
<div class="date-row">
<div class="memory-group">
<div class="group-icon">📒</div>
<div class="buttons-container">
<button v-for="(memory, index) in locationMemories" :key="index" @click="loadLocationMemory(index)" @mousedown="startLongPress(index, $event)" @mouseup="endLongPress" @mouseleave="endLongPress" @touchstart="startLongPress(index, $event)" @touchend="endLongPress" :class="['memory-btn', { saved: memory.name, 'memory-selected': selectedMemoryIndex === index }]">
{{ memory.name || `メモリ\n${getMemoryNumber(index)}` }}
</button>
</div>
</div>
<div class="date-group">
<div class="group-icon">📅</div>
<div class="buttons-container">
<button v-for="(date, index) in dateList" :key="date" @click="selectDate(index)" :class="['date-button', { active: selectedDateIndex === index }]">
<div class="date-button-content">
<div class="date-label">{{ dateLabel(date, index) }}</div>
<div class="date-detail">{{ formatDateDetail(date) }}</div>
</div>
</button>
</div>
</div>
</div>
<div class="main-content">
<div class="map-area" :class="{ 'map-hidden': !showMap }">
<div id="map">
<button class="current-location-btn" @click="getCurrentLocation" @touchend.prevent="getCurrentLocation">📍 現在地</button>
</div>
</div>
<div class="table-area" :class="{ 'table-full': !showMap }">
<div v-if="errorMessage" class="error-message">❌ {{ errorMessage }}</div>
<div class="table-container" ref="tableContainer">
<table v-if="hasWeatherData" class="desktop-table">
<thead>
<tr>
<th>⛅ 天気</th>
<th v-for="hour in hours" :key="hour" :class="{ 'current-time-highlight': isCurrentHour(hour) }" :id="`hour-${hour}`">
<span class="weather-emoji">{{ weatherIcon(weatherData[hour]?.weather_code, weatherData[hour]?.precipitation_probability) }}</span><br>{{ hour }}:00
</th>
</tr>
</thead>
<tbody>
<tr @click="toggleRowHighlight('precipitation')" :class="['row-clickable', { 'row-highlighted': highlightedRow === 'precipitation' }]">
<td><strong>🌧️ 降水確率</strong></td>
<td v-for="hour in hours" :key="hour" :class="{ 'current-time-highlight': isCurrentHour(hour) }">
<div class="progress-container">
<div class="progress-bar" :style="{ width: (weatherData[hour]?.precipitation_probability ?? 0) + '%' }"></div>
</div>
{{ weatherData[hour]?.precipitation_probability !== undefined ? weatherData[hour].precipitation_probability + "%" : '-' }}
</td>
</tr>
<tr @click="toggleRowHighlight('temperature')" :class="['row-clickable', { 'row-highlighted': highlightedRow === 'temperature' }]">
<td><strong>🌡️ 気温</strong></td>
<td v-for="hour in hours" :key="hour" :class="[{ 'current-time-highlight': isCurrentHour(hour) }, temperatureClass(weatherData[hour]?.temperature_2m)]">
{{ weatherData[hour]?.temperature_2m !== undefined ? weatherData[hour].temperature_2m + "℃" : '-' }}
</td>
</tr>
<tr @click="toggleRowHighlight('apparent_temperature')" :class="['row-clickable', { 'row-highlighted': highlightedRow === 'apparent_temperature' }]">
<td><strong>🤒 体感温度</strong></td>
<td v-for="hour in hours" :key="hour" :class="[{ 'current-time-highlight': isCurrentHour(hour) }, temperatureClass(weatherData[hour]?.apparent_temperature)]">
{{ weatherData[hour]?.apparent_temperature !== undefined ? weatherData[hour].apparent_temperature + "℃" : '-' }}
</td>
</tr>
<tr @click="toggleRowHighlight('humidity')" :class="['row-clickable', { 'row-highlighted': highlightedRow === 'humidity' }]">
<td><strong>💧 湿度</strong></td>
<td v-for="hour in hours" :key="hour" :class="{ 'current-time-highlight': isCurrentHour(hour) }">
{{ weatherData[hour]?.relative_humidity_2m !== undefined ? weatherData[hour].relative_humidity_2m + "%" : '-' }}
</td>
</tr>
<tr @click="toggleRowHighlight('discomfort')" :class="['row-clickable', { 'row-highlighted': highlightedRow === 'discomfort' }]">
<td><strong>😰 不快指数</strong></td>
<td v-for="hour in hours" :key="hour" :class="{ 'current-time-highlight': isCurrentHour(hour) }">
<div style="font-size: 0.9em; font-weight: bold;">
{{ calculateDiscomfortIndex(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m) !== null ? calculateDiscomfortIndex(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m) : '-' }}
</div>
<div style="font-size: 0.8em; color: #666; margin-top: 2px;">
{{ discomfortLevel(calculateDiscomfortIndex(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m)) }}
</div>
</td>
</tr>
<tr @click="toggleRowHighlight('clothing')" :class="['row-clickable', { 'row-highlighted': highlightedRow === 'clothing' }]">
<td><strong>👕 服装指数</strong></td>
<td v-for="hour in hours" :key="hour" :class="{ 'current-time-highlight': isCurrentHour(hour) }">
<div class="clothing-index-cell">
<span class="clothing-index-icon">{{ clothingIcon(weatherData[hour]?.apparent_temperature, hour) }}</span>
<span class="clothing-index-label">{{ clothingLabel(weatherData[hour]?.apparent_temperature, hour) }}</span>
</div>
</td>
</tr>
</tbody>
</table>
<table v-if="hasWeatherData" class="mobile-table">
<thead>
<tr>
<th>⛅<br>天気</th>
<th @click="toggleRowHighlight('precipitation')" :class="['row-clickable', { 'row-highlighted': highlightedRow === 'precipitation' }]">🌧️<br>降水確率</th>
<th @click="toggleRowHighlight('temperature')" :class="['row-clickable', { 'row-highlighted': highlightedRow === 'temperature' }]">🌡️<br>気温</th>
<th @click="toggleRowHighlight('apparent_temperature')" :class="['row-clickable', { 'row-highlighted': highlightedRow === 'apparent_temperature' }]">🤒<br>体感温度</th>
<th @click="toggleRowHighlight('humidity')" :class="['row-clickable', { 'row-highlighted': highlightedRow === 'humidity' }]">💧<br>湿度</th>
<th @click="toggleRowHighlight('discomfort')" :class="['row-clickable', { 'row-highlighted': highlightedRow === 'discomfort' }]">😰<br>不快指数</th>
<th @click="toggleRowHighlight('clothing')" :class="['row-clickable', { 'row-highlighted': highlightedRow === 'clothing' }]">👕<br>服装</th>
</tr>
</thead>
<tbody>
<tr v-for="hour in hours" :key="hour" :class="{ 'current-time-highlight': isCurrentHour(hour) }" :id="`mobile-hour-${hour}`">
<td>
<span class="weather-emoji">{{ weatherIcon(weatherData[hour]?.weather_code, weatherData[hour]?.precipitation_probability) }}</span><br>
{{ hour }}:00
</td>
<td :class="{ 'row-highlighted': highlightedRow === 'precipitation' }">
<div class="progress-container">
<div class="progress-bar" :style="{ width: (weatherData[hour]?.precipitation_probability ?? 0) + '%' }"></div>
</div>
{{ weatherData[hour]?.precipitation_probability !== undefined ? weatherData[hour].precipitation_probability + "%" : '-' }}
</td>
<td :class="[temperatureClass(weatherData[hour]?.temperature_2m), { 'row-highlighted': highlightedRow === 'temperature' }]">
{{ weatherData[hour]?.temperature_2m !== undefined ? weatherData[hour].temperature_2m + "℃" : '-' }}
</td>
<td :class="[temperatureClass(weatherData[hour]?.apparent_temperature), { 'row-highlighted': highlightedRow === 'apparent_temperature' }]">
{{ weatherData[hour]?.apparent_temperature !== undefined ? weatherData[hour].apparent_temperature + "℃" : '-' }}
</td>
<td :class="{ 'row-highlighted': highlightedRow === 'humidity' }">
{{ weatherData[hour]?.relative_humidity_2m !== undefined ? weatherData[hour].relative_humidity_2m + "%" : '-' }}
</td>
<td :class="{ 'row-highlighted': highlightedRow === 'discomfort' }">
<div style="font-size: 0.8em; font-weight: bold;">
{{ calculateDiscomfortIndex(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m) !== null ? calculateDiscomfortIndex(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m) : '-' }}
</div>
<div style="font-size: 0.7em; color: #666;">
{{ discomfortLevel(calculateDiscomfortIndex(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m)) }}
</div>
</td>
<td :class="{ 'row-highlighted': highlightedRow === 'clothing' }">
<div class="clothing-index-cell">
<span class="clothing-index-icon">{{ clothingIcon(weatherData[hour]?.apparent_temperature, hour) }}</span>
<span class="clothing-index-label">{{ clothingLabel(weatherData[hour]?.apparent_temperature, hour) }}</span>
</div>
</td>
</tr>
</tbody>
</table>
<div v-if="!hasWeatherData && !errorMessage" class="no-data-message">
🗺️地図をクリックして天気データを取得してください
</div>
</div>
</div>
</div>
<footer class="footer">
<small>&copy; 2025 nokotubo</small>
</footer>
<div v-if="showContextMenu" class="context-menu-overlay" @click="closeContextMenu">
<div class="context-menu" @click.stop :style="{ left: contextMenuPosition.x + 'px', top: contextMenuPosition.y + 'px' }">
<div class="context-menu-header">メモリ{{ getMemoryNumber(contextMenuIndex) }}</div>
<div v-if="!isMemorySlotSaved(contextMenuIndex)" class="context-menu-item register-item" @click="openSaveDialog">
<i class="fas fa-plus"></i>位置を登録
</div>
<div v-if="isMemorySlotSaved(contextMenuIndex)" class="context-menu-item delete-item" @click="confirmDeleteMemory">
<i class="fas fa-trash"></i>削除
</div>
</div>
</div>
<div v-if="showSaveDialog" class="location-save-modal" @click="closeSaveDialog">
<div class="location-save-content" @click.stop>
<div class="location-save-title">位置を登録</div>
<input v-model="saveLocationName" class="location-save-input" placeholder="例: 自宅、職場、学校..." @keyup.enter="saveLocationMemory" ref="saveLocationInput" maxlength="20">
<div class="location-save-buttons">
<button class="location-save-btn save-btn" @click="saveLocationMemory">登録</button>
<button class="location-save-btn cancel-btn" @click="closeSaveDialog">キャンセル</button>
</div>
</div>
</div>
</div>
<script src="https://unpkg.com/vue@3.0.0"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
<script>
const{createApp,ref,reactive,onMounted,computed,nextTick,watch,onUnmounted}=Vue;createApp({setup(){const map=ref(null),marker=ref(null),selectedLatLng=reactive({lat:34.6937,lng:135.5023}),dateList=ref([]),selectedDateIndex=ref(0),weatherData=reactive({}),errorMessage=ref(''),currentAddress=ref(''),hours=Array.from({length:17},(_,i)=>i+6),tableContainer=ref(null),addressCache=new Map,addressRequestInProgress=ref(false),showContextMenu=ref(false),contextMenuPosition=reactive({x:0,y:0}),contextMenuIndex=ref(0),showSaveDialog=ref(false),locationMemories=ref(Array.from({length:5},()=>({name:'',lat:null,lng:null,address:''}))),saveLocationName=ref(''),saveLocationIndex=ref(0),longPressTimer=ref(null),saveLocationInput=ref(null),showMap=ref(false),windowWidth=ref(window.innerWidth),selectedMemoryIndex=ref(-1),highlightedRow=ref(''),isMobile=computed(()=>windowWidth.value<=600),hasWeatherData=computed(()=>Object.keys(weatherData).length>0),updateWindowWidth=()=>windowWidth.value=window.innerWidth,getMemoryNumber=i=>['①','②','③','④','⑤'][i]||`${i+1}`,isMemorySlotSaved=i=>{const m=locationMemories.value[i];return m.name&&m.lat&&m.lng},toggleMap=()=>{showMap.value=!showMap.value;showMap.value&&map.value&&setTimeout(()=>map.value.invalidateSize(),100)},toggleRowHighlight=rowType=>{highlightedRow.value=highlightedRow.value===rowType?'':rowType},startLongPress=(i,e)=>{longPressTimer.value&&clearTimeout(longPressTimer.value);longPressTimer.value=setTimeout(()=>{if(!selectedLatLng.lat||!selectedLatLng.lng){errorMessage.value='先に地図をクリックして位置を選択してください';setTimeout(()=>errorMessage.value='',3000);return}showContextMenuDialog(i,e)},600)},showContextMenuDialog=(i,e)=>{contextMenuIndex.value=i;let clientX,clientY;if(e&&e.type.startsWith('touch')){const t=e.touches[0]||e.changedTouches[0];clientX=t.clientX;clientY=t.clientY}else if(e){clientX=e.clientX;clientY=e.clientY}else{clientX=windowWidth.value/2;clientY=window.innerHeight/2}const w=180,h=120;let x=clientX,y=clientY;x+w>windowWidth.value-20&&(x=windowWidth.value-w-20);y+h>window.innerHeight-20&&(y=clientY-h-10);contextMenuPosition.x=Math.max(20,x);contextMenuPosition.y=Math.max(20,y);showContextMenu.value=true},openSaveDialog=()=>{saveLocationIndex.value=contextMenuIndex.value;saveLocationName.value='';closeContextMenu();showSaveDialog.value=true;nextTick(()=>setTimeout(()=>saveLocationInput.value&&saveLocationInput.value.focus(),200))},confirmDeleteMemory=()=>{const m=locationMemories.value[contextMenuIndex.value];confirm(`「${m.name}」を削除しますか？`)&&deleteLocationMemory();closeContextMenu()},deleteLocationMemory=()=>{selectedMemoryIndex.value===contextMenuIndex.value&&(selectedMemoryIndex.value=-1);locationMemories.value[contextMenuIndex.value]={name:'',lat:null,lng:null,address:''};saveLocationMemoriesToStorage();errorMessage.value='メモリーを削除しました';setTimeout(()=>errorMessage.value='',2000)},closeContextMenu=()=>{showContextMenu.value=false;contextMenuPosition.x=0;contextMenuPosition.y=0;contextMenuIndex.value=0},closeSaveDialog=()=>{showSaveDialog.value=false;saveLocationName.value='';saveLocationIndex.value=0},endLongPress=()=>{longPressTimer.value&&(clearTimeout(longPressTimer.value),longPressTimer.value=null)},getJSTDateString=(d=new Date)=>{const y=d.getFullYear(),m=String(d.getMonth()+1).padStart(2,'0'),day=String(d.getDate()).padStart(2,'0');return`${y}-${m}-${day}`},refreshDateAndWeather=()=>{const now=new Date,arr=[];for(let i=0;i<=7;i++){const t=new Date(now);t.setDate(now.getDate()+i);arr.push(getJSTDateString(t))}dateList.value=[...arr];selectedDateIndex.value=0;selectedLatLng.lat&&selectedLatLng.lng&&fetchWeatherData()},isCurrentHour=h=>0===selectedDateIndex.value&&new Date().getHours()===h,scrollToCurrentTime=()=>{if(0!==selectedDateIndex.value)return;const now=new Date,h=now.getHours();h<6||h>22||windowWidth.value>600||setTimeout(()=>{const el=document.getElementById(`mobile-hour-${h}`);if(el&&tableContainer.value){const c=tableContainer.value,rect=c.getBoundingClientRect(),abs=el.offsetTop,vh=rect.height,rh=el.offsetHeight,target=abs-vh/2+rh/2;c.scrollTo({top:Math.max(0,target),behavior:'smooth'})}},1000)};watch(hasWeatherData,v=>v&&scrollToCurrentTime());const temperatureClass=t=>void 0===t||null===t?'':t>=35?'hot-temperature':t<=0?'cold-temperature':'',weatherIcon=(c,p)=>{if(void 0!==p){if(p<=10)return 0===c?'☀️':'⛅';if(p>=50)return'☔';if(p>=30)return'🌧️';if(p>=11)return'🌦️';return'⛅'}if(void 0===c||null===c)return'☀️';const icons={0:'☀️',1:'⛅',2:'⛅',3:'⛅',45:'🌫️',48:'🌫️',51:'🌦️',53:'🌦️',55:'🌦️',56:'🌨️',57:'🌨️',61:'🌧️',63:'🌧️',65:'🌧️',66:'🌨️',67:'🌨️',71:'❄️',73:'❄️',75:'❄️',77:'❄️',80:'🌦️',81:'🌦️',82:'🌦️',85:'🌨️',86:'🌨️',95:'⛈️',96:'⛈️',99:'⛈️'};return icons[c]||'☀️'},calculateDiscomfortIndex=(t,h)=>void 0===t||null===t||void 0===h||null===h?null:Math.round((0.81*t+0.01*h*(0.99*t-14.3)+46.3)*10)/10,discomfortLevel=d=>null===d||void 0===d?'-':d<55?'寒い':d<60?'肌寒い':d<65?'何も感じない':d<70?'快い':d<75?'暑くない':d<80?'やや暑い':d<85?'暑くて汗が出る':'暑くてたまらない',loadLocationMemoriesFromStorage=()=>{const s=localStorage.getItem('fukuanvi-location-memories');if(s)try{locationMemories.value=JSON.parse(s)}catch(e){console.error('位置メモリーの読み込みに失敗:',e)}},saveLocationMemoriesToStorage=()=>localStorage.setItem('fukuanvi-location-memories',JSON.stringify(locationMemories.value)),saveLocationMemory=()=>{const n=saveLocationName.value.trim();n&&n.length<=20?(locationMemories.value[saveLocationIndex.value]={name:n,lat:selectedLatLng.lat,lng:selectedLatLng.lng,address:currentAddress.value},saveLocationMemoriesToStorage(),closeSaveDialog()):n?errorMessage.value='位置名は20文字以内で入力してください。':saveLocationInput.value&&saveLocationInput.value.focus();n||(errorMessage.value&&setTimeout(()=>errorMessage.value='',3000))},loadLocationMemory=i=>{const m=locationMemories.value[i];m.name&&m.lat&&m.lng&&(selectedMemoryIndex.value=i,selectedLatLng.lat=m.lat,selectedLatLng.lng=m.lng,currentAddress.value='位置情報取得中...',map.value&&(map.value.setView([m.lat,m.lng],10),updateMarker()),fetchAddress(m.lat,m.lng),fetchWeatherData())},fetchAddress=async(lat,lng)=>{const k=`${lat.toFixed(3)},${lng.toFixed(3)}`;if(addressCache.has(k))return void(currentAddress.value=addressCache.get(k));if(addressRequestInProgress.value)return;addressRequestInProgress.value=true;try{const c=new AbortController,tid=setTimeout(()=>c.abort(),3000),r=await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json&addressdetails=1&accept-language=ja&zoom=10`,{signal:c.signal});if(clearTimeout(tid),!r.ok)throw new Error('住所取得に失敗');const d=await r.json(),a=d.address;let display='位置を選択';if(a){const pref=a.state||a.prefecture||'',city=a.city||a.town||a.village||a.municipality||'';display=pref&&city?`${pref} ${city}`:pref||city}addressCache.size>=100&&addressCache.delete(addressCache.keys().next().value);addressCache.set(k,display);currentAddress.value=display}catch(e){currentAddress.value='位置を選択'}finally{addressRequestInProgress.value=false}},initMap=()=>{const el=document.getElementById('map');if(!el)return;map.value&&(map.value.remove(),map.value=null);try{map.value=L.map('map',{preferCanvas:true,zoomControl:true}).setView([selectedLatLng.lat,selectedLatLng.lng],8);L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'© OpenStreetMap contributors',loading:'lazy'}).addTo(map.value);const icon=L.divIcon({html:'<div style="background: linear-gradient(135deg, #3385ff, #0059b3); color: white; width: 32px; height: 32px; border-radius: 50% 50% 50% 0; transform: rotate(-45deg); display: flex; align-items: center; justify-content: center; box-shadow: 0 3px 8px rgba(51, 133, 255, 0.4); border: 3px solid white;"><i class="fas fa-shirt" style="transform: rotate(45deg); font-size: 14px;"></i></div>',className:'custom-location-marker',iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]});marker.value=L.marker([selectedLatLng.lat,selectedLatLng.lng],{icon}).addTo(map.value);map.value.on('click',e=>{selectedMemoryIndex.value=-1;selectedLatLng.lat=e.latlng.lat;selectedLatLng.lng=e.latlng.lng;updateMarker();fetchWeatherData();fetchAddress(e.latlng.lat,e.latlng.lng)});setTimeout(()=>map.value&&map.value.invalidateSize(),100)}catch(e){errorMessage.value='地図の初期化に失敗しました。ページを再読み込みしてください。'}},updateMarker=()=>marker.value&&marker.value.setLatLng([selectedLatLng.lat,selectedLatLng.lng]),getCurrentLocation=()=>{if(!navigator.geolocation)return void(errorMessage.value='❌ このデバイスは位置情報に対応していません。\n手動で地図をクリックして位置を選択してください。');selectedMemoryIndex.value=-1;currentAddress.value='🔄 位置情報取得中...';errorMessage.value='';const opts={enableHighAccuracy:true,timeout:15000,maximumAge:60000};navigator.geolocation.getCurrentPosition(pos=>{selectedLatLng.lat=pos.coords.latitude;selectedLatLng.lng=pos.coords.longitude;map.value&&(map.value.setView([selectedLatLng.lat,selectedLatLng.lng],12),updateMarker());fetchWeatherData();fetchAddress(pos.coords.latitude,pos.coords.longitude)},err=>{let msg='';switch(err.code){case err.PERMISSION_DENIED:msg='🚫 位置情報のアクセスが拒否されました。\n\n【解決方法】\n1. ブラウザのアドレスバー左の🔒マークをタップ\n2. 位置情報を「許可」に変更\n3. ページを再読み込みして再度お試しください';break;case err.POSITION_UNAVAILABLE:msg='📍 位置情報を取得できません。\n\n【確認事項】\n• GPSがオンになっているか\n• 屋外にいるか（屋内では取得困難）\n• 機内モードがオフになっているか';break;case err.TIMEOUT:msg='⏱️ 位置情報の取得がタイムアウトしました。\n\n【お試しください】\n• 電波の良い場所に移動\n• 少し時間をおいて再度実行\n• 手動で地図をクリックして位置選択';break;default:msg=`❌ 位置情報取得エラー\n\nエラーコード: ${err.code}\nメッセージ: ${err.message}\n\n手動で地図をクリックして位置を選択してください。`}errorMessage.value=msg;currentAddress.value='位置を選択';setTimeout(()=>errorMessage.value='',15000)},opts)},generateDateList=()=>{const today=new Date;dateList.value=[];for(let i=0;i<=7;i++){const d=new Date(today);d.setDate(today.getDate()+i);dateList.value.push(getJSTDateString(d))}},dateLabel=(s,i)=>0===i?'今日':1===i?'明日':2===i?'明後日':`${i}日後`,formatDateDetail=s=>{const d=new Date(s),m=d.getMonth()+1,day=d.getDate(),w=d.toLocaleDateString('ja-JP',{weekday:'short'});return`${m}/${day}（${w}）`},selectDate=i=>{selectedDateIndex.value=i;selectedLatLng.lat&&selectedLatLng.lng&&fetchWeatherData()},fetchWeatherData=()=>{errorMessage.value='';Object.keys(weatherData).forEach(k=>delete weatherData[k]);const d=dateList.value[selectedDateIndex.value],lat=selectedLatLng.lat.toFixed(4),lng=selectedLatLng.lng.toFixed(4),url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lng}&hourly=temperature_2m,apparent_temperature,relative_humidity_2m,precipitation_probability,weather_code&start_date=${d}&end_date=${d}&timezone=Asia/Tokyo`,c=new AbortController,tid=setTimeout(()=>c.abort(),15000);fetch(url,{signal:c.signal}).then(r=>{if(clearTimeout(tid),!r.ok)throw new Error('天気データの取得に失敗しました。インターネット接続を確認してください。');return r.json()}).then(data=>{if(!data.hourly)throw new Error('天気データの解析に失敗しました。しばらく時間をおいて再試行してください。');for(const h of hours){const idx=data.hourly.time.findIndex(t=>t.endsWith(`T${h.toString().padStart(2,'0')}:00`));-1!==idx&&(weatherData[h]={temperature_2m:Math.round(data.hourly.temperature_2m[idx]),apparent_temperature:Math.round(data.hourly.apparent_temperature[idx]),relative_humidity_2m:Math.round(data.hourly.relative_humidity_2m[idx]),precipitation_probability:Math.round(data.hourly.precipitation_probability[idx]||0),weather_code:data.hourly.weather_code[idx]})}}).catch(e=>{clearTimeout(tid);errorMessage.value='AbortError'===e.name?'天気データの取得がタイムアウトしました。再試行してください。':e.message;setTimeout(()=>errorMessage.value='',8000)})},clothingIcon=(t,h)=>{if(void 0===t||null===t)return'';let adj=t;h>=6&&h<=9||h>=18&&h<=21?adj-=1.5:(h>=22||h<=5)&&(adj-=1);return adj>=35?'🧘‍♂️':adj>=30?'🏋️‍♂️':adj>=27?'👕':adj>=24?'👔':adj>=21?'🦺':'🧥'},clothingLabel=(t,h)=>{if(void 0===t||null===t)return'-';let adj=t;h>=6&&h<=9||h>=18&&h<=21?adj-=1.5:(h>=22||h<=5)&&(adj-=1);return adj>=35?'全裸レベル':adj>=30?'タンクトップ':adj>=27?'半袖Tシャツ':adj>=24?'長袖Tシャツ':adj>=21?'薄手カーディガン':adj>=18?'セーター':adj>=15?'パーカー':adj>=12?'ジャケット':adj>=9?'コート':adj>=6?'厚手コート':adj>=3?'ダウンジャケット':'防寒着完全装備'};onMounted(()=>{generateDateList();const now=new Date;now.getHours()>=21&&(selectedDateIndex.value=1);window.addEventListener('resize',updateWindowWidth);nextTick(()=>setTimeout(()=>{initMap();loadLocationMemoriesFromStorage();locationMemories.value[0].name&&locationMemories.value[0].lat&&locationMemories.value[0].lng?(selectedMemoryIndex.value=0,selectedLatLng.lat=locationMemories.value[0].lat,selectedLatLng.lng=locationMemories.value[0].lng,map.value&&(map.value.setView([selectedLatLng.lat,selectedLatLng.lng],10),updateMarker()),fetchAddress(selectedLatLng.lat,selectedLatLng.lng),fetchWeatherData()):fetchWeatherData()},200))});onUnmounted(()=>window.removeEventListener('resize',updateWindowWidth));return{dateList,selectedDateIndex,selectDate,dateLabel,formatDateDetail,weatherData,hours,clothingIcon,clothingLabel,weatherIcon,calculateDiscomfortIndex,discomfortLevel,errorMessage,hasWeatherData,getCurrentLocation,currentAddress,isCurrentHour,temperatureClass,locationMemories,showSaveDialog,saveLocationName,saveLocationInput,startLongPress,endLongPress,saveLocationMemory,closeSaveDialog,loadLocationMemory,refreshDateAndWeather,tableContainer,scrollToCurrentTime,getMemoryNumber,showContextMenu,contextMenuPosition,contextMenuIndex,isMemorySlotSaved,openSaveDialog,confirmDeleteMemory,deleteLocationMemory,closeContextMenu,showMap,toggleMap,isMobile,selectedMemoryIndex,highlightedRow,toggleRowHighlight}}}).mount('#app');'serviceWorker'in navigator&&('https:'===location.protocol||'localhost'===location.hostname)&&window.addEventListener('load',()=>navigator.serviceWorker.register('/sw.js').then(r=>console.log('SW registered: ',r)).catch(e=>console.log('SW registration failed: ',e)))
</script>
</body>
</html>
