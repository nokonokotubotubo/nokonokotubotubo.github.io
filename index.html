<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Fuku„Å™„Å≥ - Â§©Ê∞ó‰∫àÂ†±„Ç¢„Éó„É™</title>
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#3385ff">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Fuku„Å™„Å≥">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
*{box-sizing:border-box}html,body,#app{height:100vh;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif}body{background:#e6f2ff;overflow:hidden}#app{display:flex;flex-direction:column;background:#fff}.th{background:linear-gradient(135deg,#66a3ff,#3385ff,#0059b3);border-radius:0 0 10px 10px;padding:8px 0;text-align:center;box-shadow:0 2px 6px rgba(0,89,179,.1);flex:0 0 31px;display:flex;align-items:center;position:relative}.tc{display:flex;align-items:center;justify-content:center;gap:6px;height:100%;width:100%}.ti{font-size:1.4em;color:#fff;text-shadow:0 2px 4px rgba(0,0,0,.2)}.tt{color:#fff;font-size:1.1em;font-weight:bold;letter-spacing:2px;line-height:1.2}.mc{display:none}.dr{display:flex;align-items:center;gap:10px;margin:6px 0 6px 2vw;flex:0 0 36px;flex-wrap:wrap}.la{width:8em;font-size:.9em;color:#0059b3;background:#f0f8ff;padding:4px 8px;border-radius:3px;border:1px solid #cce0ff;margin-right:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.rb{margin-left:auto;margin-right:10px;padding:7px 12px;border:1.2px solid #66a3ff;border-radius:5px;background:#cce0ff;color:#003366;font-size:.8em;cursor:pointer;transition:all .2s;white-space:nowrap;font-weight:600;user-select:none}.rb:hover{background:#99c2ff;border-color:#3385ff;transform:translateY(-1px)}.mg,.dg{display:flex;align-items:center;gap:8px;margin-left:30px;min-height:40px}.mgi,.dgi{font-size:1.2em;color:#0059b3;width:1.5em;height:1.5em;display:flex;align-items:center;justify-content:center;margin-right:4px}.mbs,.dbs{display:flex;gap:5px;flex-wrap:wrap}.mb,.db{padding:7px 12px;border:1.2px solid #66a3ff;border-radius:5px;background:#cce0ff;color:#003366;font-size:.85em;cursor:pointer;transition:all .2s ease;min-width:70px;text-align:center;position:relative;user-select:none;font-weight:600;white-space:pre-line;line-height:1.1;box-shadow:0 1px 3px rgba(0,0,0,.1);display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:36px}.mb:hover,.db:hover{background:#99c2ff;border-color:#3385ff;transform:translateY(-1px);box-shadow:0 2px 6px rgba(51,133,255,.2)}.mb.saved,.db.active{background:#3385ff;color:#fff;border-color:#0059b3;box-shadow:0 2px 8px rgba(51,133,255,.22)}.mb.saved:hover,.db.active:hover{background:#0059b3;transform:translateY(-1px);box-shadow:0 3px 10px rgba(51,133,255,.3)}.db{font-size:.95em;min-width:70px}.dbc{display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:.85em;line-height:1.1;width:100%}.dl{font-weight:bold;margin-bottom:2px;text-align:center;width:100%}.dd{font-size:1.2em;font-weight:600;width:100%;font-family:'Hiragino Sans','„Éí„É©„ÇÆ„ÉéËßí„Ç¥„Ç∑„ÉÉ„ÇØ','Yu Gothic UI','Meiryo UI','MS UI Gothic',sans-serif;letter-spacing:2px;color:#003366;text-shadow:0 1px 2px rgba(51,133,255,.1);text-align:center}.db.active .dd{color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.2)}.mcnt{flex:1;display:flex;flex-direction:column;height:100%;width:100vw;min-height:0}.ma{flex:0 0 39%;min-height:260px;max-height:45.5vh;position:relative;width:100vw;background:#e6f2ff;border-bottom:2px solid #99c2ff;display:flex;align-items:stretch;justify-content:center}#map{flex:1;min-width:0;min-height:260px;width:100vw;height:100%;border-radius:8px;border:2px solid #99c2ff;margin:0}.clb{position:absolute;bottom:12px;left:12px;z-index:1000;padding:8px 16px;background:linear-gradient(135deg,#66a3ff,#3385ff);color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:1em;box-shadow:0 3px 8px rgba(51,133,255,.25);transition:all .3s ease;user-select:none;outline:none}.clb:hover{background:linear-gradient(135deg,#3385ff,#0059b3);transform:translateY(-2px);box-shadow:0 5px 15px rgba(51,133,255,.35)}.ta{flex:0 0 61%;overflow:hidden;display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch;background:#fff;padding-top:6px;min-height:0}.em{color:#dc2626;background:linear-gradient(135deg,#fef2f2,#fee2e2);border:1px solid #fca5a5;border-radius:8px;padding:12px 16px;margin-bottom:12px;font-weight:600;font-size:1em;width:90vw;margin:0 auto 12px;box-shadow:0 2px 8px rgba(220,38,38,.1)}.tcon{width:99vw;height:100%;overflow:auto;margin:0 auto;display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch;background:#fff}table{width:100%;border-collapse:collapse;font-size:14px;table-layout:auto;background:#f8fbff}th,td{border:1px solid #99c2ff;padding:18px 6px;text-align:center;color:#003366;font-size:14px;white-space:normal;word-break:break-word}th{background:linear-gradient(135deg,#f0f8ff,#e6f2ff);font-weight:bold;position:sticky;top:0;z-index:10}.cth{background-color:rgba(255,235,153,.3)!important}.ht{background:#dc2626!important;color:#fff!important;font-weight:bold}.ct{background:#1e40af!important;color:#fff!important;font-weight:bold}.we{font-size:2.25em;vertical-align:middle;filter:drop-shadow(0 1px 2px rgba(0,0,0,.1))}.pc{background:#e6f2ff;border-radius:6px;width:100%;height:14px;position:relative;margin:1px 0;overflow:hidden}.pb{height:100%;background:linear-gradient(135deg,#3385ff,#0059b3);border-radius:6px;transition:width .4s ease;position:relative}.ndm{text-align:center;padding:16px;color:#64748b;background:linear-gradient(135deg,#f8fafc,#f1f5f9);border-radius:8px;border:1px solid #e2e8f0;font-size:1em;width:90vw;margin:0 auto;box-shadow:0 2px 8px rgba(0,0,0,.05)}.cic{display:flex;flex-direction:column;align-items:center;justify-content:center;line-height:1.2}.cii{font-size:2.25em;margin-bottom:2px;filter:drop-shadow(0 1px 2px rgba(0,0,0,.1))}.cil{font-size:.96em;margin-top:2px;word-break:break-word;font-weight:500}.mt{display:none}.ft{background:linear-gradient(135deg,#f8fafc,#e2e8f0);border-top:1px solid #cbd5e1;padding:12px 0;text-align:center;position:relative;z-index:1}.ft small{color:#64748b;font-size:.875em;font-weight:500;letter-spacing:.5px}.cmo{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.3);z-index:999998;backdrop-filter:blur(2px)}.cm{position:absolute;background:#fff;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,.3),0 2px 8px rgba(0,0,0,.1);min-width:180px;overflow:hidden;border:1px solid rgba(51,133,255,.2);animation:cmfi .2s ease-out}.cmh{background:linear-gradient(135deg,#f0f8ff,#e6f2ff);color:#0059b3;font-weight:bold;font-size:.9em;padding:12px 16px;text-align:center;border-bottom:1px solid #e0e9ff}.cmi{padding:14px 18px;cursor:pointer;display:flex;align-items:center;gap:12px;font-size:1em;font-weight:500;transition:all .2s ease;user-select:none;border-bottom:1px solid #f0f0f0}.cmi:last-child{border-bottom:none}.cmi i{font-size:1.1em;width:16px;text-align:center}.ri{color:#0059b3}.ri:hover{background:linear-gradient(135deg,#f0f8ff,#e6f2ff);color:#003d80}.di{color:#dc2626}.di:hover{background:linear-gradient(135deg,#fef2f2,#fee2e2);color:#b91c1c}.lsm{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.65);display:flex;align-items:center;justify-content:center;z-index:999999;backdrop-filter:blur(3px);animation:mbfi .3s ease-out}.lsc{background:#fff;padding:28px;border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.3),0 4px 12px rgba(0,0,0,.1);max-width:340px;width:88%;max-height:85vh;overflow-y:auto;position:relative;margin:20px;border:1px solid rgba(51,133,255,.1);animation:mcfi .3s ease-out}.lst{color:#0059b3;font-weight:bold;font-size:1.2em;margin-bottom:20px;text-align:center;line-height:1.4;display:flex;align-items:center;justify-content:center;gap:8px}.lst::before{content:"üìç";font-size:1.1em}.lsi{width:100%;padding:14px 16px;border:2px solid #e0e9ff;border-radius:10px;margin-bottom:24px;font-size:1em;outline:none;transition:all .3s ease;background:#fafcff;font-family:inherit}.lsi:focus{border-color:#3385ff;background:#fff;box-shadow:0 0 0 4px rgba(51,133,255,.1),0 2px 8px rgba(51,133,255,.15);transform:translateY(-1px)}.lsbs{display:flex;gap:14px;justify-content:center;flex-wrap:wrap}.lsb{padding:14px 24px;border:none;border-radius:10px;cursor:pointer;font-weight:600;font-size:1em;transition:all .3s ease;min-width:100px;text-align:center;user-select:none;position:relative;overflow:hidden;font-family:inherit}.sb{background:linear-gradient(135deg,#3385ff,#0059b3);color:#fff;box-shadow:0 4px 12px rgba(51,133,255,.3)}.sb:hover{background:linear-gradient(135deg,#0059b3,#003d80);transform:translateY(-2px);box-shadow:0 6px 20px rgba(51,133,255,.4)}.cb{background:linear-gradient(135deg,#f1f5f9,#e2e8f0);color:#475569;border:1px solid #cbd5e1;box-shadow:0 2px 6px rgba(0,0,0,.1)}.cb:hover{background:linear-gradient(135deg,#e2e8f0,#cbd5e1);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.15)}@keyframes cmfi{from{opacity:0;transform:scale(.8)translateY(-10px)}to{opacity:1;transform:scale(1)translateY(0)}}@keyframes mbfi{from{opacity:0}to{opacity:1}}@keyframes mcfi{from{opacity:0;transform:scale(.85)translateY(-30px)}to{opacity:1;transform:scale(1)translateY(0)}}@media(max-width:900px){.th{flex:0 0 28px}.tt{font-size:1em}.ti{font-size:1.2em}th,td{font-size:13px;padding:6px 3px}.dr{margin:6px 0 6px 1vw}.ma{flex:0 0 32.5%;min-height:234px;max-height:39vh}.ta{flex:0 0 67.5%}.we{font-size:2.34em}.cii{font-size:2.34em}#map{min-height:234px}.mb{padding:6px 10px;font-size:.88em;min-width:60px;min-height:34px}.mg,.dg{min-height:36px}}@media(max-width:600px){.tt{font-size:.9em;letter-spacing:.5px}.ti{font-size:1.1em}.la{display:none}.mb{padding:6px 10px;font-size:.8em;min-width:55px;min-height:32px}.rb{display:none}.mg{margin-left:5px}.dr{margin:6px 0 6px 1vw;align-items:center}.dg{margin-left:8px}.dbc{font-size:.75em}.dd{font-size:1.1em;letter-spacing:1px}.db{min-width:60px}.mgi,.dgi{font-size:1.1em;margin-right:4px;width:1.3em;height:1.3em}.mg,.dg{min-height:36px}.ma{flex:0 0 26%;min-height:208px;max-height:39vh}#map{min-height:208px}.ta{flex:0 0 74%;overflow:hidden;position:relative}.dt{display:none}.mt{display:table;width:100%;table-layout:fixed;border-spacing:0;margin:0}.tcon{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;overflow:auto;background:#fff;padding:0 0 120px 0}.mt td{padding:12px 4px;font-size:11px;line-height:1.4;vertical-align:middle;height:auto;min-height:48px}.mt th{font-size:11px;padding:6px 3px}.mt .we{font-size:2.2em}.mt .cii{font-size:2.2em}.mt .cil{font-size:.75em}.mt .pc{height:12px}.mt tr:last-child td{padding-bottom:20px}.lsc{width:92%;margin:8px;padding:24px;border-radius:12px}.lsi{font-size:16px;padding:16px}.lsbs{flex-direction:row;gap:12px}.lsb{flex:1;min-width:0;padding:16px 20px;font-size:1.05em}.dbs .db:nth-child(n+4){display:none}.ft{display:none}.mc{display:block;position:absolute;top:50%;right:8px;transform:translateY(-50%);z-index:5000;line-height:1;font-size:.65em;color:rgba(255,255,255,.8);font-weight:500;text-shadow:0 1px 2px rgba(0,0,0,.2);user-select:none;pointer-events:none;font-family:Verdana,"Droid Sans","„É°„Ç§„É™„Ç™",Meiryo,sans-serif}}@media(max-width:400px){.lsbs{flex-direction:column}.lsb{width:100%}.lsc{padding:20px;margin:6px}.ma{flex:0 0 20.8%;min-height:156px}.ta{flex:0 0 79.2%}.mgi,.dgi{font-size:1em;margin-right:3px;width:1.2em;height:1.2em}.mc{right:6px;font-size:.6em}}
</style>
</head>
<body>
<div id="app">
<div class="th">
<div class="tc">
<i class="fas fa-shirt ti"></i>
<div class="tt">Fuku„Å™„Å≥ <i class="fas fa-cloud-sun ti"></i></div>
</div>
<div class="mc">&copy; 2025 nokotubo</div>
</div>
<div class="dr">
<div class="la">üìç {{ currentAddress || '‰ΩçÁΩÆ„ÇíÈÅ∏Êäû' }}</div>
<div class="mg">
<div class="mgi">üìí</div>
<div class="mbs">
<button v-for="(memory, index) in locationMemories" :key="index" @click="loadMem(index)" @mousedown="startPress(index, $event)" @mouseup="endPress" @mouseleave="endPress" @touchstart="startPress(index, $event)" @touchend="endPress" :class="['mb', { saved: memory.name }]">
{{ memory.name || `„É°„É¢„É™„Éº\n${getMemNum(index)}` }}
</button>
</div>
</div>
<div class="dg">
<div class="dgi">üìÖ</div>
<div class="dbs">
<button v-for="(date, index) in dateList" :key="date" @click="selDate(index)" :class="['db', { active: selectedDateIndex === index }]">
<div class="dbc">
<div class="dl">{{ dateLbl(date, index) }}</div>
<div class="dd">{{ fmtDate(date) }}</div>
</div>
</button>
</div>
</div>
<button class="rb" @click="refresh">üîÑ Êõ¥Êñ∞</button>
</div>
<div class="mcnt">
<div class="ma">
<div id="map">
<button class="clb" @click="getPos" @touchend.prevent="getPos" type="button">üìç ÁèæÂú®Âú∞</button>
</div>
</div>
<div class="ta">
<div v-if="errorMessage" class="em">‚ùå {{ errorMessage }}</div>
<div class="tcon" ref="tableContainer">
<table v-if="hasWeatherData" class="dt">
<thead>
<tr>
<th>‚õÖ Â§©Ê∞ó</th>
<th v-for="hour in hours" :key="hour" :class="{ 'cth': isCurHour(hour) }" :id="`hour-${hour}`">
<span class="we">{{ wIcon(weatherData[hour]?.weather_code, weatherData[hour]?.precipitation_probability) }}</span> {{ hour }}:00
</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>üåßÔ∏è ÈôçÊ∞¥Á¢∫Áéá</strong></td>
<td v-for="hour in hours" :key="hour" :class="{ 'cth': isCurHour(hour) }">
<div class="pc">
<div class="pb" :style="{ width: (weatherData[hour]?.precipitation_probability ?? 0) + '%' }"></div>
</div>
{{ weatherData[hour]?.precipitation_probability !== undefined ? weatherData[hour].precipitation_probability + "%" : '-' }}
</td>
</tr>
<tr>
<td><strong>üå°Ô∏è Ê∞óÊ∏©</strong></td>
<td v-for="hour in hours" :key="hour" :class="[{ 'cth': isCurHour(hour) }, tmpClass(weatherData[hour]?.temperature_2m)]">
{{ weatherData[hour]?.temperature_2m !== undefined ? weatherData[hour].temperature_2m + "‚ÑÉ" : '-' }}
</td>
</tr>
<tr>
<td><strong>ü§í ‰ΩìÊÑüÊ∏©Â∫¶</strong></td>
<td v-for="hour in hours" :key="hour" :class="[{ 'cth': isCurHour(hour) }, tmpClass(weatherData[hour]?.apparent_temperature)]">
{{ weatherData[hour]?.apparent_temperature !== undefined ? weatherData[hour].apparent_temperature + "‚ÑÉ" : '-' }}
</td>
</tr>
<tr>
<td><strong>üíß ÊπøÂ∫¶</strong></td>
<td v-for="hour in hours" :key="hour" :class="{ 'cth': isCurHour(hour) }">
{{ weatherData[hour]?.relative_humidity_2m !== undefined ? weatherData[hour].relative_humidity_2m + "%" : '-' }}
</td>
</tr>
<tr>
<td><strong>üò∞ ‰∏çÂø´ÊåáÊï∞</strong></td>
<td v-for="hour in hours" :key="hour" :class="{ 'cth': isCurHour(hour) }">
<div style="font-size: 0.9em; font-weight: bold;">
{{ calcDI(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m) !== null ? calcDI(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m) : '-' }}
</div>
<div style="font-size: 0.8em; color: #666; margin-top: 2px;">
{{ diLvl(calcDI(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m)) }}
</div>
</td>
</tr>
<tr>
<td><strong>üëï ÊúçË£ÖÊåáÊï∞</strong></td>
<td v-for="hour in hours" :key="hour" :class="{ 'cth': isCurHour(hour) }">
<div class="cic">
<span class="cii">{{ cIcon(weatherData[hour]?.apparent_temperature, hour) }}</span>
<span class="cil">{{ cLbl(weatherData[hour]?.apparent_temperature, hour) }}</span>
</div>
</td>
</tr>
</tbody>
</table>
<table v-if="hasWeatherData" class="mt">
<thead>
<tr>
<th>‚õÖ<br>Â§©Ê∞ó</th>
<th>üåßÔ∏è<br>ÈôçÊ∞¥Á¢∫Áéá</th>
<th>üå°Ô∏è<br>Ê∞óÊ∏©</th>
<th>ü§í<br>‰ΩìÊÑüÊ∏©Â∫¶</th>
<th>üíß<br>ÊπøÂ∫¶</th>
<th>üò∞<br>‰∏çÂø´ÊåáÊï∞</th>
<th>üëï<br>ÊúçË£Ö</th>
</tr>
</thead>
<tbody>
<tr v-for="hour in hours" :key="hour" :class="{ 'cth': isCurHour(hour) }" :id="`mobile-hour-${hour}`">
<td>
<span class="we">{{ wIcon(weatherData[hour]?.weather_code, weatherData[hour]?.precipitation_probability) }}</span><br>
{{ hour }}:00
</td>
<td>
<div class="pc">
<div class="pb" :style="{ width: (weatherData[hour]?.precipitation_probability ?? 0) + '%' }"></div>
</div>
{{ weatherData[hour]?.precipitation_probability !== undefined ? weatherData[hour].precipitation_probability + "%" : '-' }}
</td>
<td :class="tmpClass(weatherData[hour]?.temperature_2m)">
{{ weatherData[hour]?.temperature_2m !== undefined ? weatherData[hour].temperature_2m + "‚ÑÉ" : '-' }}
</td>
<td :class="tmpClass(weatherData[hour]?.apparent_temperature)">
{{ weatherData[hour]?.apparent_temperature !== undefined ? weatherData[hour].apparent_temperature + "‚ÑÉ" : '-' }}
</td>
<td>
{{ weatherData[hour]?.relative_humidity_2m !== undefined ? weatherData[hour].relative_humidity_2m + "%" : '-' }}
</td>
<td>
<div style="font-size: 0.8em; font-weight: bold;">
{{ calcDI(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m) !== null ? calcDI(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m) : '-' }}
</div>
<div style="font-size: 0.7em; color: #666;">
{{ diLvl(calcDI(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m)) }}
</div>
</td>
<td>
<div class="cic">
<span class="cii">{{ cIcon(weatherData[hour]?.apparent_temperature, hour) }}</span>
<span class="cil">{{ cLbl(weatherData[hour]?.apparent_temperature, hour) }}</span>
</div>
</td>
</tr>
</tbody>
</table>
<div v-if="!hasWeatherData && !errorMessage" class="ndm">
üó∫Ô∏èÂú∞Âõ≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Â§©Ê∞ó„Éá„Éº„Çø„ÇíÂèñÂæó„Åó„Å¶„Åè„Å†„Åï„ÅÑ
</div>
</div>
</div>
</div>
<footer class="ft">
<small>&copy; 2025 nokotubo</small>
</footer>
<div v-if="showCM" class="cmo" @click="closeCM">
<div class="cm" @click.stop :style="{ left: cmPos.x + 'px', top: cmPos.y + 'px' }">
<div class="cmh">„É°„É¢„É™„Éº{{ getMemNum(cmIdx) }}</div>
<div v-if="!isMemSaved(cmIdx)" class="cmi ri" @click="openSave">
<i class="fas fa-plus"></i>‰ΩçÁΩÆ„ÇíÁôªÈå≤
</div>
<div v-if="isMemSaved(cmIdx)" class="cmi di" @click="confDel">
<i class="fas fa-trash"></i>ÂâäÈô§
</div>
</div>
</div>
<div v-if="showSave" class="lsm" @click="closeSave">
<div class="lsc" @click.stop>
<div class="lst">‰ΩçÁΩÆ„ÇíÁôªÈå≤</div>
<input v-model="saveName" class="lsi" placeholder="‰æã: Ëá™ÂÆÖ„ÄÅËÅ∑Â†¥„ÄÅÂ≠¶Ê†°..." @keyup.enter="saveMem" ref="saveInput" maxlength="20">
<div class="lsbs">
<button class="lsb sb" @click="saveMem">ÁôªÈå≤</button>
<button class="lsb cb" @click="closeSave">„Ç≠„É£„É≥„Çª„É´</button>
</div>
</div>
</div>
</div>
<script src="https://unpkg.com/vue@3.0.0"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
<script>
const{createApp,ref,reactive,onMounted,computed,nextTick,watch}=Vue;createApp({setup(){const map=ref(null),marker=ref(null);const selLL=reactive({lat:34.6937,lng:135.5023});const dateList=ref([]),selDateIdx=ref(0),wData=reactive({});const errorMessage=ref(''),curAddr=ref('');const hours=Array.from({length:17},(_,i)=>i+6);const tCon=ref(null);const addrCache=new Map(),addrReq=ref(false);const showCM=ref(false),cmPos=reactive({x:0,y:0});const cmIdx=ref(0),showSave=ref(false);const lMems=ref([{name:'',lat:null,lng:null,address:''},{name:'',lat:null,lng:null,address:''},{name:'',lat:null,lng:null,address:''}]);const saveName=ref(''),saveIdx=ref(0),longTimer=ref(null),saveInput=ref(null);const hasWeatherData=computed(()=>Object.keys(wData).length>0);const getMemNum=i=>['‚ë†','‚ë°','‚ë¢'][i]||`${i+1}`;const isMemSaved=i=>{const m=lMems.value[i];return m.name&&m.lat&&m.lng;};const startPress=(i,e)=>{if(longTimer.value)clearTimeout(longTimer.value);longTimer.value=setTimeout(()=>{if(!selLL.lat||!selLL.lng){errorMessage.value='ÂÖà„Å´Âú∞Âõ≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶‰ΩçÁΩÆ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ';setTimeout(()=>{errorMessage.value='';},3000);return;}showCMDlg(i,e);},600);};const showCMDlg=(i,e)=>{cmIdx.value=i;let x,y;if(e&&e.type.startsWith('touch')){const t=e.touches[0]||e.changedTouches[0];x=t.clientX;y=t.clientY;}else if(e){x=e.clientX;y=e.clientY;}else{x=window.innerWidth/2;y=window.innerHeight/2;}const w=180,h=120;if(x+w>window.innerWidth-20)x=window.innerWidth-w-20;if(y+h>window.innerHeight-20)y=y-h-10;cmPos.x=Math.max(20,x);cmPos.y=Math.max(20,y);showCM.value=true;};const openSave=()=>{saveIdx.value=cmIdx.value;saveName.value='';closeCM();showSave.value=true;nextTick(()=>{setTimeout(()=>{if(saveInput.value)saveInput.value.focus();},200);});};const confDel=()=>{const m=lMems.value[cmIdx.value];if(confirm(`„Äå${m.name}„Äç„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü`))delMem();closeCM();};const delMem=()=>{lMems.value[cmIdx.value]={name:'',lat:null,lng:null,address:''};saveMemsToStore();errorMessage.value='„É°„É¢„É™„Éº„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü';setTimeout(()=>{errorMessage.value='';},2000);};const closeCM=()=>{showCM.value=false;cmPos.x=0;cmPos.y=0;cmIdx.value=0;};const closeSave=()=>{showSave.value=false;saveName.value='';saveIdx.value=0;};const endPress=()=>{if(longTimer.value){clearTimeout(longTimer.value);longTimer.value=null;}};const getJSTDate=(d=new Date())=>{const y=d.getFullYear();const m=String(d.getMonth()+1).padStart(2,'0');const day=String(d.getDate()).padStart(2,'0');return`${y}-${m}-${day}`;};const refresh=()=>{const now=new Date();const arr=[];for(let i=0;i<=7;i++){const t=new Date(now);t.setDate(now.getDate()+i);arr.push(getJSTDate(t));}dateList.value=[...arr];selDateIdx.value=0;if(selLL.lat&&selLL.lng)fetchWData();};const isCurHour=h=>{if(selDateIdx.value!==0)return false;return new Date().getHours()===h;};const scrollToCur=()=>{if(selDateIdx.value!==0)return;const now=new Date(),h=now.getHours();if(h<6||h>22||window.innerWidth>600)return;setTimeout(()=>{const el=document.getElementById(`mobile-hour-${h}`);if(el&&tCon.value){const c=tCon.value;const rect=c.getBoundingClientRect();const top=c.scrollTop;const abs=el.offsetTop;const vh=rect.height;const rh=el.offsetHeight;const target=abs-(vh/2)+(rh/2);c.scrollTo({top:Math.max(0,target),behavior:'smooth'});}},1000);};watch(hasWeatherData,v=>{if(v)scrollToCur();});const tmpClass=t=>{if(t===undefined||t===null)return'';if(t>=35)return'ht';if(t<=0)return'ct';return'';};const wIcon=(c,p)=>{if(p!==undefined){if(p<=10)return c===0?'‚òÄÔ∏è':'‚õÖ';if(p>=50)return'‚òî';if(p>=30)return'üåßÔ∏è';if(p>=11)return'üå¶Ô∏è';return'‚õÖ';}if(c===undefined||c===null)return'‚òÄÔ∏è';const icons={0:'‚òÄÔ∏è',1:'‚õÖ',2:'‚õÖ',3:'‚õÖ',45:'üå´Ô∏è',48:'üå´Ô∏è',51:'üå¶Ô∏è',53:'üå¶Ô∏è',55:'üå¶Ô∏è',56:'üå®Ô∏è',57:'üå®Ô∏è',61:'üåßÔ∏è',63:'üåßÔ∏è',65:'üåßÔ∏è',66:'üå®Ô∏è',67:'üå®Ô∏è',71:'‚ùÑÔ∏è',73:'‚ùÑÔ∏è',75:'‚ùÑÔ∏è',77:'‚ùÑÔ∏è',80:'üå¶Ô∏è',81:'üå¶Ô∏è',82:'üå¶Ô∏è',85:'üå®Ô∏è',86:'üå®Ô∏è',95:'‚õàÔ∏è',96:'‚õàÔ∏è',99:'‚õàÔ∏è'};return icons[c]||'‚òÄÔ∏è';};const calcDI=(t,h)=>{if(t===undefined||t===null||h===undefined||h===null)return null;const d=0.81*t+0.01*h*(0.99*t-14.3)+46.3;return Math.round(d*10)/10;};const diLvl=d=>{if(d===null||d===undefined)return'-';if(d<55)return'ÂØí„ÅÑ';if(d<60)return'ËÇåÂØí„ÅÑ';if(d<65)return'‰Ωï„ÇÇÊÑü„Åò„Å™„ÅÑ';if(d<70)return'Âø´„ÅÑ';if(d<75)return'Êöë„Åè„Å™„ÅÑ';if(d<80)return'„ÇÑ„ÇÑÊöë„ÅÑ';if(d<85)return'Êöë„Åè„Å¶Ê±ó„ÅåÂá∫„Çã';return'Êöë„Åè„Å¶„Åü„Åæ„Çâ„Å™„ÅÑ';};const loadMemsFromStore=()=>{const s=localStorage.getItem('fukuanvi-location-memories');if(s){try{lMems.value=JSON.parse(s);}catch(e){console.error('‰ΩçÁΩÆ„É°„É¢„É™„Éº„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:',e);}}};const saveMemsToStore=()=>{localStorage.setItem('fukuanvi-location-memories',JSON.stringify(lMems.value));};const saveMem=()=>{const n=saveName.value.trim();if(n&&n.length<=20){lMems.value[saveIdx.value]={name:n,lat:selLL.lat,lng:selLL.lng,address:curAddr.value};saveMemsToStore();closeSave();}else if(!n){if(saveInput.value)saveInput.value.focus();}else{errorMessage.value='‰ΩçÁΩÆÂêç„ÅØ20ÊñáÂ≠ó‰ª•ÂÜÖ„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';setTimeout(()=>{errorMessage.value='';},3000);}};const loadMem=i=>{const m=lMems.value[i];if(m.name&&m.lat&&m.lng){selLL.lat=m.lat;selLL.lng=m.lng;curAddr.value='‰ΩçÁΩÆÊÉÖÂ†±ÂèñÂæó‰∏≠...';if(map.value){map.value.setView([m.lat,m.lng],10);updMarker();}fetchAddr(m.lat,m.lng);fetchWData();}};const fetchAddr=async(lat,lng)=>{const k=`${lat.toFixed(3)},${lng.toFixed(3)}`;if(addrCache.has(k)){curAddr.value=addrCache.get(k);return;}if(addrReq.value)return;addrReq.value=true;try{const c=new AbortController();const tid=setTimeout(()=>c.abort(),3000);const r=await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json&addressdetails=1&accept-language=ja&zoom=10`,{signal:c.signal});clearTimeout(tid);if(!r.ok)throw new Error('‰ΩèÊâÄÂèñÂæó„Å´Â§±Êïó');const d=await r.json();const a=d.address;let display='‰ΩçÁΩÆ„ÇíÈÅ∏Êäû';if(a){const pref=a.state||a.prefecture||'';const city=a.city||a.town||a.village||a.municipality||'';if(pref&&city)display=`${pref} ${city}`;else if(pref||city)display=pref||city;}if(addrCache.size>=100){const first=addrCache.keys().next().value;addrCache.delete(first);}addrCache.set(k,display);curAddr.value=display;}catch(e){curAddr.value='‰ΩçÁΩÆ„ÇíÈÅ∏Êäû';}finally{addrReq.value=false;}};const initMap=()=>{const el=document.getElementById('map');if(!el)return;if(map.value){map.value.remove();map.value=null;}try{map.value=L.map('map',{preferCanvas:true,zoomControl:true}).setView([selLL.lat,selLL.lng],8);L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'¬© OpenStreetMap contributors',loading:'lazy'}).addTo(map.value);const icon=L.divIcon({html:'<div style="background: linear-gradient(135deg, #3385ff, #0059b3); color: white; width: 32px; height: 32px; border-radius: 50% 50% 50% 0; transform: rotate(-45deg); display: flex; align-items: center; justify-content: center; box-shadow: 0 3px 8px rgba(51, 133, 255, 0.4); border: 3px solid white;"><i class="fas fa-shirt" style="transform: rotate(45deg); font-size: 14px;"></i></div>',className:'custom-location-marker',iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]});marker.value=L.marker([selLL.lat,selLL.lng],{icon:icon}).addTo(map.value);map.value.on('click',e=>{selLL.lat=e.latlng.lat;selLL.lng=e.latlng.lng;updMarker();fetchWData();fetchAddr(e.latlng.lat,e.latlng.lng);});setTimeout(()=>{if(map.value)map.value.invalidateSize();},100);}catch(e){errorMessage.value='Âú∞Âõ≥„ÅÆÂàùÊúüÂåñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';}};const updMarker=()=>{if(marker.value)marker.value.setLatLng([selLL.lat,selLL.lng]);};const getPos=()=>{if(!navigator.geolocation){errorMessage.value='‚ùå „Åì„ÅÆ„Éá„Éê„Ç§„Çπ„ÅØ‰ΩçÁΩÆÊÉÖÂ†±„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ\nÊâãÂãï„ÅßÂú∞Âõ≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶‰ΩçÁΩÆ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';return;}curAddr.value='üîÑ ‰ΩçÁΩÆÊÉÖÂ†±ÂèñÂæó‰∏≠...';errorMessage.value='';const opts={enableHighAccuracy:true,timeout:15000,maximumAge:60000};navigator.geolocation.getCurrentPosition(pos=>{selLL.lat=pos.coords.latitude;selLL.lng=pos.coords.longitude;if(map.value){map.value.setView([selLL.lat,selLL.lng],12);updMarker();}fetchWData();fetchAddr(pos.coords.latitude,pos.coords.longitude);},err=>{let msg='';switch(err.code){case err.PERMISSION_DENIED:msg='üö´ ‰ΩçÁΩÆÊÉÖÂ†±„ÅÆ„Ç¢„ÇØ„Çª„Çπ„ÅåÊãíÂê¶„Åï„Çå„Åæ„Åó„Åü„ÄÇ\n\n„ÄêËß£Ê±∫ÊñπÊ≥ï„Äë\n1. „Éñ„É©„Ç¶„Ç∂„ÅÆ„Ç¢„Éâ„É¨„Çπ„Éê„ÉºÂ∑¶„ÅÆüîí„Éû„Éº„ÇØ„Çí„Çø„ÉÉ„Éó\n2. ‰ΩçÁΩÆÊÉÖÂ†±„Çí„ÄåË®±ÂèØ„Äç„Å´Â§âÊõ¥\n3. „Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶ÂÜçÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ';break;case err.POSITION_UNAVAILABLE:msg='üìç ‰ΩçÁΩÆÊÉÖÂ†±„ÇíÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„ÄÇ\n\n„ÄêÁ¢∫Ë™ç‰∫ãÈ†Ö„Äë\n‚Ä¢ GPS„Åå„Ç™„É≥„Å´„Å™„Å£„Å¶„ÅÑ„Çã„Åã\n‚Ä¢ Â±ãÂ§ñ„Å´„ÅÑ„Çã„ÅãÔºàÂ±ãÂÜÖ„Åß„ÅØÂèñÂæóÂõ∞Èõ£Ôºâ\n‚Ä¢ Ê©üÂÜÖ„É¢„Éº„Éâ„Åå„Ç™„Éï„Å´„Å™„Å£„Å¶„ÅÑ„Çã„Åã';break;case err.TIMEOUT:msg='‚è±Ô∏è ‰ΩçÁΩÆÊÉÖÂ†±„ÅÆÂèñÂæó„Åå„Çø„Ç§„É†„Ç¢„Ç¶„Éà„Åó„Åæ„Åó„Åü„ÄÇ\n\n„Äê„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„Äë\n‚Ä¢ ÈõªÊ≥¢„ÅÆËâØ„ÅÑÂ†¥ÊâÄ„Å´ÁßªÂãï\n‚Ä¢ Â∞ë„ÅóÊôÇÈñì„Çí„Åä„ÅÑ„Å¶ÂÜçÂ∫¶ÂÆüË°å\n‚Ä¢ ÊâãÂãï„ÅßÂú∞Âõ≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶‰ΩçÁΩÆÈÅ∏Êäû';break;default:msg=`‚ùå ‰ΩçÁΩÆÊÉÖÂ†±ÂèñÂæó„Ç®„É©„Éº\n\n„Ç®„É©„Éº„Ç≥„Éº„Éâ: ${err.code}\n„É°„ÉÉ„Çª„Éº„Ç∏: ${err.message}\n\nÊâãÂãï„ÅßÂú∞Âõ≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶‰ΩçÁΩÆ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;break;}errorMessage.value=msg;curAddr.value='‰ΩçÁΩÆ„ÇíÈÅ∏Êäû';setTimeout(()=>{errorMessage.value='';},15000);},opts);};const genDateList=()=>{const today=new Date();dateList.value=[];for(let i=0;i<=7;i++){const d=new Date(today);d.setDate(today.getDate()+i);dateList.value.push(getJSTDate(d));}};const dateLbl=(s,i)=>{if(i===0)return'‰ªäÊó•';if(i===1)return'ÊòéÊó•';if(i===2)return'ÊòéÂæåÊó•';return`${i}Êó•Âæå`;};const fmtDate=s=>{const d=new Date(s);const m=d.getMonth()+1;const day=d.getDate();const w=d.toLocaleDateString('ja-JP',{weekday:'short'});return`${m}/${day}Ôºà${w}Ôºâ`;};const selDate=i=>{selDateIdx.value=i;fetchWData();};const fetchWData=()=>{errorMessage.value='';Object.keys(wData).forEach(k=>delete wData[k]);const d=dateList.value[selDateIdx.value];const lat=selLL.lat.toFixed(4);const lng=selLL.lng.toFixed(4);const url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lng}&hourly=temperature_2m,apparent_temperature,relative_humidity_2m,precipitation_probability,weather_code&start_date=${d}&end_date=${d}&timezone=Asia/Tokyo`;const c=new AbortController();const tid=setTimeout(()=>c.abort(),15000);fetch(url,{signal:c.signal}).then(r=>{clearTimeout(tid);if(!r.ok)throw new Error('Â§©Ê∞ó„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Ç§„É≥„Çø„Éº„Éç„ÉÉ„ÉàÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');return r.json();}).then(data=>{if(!data.hourly)throw new Error('Â§©Ê∞ó„Éá„Éº„Çø„ÅÆËß£Êûê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Åó„Å∞„Çâ„ÅèÊôÇÈñì„Çí„Åä„ÅÑ„Å¶ÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');for(const h of hours){const idx=data.hourly.time.findIndex(t=>t.endsWith(`T${h.toString().padStart(2,'0')}:00`));if(idx!==-1){wData[h]={temperature_2m:Math.round(data.hourly.temperature_2m[idx]),apparent_temperature:Math.round(data.hourly.apparent_temperature[idx]),relative_humidity_2m:Math.round(data.hourly.relative_humidity_2m[idx]),precipitation_probability:Math.round(data.hourly.precipitation_probability[idx]||0),weather_code:data.hourly.weather_code[idx]};}}}).catch(e=>{clearTimeout(tid);errorMessage.value=e.name==='AbortError'?'Â§©Ê∞ó„Éá„Éº„Çø„ÅÆÂèñÂæó„Åå„Çø„Ç§„É†„Ç¢„Ç¶„Éà„Åó„Åæ„Åó„Åü„ÄÇÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ':e.message;setTimeout(()=>{errorMessage.value='';},8000);});};const cIcon=(t,h)=>{if(t===undefined||t===null)return'';let adj=t;if((h>=6&&h<=9)||(h>=18&&h<=21))adj-=1.5;else if(h>=22||h<=5)adj-=1;if(adj>=35)return'üßò‚Äç‚ôÇÔ∏è';if(adj>=30)return'üèãÔ∏è‚Äç‚ôÇÔ∏è';if(adj>=27)return'üëï';if(adj>=24)return'üëî';if(adj>=21)return'ü¶∫';if(adj>=18)return'üß•';if(adj>=15)return'üß•';if(adj>=12)return'üß•';if(adj>=9)return'üß•';if(adj>=6)return'üß•';if(adj>=3)return'üß•';return'üß•';};const cLbl=(t,h)=>{if(t===undefined||t===null)return'-';let adj=t;if((h>=6&&h<=9)||(h>=18&&h<=21))adj-=1.5;else if(h>=22||h<=5)adj-=1;if(adj>=35)return'ÂÖ®Ë£∏„É¨„Éô„É´';if(adj>=30)return'„Çø„É≥„ÇØ„Éà„ÉÉ„Éó';if(adj>=27)return'ÂçäË¢ñT„Ç∑„É£„ÉÑ';if(adj>=24)return'Èï∑Ë¢ñT„Ç∑„É£„ÉÑ';if(adj>=21)return'ËñÑÊâã„Ç´„Éº„Éá„Ç£„Ç¨„É≥';if(adj>=18)return'„Çª„Éº„Çø„Éº';if(adj>=15)return'„Éë„Éº„Ç´„Éº';if(adj>=12)return'„Ç∏„É£„Ç±„ÉÉ„Éà';if(adj>=9)return'„Ç≥„Éº„Éà';if(adj>=6)return'ÂéöÊâã„Ç≥„Éº„Éà';if(adj>=3)return'„ÉÄ„Ç¶„É≥„Ç∏„É£„Ç±„ÉÉ„Éà';return'Èò≤ÂØíÁùÄÂÆåÂÖ®Ë£ÖÂÇô';};onMounted(()=>{genDateList();nextTick(()=>{setTimeout(()=>{initMap();fetchWData();loadMemsFromStore();},200);});});return{dateList,selDateIdx,selDate,dateLbl,fmtDate,wData,hours,cIcon,cLbl,wIcon,calcDI,diLvl,errorMessage,hasWeatherData,getPos,currentAddress:curAddr,isCurHour,tmpClass,locationMemories:lMems,showSave,saveName,saveInput,startPress,endPress,saveMem,closeSave,loadMem,refresh,tableContainer:tCon,scrollToCur,getMemNum,showCM,cmPos,cmIdx,isMemSaved,openSave,confDel,delMem,closeCM};}}).mount('#app');if('serviceWorker'in navigator&&(location.protocol==='https:'||location.hostname==='localhost')){window.addEventListener('load',()=>{navigator.serviceWorker.register('/sw.js').then(r=>console.log('SW registered: ',r)).catch(e=>console.log('SW registration failed: ',e));})}
</script>
</body>
</html>
