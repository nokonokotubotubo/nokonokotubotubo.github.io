<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Fuku„Å™„Å≥</title>
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#3385ff">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Fuku„Å™„Å≥">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
*{box-sizing:border-box}
html,body,#app{height:100vh;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif}
body{background:#e6f2ff;overflow:hidden}
#app{display:flex;flex-direction:column;background:#fff}
.title-header{background:linear-gradient(135deg,#66a3ff,#0059b3);border-radius:0 0 10px 10px;padding:8px 16px;text-align:center;box-shadow:0 2px 6px rgba(0,89,179,.1);flex:0 0 44px;display:flex;align-items:center;justify-content:center;position:relative}
.desktop-location-address{width:12em;font-size:.9em;color:#0059b3;background:#f0f8ff;padding:4px 8px;border-radius:3px;border:1px solid #cce0ff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-left:auto;margin-right: 40px;align-self:center}
.title-content{position:absolute;left:50%;transform:translateX(-50%);display:flex;align-items:center;justify-content:center;gap:6px;height:100%}
.title-icon{font-size:1.4em;color:#fff;text-shadow:0 2px 4px rgba(0,0,0,.2)}
.title-text{color:#fff;font-size:1.1em;font-weight:bold;letter-spacing:2px;line-height:1.2}
.mobile-copyright{display:none}
.date-row{display:flex;align-items:center;gap:10px;margin:6px 0 6px 8px;flex:0 0 36px;flex-wrap:wrap}
.location-address{width:8em;font-size:.9em;color:#0059b3;background:#f0f8ff;padding:4px 8px;border-radius:3px;border:1px solid #cce0ff;margin-right:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.memory-group,.date-group{display:flex;align-items:flex-start;gap:8px;margin-left:0;min-height:40px}
.memory-group-icon,.date-group-icon{font-size:1.8em;color:#0059b3;width:1.5em;height:1.5em;display:flex;align-items:center;justify-content:center;margin:2px 4px 0 0}
.memory-buttons,.date-buttons{display:flex;gap:5px;flex-wrap:wrap}
.memory-btn,.date-button{padding:7px 12px;border:1.2px solid #66a3ff;border-radius:5px;background:#cce0ff;color:#003366;font-size:.85em;cursor:pointer;transition:all .2s ease;min-width:70px;text-align:center;position:relative;user-select:none;font-weight:600;white-space:pre-line;line-height:1.1;box-shadow:0 1px 3px rgba(0,0,0,.1);display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:36px}
.memory-btn:hover,.date-button:hover{background:#99c2ff;border-color:#3385ff;transform:translateY(-1px);box-shadow:0 2px 6px rgba(51,133,255,.2)}
.memory-btn.saved{background:#3385ff;color:#fff;border-color:#0059b3;box-shadow:0 2px 8px rgba(51,133,255,.22)}
.memory-btn.memory-selected{background:#0059b3!important;color:#fff!important;border-color:#003d80!important;box-shadow:0 3px 12px rgba(0,89,179,.35)!important}
.date-button.active{background:#0059b3;color:#fff;border-color:#003d80;box-shadow:0 2px 8px rgba(0,89,179,.25)}
.memory-btn.saved:hover,.date-button.active:hover{background:#003d80;transform:translateY(-1px);box-shadow:0 3px 12px rgba(0,89,179,.35)}
.memory-btn.memory-selected:hover{background:#003d80!important;transform:translateY(-1px);box-shadow:0 4px 16px rgba(0,89,179,.45)!important}
.date-button{font-size:.95em}
.date-button-content{display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:.85em;line-height:1.1;width:100%}
.date-label{font-weight:bold;margin-bottom:2px;text-align:center;width:100%}
.date-detail{font-size:1.2em;font-weight:600;width:100%;font-family:'Hiragino Sans','„Éí„É©„ÇÆ„ÉéËßí„Ç¥„Ç∑„ÉÉ„ÇØ','Yu Gothic UI','Meiryo UI','MS UI Gothic',sans-serif;letter-spacing:2px;color:#003366;text-shadow:0 1px 2px rgba(51,133,255,.1);text-align:center}
.date-button.active .date-detail{color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.2)}
.main-content{flex:1;display:flex;flex-direction:column;height:100%;width:100vw;min-height:0}
.map-area{flex:0 0 39%;min-height:260px;max-height:45.5vh;position:relative;width:100vw;background:#e6f2ff;border-bottom:2px solid #99c2ff;display:flex;align-items:stretch;justify-content:center}
#map{flex:1;min-width:0;min-height:260px;width:100vw;height:100%;border-radius:8px;border:2px solid #99c2ff;margin:0}
.current-location-btn{position:absolute;bottom:12px;left:12px;z-index:1000;padding:8px 16px;background:linear-gradient(135deg,#66a3ff,#3385ff);color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:1em;box-shadow:0 3px 8px rgba(51,133,255,.25);transition:all .3s ease;user-select:none;outline:none}
.current-location-btn:hover{background:linear-gradient(135deg,#3385ff,#0059b3);transform:translateY(-2px);box-shadow:0 5px 15px rgba(51,133,255,.35)}
.table-area{flex:0 0 61%;overflow:hidden;display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch;background:#fff;padding-top:6px;min-height:0}
.error-message{color:#dc2626;background:linear-gradient(135deg,#fef2f2,#fee2e2);border:1px solid #fca5a5;border-radius:8px;padding:12px 16px;margin:0 auto 12px;font-weight:600;font-size:1em;width:90vw;box-shadow:0 2px 8px rgba(220,38,38,.1)}
.table-container{width:99vw;height:100%;overflow:auto;margin:0 auto;display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch;background:#fff}
table{width:100%;border-collapse:collapse;font-size:14px;table-layout:auto;background:#f8fbff}
th,td{border:1px solid #99c2ff;padding:18px 6px;text-align:center;color:#003366;font-size:14px;white-space:normal;word-break:break-word}
th{background:linear-gradient(135deg,#f0f8ff,#e6f2ff);font-weight:bold;position:sticky;top:0;z-index:10}
.current-time-highlight{background-color:rgba(255,235,153,.3)!important}
.hot-temperature{background:#dc2626!important;color:#fff!important;font-weight:bold}
.cold-temperature{background:#1e40af!important;color:#fff!important;font-weight:bold}
.weather-emoji{font-size:2.25em;vertical-align:middle;filter:drop-shadow(0 1px 2px rgba(0,0,0,.1))}
.progress-container{background:#e6f2ff;border-radius:6px;width:100%;height:14px;position:relative;margin:1px 0;overflow:hidden}
.progress-bar{height:100%;background:linear-gradient(135deg,#3385ff,#0059b3);border-radius:6px;transition:width .4s ease;position:relative}
.no-data-message{text-align:center;padding:16px;color:#64748b;background:linear-gradient(135deg,#f8fafc,#f1f5f9);border-radius:8px;border:1px solid #e2e8f0;font-size:1em;width:90vw;margin:0 auto;box-shadow:0 2px 8px rgba(0,0,0,.05)}
.clothing-index-cell{display:flex;flex-direction:column;align-items:center;justify-content:center;line-height:1.2}
.clothing-index-icon{font-size:2.25em;margin-bottom:2px;filter:drop-shadow(0 1px 2px rgba(0,0,0,.1))}
.clothing-index-label{font-size:.96em;margin-top:2px;word-break:break-word;font-weight:500}
.mobile-table{display:none}
.footer{background:linear-gradient(135deg,#f8fafc,#e2e8f0);border-top:1px solid #cbd5e1;padding:12px 0;text-align:center;position:relative;z-index:1}
.footer small{color:#64748b;font-size:.875em;font-weight:500;letter-spacing:.5px}
.context-menu-overlay{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.3);z-index:999998;backdrop-filter:blur(2px)}
.context-menu{position:absolute;background:#fff;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,.3),0 2px 8px rgba(0,0,0,.1);min-width:180px;overflow:hidden;border:1px solid rgba(51,133,255,.2);animation:contextMenuFadeIn .2s ease-out}
.context-menu-header{background:linear-gradient(135deg,#f0f8ff,#e6f2ff);color:#0059b3;font-weight:bold;font-size:.9em;padding:12px 16px;text-align:center;border-bottom:1px solid #e0e9ff}
.context-menu-item{padding:14px 18px;cursor:pointer;display:flex;align-items:center;gap:12px;font-size:1em;font-weight:500;transition:all .2s ease;user-select:none;border-bottom:1px solid #f0f0f0}
.context-menu-item:last-child{border-bottom:none}
.context-menu-item i{font-size:1.1em;width:16px;text-align:center}
.register-item{color:#0059b3}
.register-item:hover{background:linear-gradient(135deg,#f0f8ff,#e6f2ff);color:#003d80}
.delete-item{color:#dc2626}
.delete-item:hover{background:linear-gradient(135deg,#fef2f2,#fee2e2);color:#b91c1c}
.location-save-modal{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.65);display:flex;align-items:center;justify-content:center;z-index:999999;backdrop-filter:blur(3px);animation:modalBackdropFadeIn .3s ease-out}
.location-save-content{background:#fff;padding:28px;border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.3),0 4px 12px rgba(0,0,0,.1);max-width:340px;width:88%;max-height:85vh;overflow-y:auto;position:relative;margin:20px;border:1px solid rgba(51,133,255,.1);animation:modalContentFadeIn .3s ease-out}
.location-save-title{color:#0059b3;font-weight:bold;font-size:1.2em;margin-bottom:20px;text-align:center;line-height:1.4;display:flex;align-items:center;justify-content:center;gap:8px}
.location-save-title::before{content:"üìç";font-size:1.1em}
.location-save-input{width:100%;padding:14px 16px;border:2px solid #e0e9ff;border-radius:10px;margin-bottom:24px;font-size:1em;outline:none;transition:all .3s ease;background:#fafcff;font-family:inherit}
.location-save-input:focus{border-color:#3385ff;background:#fff;box-shadow:0 0 0 4px rgba(51,133,255,.1),0 2px 8px rgba(51,133,255,.15);transform:translateY(-1px)}
.location-save-buttons{display:flex;gap:14px;justify-content:center;flex-wrap:wrap}
.location-save-btn{padding:14px 24px;border:none;border-radius:10px;cursor:pointer;font-weight:600;font-size:1em;transition:all .3s ease;min-width:100px;text-align:center;user-select:none;position:relative;overflow:hidden;font-family:inherit}
.save-btn{background:linear-gradient(135deg,#3385ff,#0059b3);color:#fff;box-shadow:0 4px 12px rgba(51,133,255,.3)}
.save-btn:hover{background:linear-gradient(135deg,#0059b3,#003d80);transform:translateY(-2px);box-shadow:0 6px 20px rgba(51,133,255,.4)}
.cancel-btn{background:linear-gradient(135deg,#f1f5f9,#e2e8f0);color:#475569;border:1px solid #cbd5e1;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.cancel-btn:hover{background:linear-gradient(135deg,#e2e8f0,#cbd5e1);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.15)}
@keyframes contextMenuFadeIn{from{opacity:0;transform:scale(.8)translateY(-10px)}to{opacity:1;transform:scale(1)translateY(0)}}
@keyframes modalBackdropFadeIn{from{opacity:0}to{opacity:1}}
@keyframes modalContentFadeIn{from{opacity:0;transform:scale(.85)translateY(-30px)}to{opacity:1;transform:scale(1)translateY(0)}}
@media(min-width: 901px){
.date-row {gap: 30px;}
}
@media(max-width:900px){
.title-header{padding:8px 0;justify-content:center;flex:0 0 28px}
.title-text{font-size:1em}
.title-icon{font-size:1.2em}
th,td{font-size:13px;padding:6px 3px}
.date-row{margin:6px 0 6px 1vw;}
.map-area{flex:0 0 32.5%;min-height:234px;max-height:39vh}
.table-area{flex:0 0 67.5%}
.weather-emoji,.clothing-index-icon{font-size:2.34em}
#map{min-height:234px}
.memory-btn{padding:6px 10px;font-size:.88em;min-width:60px;min-height:34px}
.memory-group,.date-group{min-height:36px}
.memory-group-icon,.date-group-icon{font-size:1.65em;margin-right:4px;width:1.3em;height:1.3em}
}
@media(max-width:600px){
.title-text{font-size:.9em;letter-spacing:.5px}
.title-icon{font-size:1.1em}
.title-header{padding:8px 6px;justify-content:center;flex:0 0 28px}
.title-content{position:absolute;left:50%;transform:translateX(-50%);display:flex;align-items:center;justify-content:center;gap:6px;height:100%}
.date-row{margin:6px 0 6px 1vw;align-items:flex-start;width:calc(100% - 2vw);flex-direction:column;gap:4px;flex:0 0 76px}
.desktop-location-address{display:none!important}
.memory-group,.date-group{margin:0 5px;gap:3px;width:calc(100% - 10px);align-items:flex-start}
.memory-buttons,.date-buttons{flex-wrap:nowrap;overflow-x:auto;-webkit-overflow-scrolling:touch;width:100%;gap:3px}
.memory-btn,.date-button{min-width:55px;flex-shrink:0}
.memory-btn{padding:6px 10px;font-size:.8em;min-height:32px}
.date-button-content{font-size:.75em}
.date-detail{font-size:1.1em;letter-spacing:1px}
.memory-group-icon,.date-group-icon{font-size:1.65em;margin-right:4px;width:1.3em;height:1.3em}
.map-area{flex:0 0 26%;min-height:208px;max-height:39vh}
#map{min-height:208px}
.table-area{flex:0 0 74%;overflow:hidden;position:relative}
.map-area.map-hidden{flex:0 0 0;min-height:0;max-height:0;overflow:hidden}
.table-area.table-full{flex:0 0 100%}
.desktop-table{display:none}
.mobile-table{display:table;width:100%;table-layout:fixed;border-spacing:0;margin:0}
.table-container{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;overflow:auto;background:#fff;padding:0 0 120px 0}
.mobile-table td{padding:12px 4px;font-size:11px;line-height:1.4;vertical-align:middle;height:auto;min-height:48px}
.mobile-table th{font-size:11px;padding:6px 3px}
.mobile-table .weather-emoji,.mobile-table .clothing-index-icon{font-size:2.2em}
.mobile-table .clothing-index-label{font-size:.75em}
.mobile-table .progress-container{height:12px}
.mobile-table tr:last-child td{padding-bottom:20px}
.location-save-content{width:92%;margin:8px;padding:24px;border-radius:12px}
.location-save-input{font-size:16px;padding:16px}
.location-save-buttons{flex-direction:row;gap:12px}
.location-save-btn{flex:1;min-width:0;padding:16px 20px;font-size:1.05em}
.footer{display:none}
.mobile-copyright{display:block;position:absolute;top:50%;right:8px;transform:translateY(-50%);z-index:5000;line-height:1;font-size:.65em;color:rgba(255,255,255,.8);font-weight:500;text-shadow:0 1px 2px rgba(0,0,0,.2);user-select:none;pointer-events:none;font-family:Verdana,"Droid Sans","„É°„Ç§„É™„Ç™",Meiryo,sans-serif}
}
@media(max-width:400px){
.location-save-buttons{flex-direction:column}
.location-save-btn{width:100%}
.location-save-content{padding:20px;margin:6px}
.map-area{flex:0 0 20.8%;min-height:156px}
.table-area{flex:0 0 79.2%}
.map-area.map-hidden{flex:0 0 0;min-height:0}
.table-area.table-full{flex:0 0 100%}
.memory-group-icon,.date-group-icon{font-size:1.5em;margin-right:3px;width:1.2em;height:1.2em}
.mobile-copyright{right:6px;font-size:.6em}
.date-button{min-width:50px}
.date-buttons,.memory-buttons{gap:2px}
}
</style>
</head>
<body>
<div id="app">
<div class="title-header">
<div class="title-content" @click="isMobile ? toggleMap() : null" :style="{ cursor: isMobile ? 'pointer' : 'default' }">
<i class="fas fa-shirt title-icon"></i>
<div class="title-text">Fuku„Å™„Å≥ <i class="fas fa-cloud-sun title-icon"></i></div>
</div>
<div class="mobile-copyright">&copy; 2025 nokotubo</div>
</div>
<div class="date-row">
<div class="memory-group">
<div class="memory-group-icon">üìí</div>
<div class="memory-buttons">
<button v-for="(memory, index) in locationMemories" :key="index" @click="loadLocationMemory(index)" @mousedown="startLongPress(index, $event)" @mouseup="endLongPress" @mouseleave="endLongPress" @touchstart="startLongPress(index, $event)" @touchend="endLongPress" :class="['memory-btn', { saved: memory.name, 'memory-selected': selectedMemoryIndex === index }]">
{{ memory.name || `„É°„É¢„É™\n${getMemoryNumber(index)}` }}
</button>
</div>
</div>
<div class="date-group">
<div class="date-group-icon">üìÖ</div>
<div class="date-buttons">
<button v-for="(date, index) in dateList" :key="date" @click="selectDate(index)" :class="['date-button', { active: selectedDateIndex === index }]">
<div class="date-button-content">
<div class="date-label">{{ dateLabel(date, index) }}</div>
<div class="date-detail">{{ formatDateDetail(date) }}</div>
</div>
</button>
</div>
</div>
<div class="desktop-location-address">üìç {{ currentAddress || '‰ΩçÁΩÆ„ÇíÈÅ∏Êäû' }}</div>
</div>
<div class="main-content">
<div class="map-area" :class="{ 'map-hidden': !showMap }">
<div id="map">
<button class="current-location-btn" @click="getCurrentLocation" @touchend.prevent="getCurrentLocation">üìç ÁèæÂú®Âú∞</button>
</div>
</div>
<div class="table-area" :class="{ 'table-full': !showMap }">
<div v-if="errorMessage" class="error-message">‚ùå {{ errorMessage }}</div>
<div class="table-container" ref="tableContainer">
<table v-if="hasWeatherData" class="desktop-table">
<thead>
<tr>
<th>‚õÖ Â§©Ê∞ó</th>
<th v-for="hour in hours" :key="hour" :class="{ 'current-time-highlight': isCurrentHour(hour) }" :id="`hour-${hour}`">
<span class="weather-emoji">{{ weatherIcon(weatherData[hour]?.weather_code, weatherData[hour]?.precipitation_probability) }}</span><br>{{ hour }}:00
</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>üåßÔ∏è ÈôçÊ∞¥Á¢∫Áéá</strong></td>
<td v-for="hour in hours" :key="hour" :class="{ 'current-time-highlight': isCurrentHour(hour) }">
<div class="progress-container">
<div class="progress-bar" :style="{ width: (weatherData[hour]?.precipitation_probability ?? 0) + '%' }"></div>
</div>
{{ weatherData[hour]?.precipitation_probability !== undefined ? weatherData[hour].precipitation_probability + "%" : '-' }}
</td>
</tr>
<tr>
<td><strong>üå°Ô∏è Ê∞óÊ∏©</strong></td>
<td v-for="hour in hours" :key="hour" :class="[{ 'current-time-highlight': isCurrentHour(hour) }, temperatureClass(weatherData[hour]?.temperature_2m)]">
{{ weatherData[hour]?.temperature_2m !== undefined ? weatherData[hour].temperature_2m + "‚ÑÉ" : '-' }}
</td>
</tr>
<tr>
<td><strong>ü§í ‰ΩìÊÑüÊ∏©Â∫¶</strong></td>
<td v-for="hour in hours" :key="hour" :class="[{ 'current-time-highlight': isCurrentHour(hour) }, temperatureClass(weatherData[hour]?.apparent_temperature)]">
{{ weatherData[hour]?.apparent_temperature !== undefined ? weatherData[hour].apparent_temperature + "‚ÑÉ" : '-' }}
</td>
</tr>
<tr>
<td><strong>üíß ÊπøÂ∫¶</strong></td>
<td v-for="hour in hours" :key="hour" :class="{ 'current-time-highlight': isCurrentHour(hour) }">
{{ weatherData[hour]?.relative_humidity_2m !== undefined ? weatherData[hour].relative_humidity_2m + "%" : '-' }}
</td>
</tr>
<tr>
<td><strong>üò∞ ‰∏çÂø´ÊåáÊï∞</strong></td>
<td v-for="hour in hours" :key="hour" :class="{ 'current-time-highlight': isCurrentHour(hour) }">
<div style="font-size: 0.9em; font-weight: bold;">
{{ calculateDiscomfortIndex(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m) !== null ? calculateDiscomfortIndex(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m) : '-' }}
</div>
<div style="font-size: 0.8em; color: #666; margin-top: 2px;">
{{ discomfortLevel(calculateDiscomfortIndex(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m)) }}
</div>
</td>
</tr>
<tr>
<td><strong>üëï ÊúçË£ÖÊåáÊï∞</strong></td>
<td v-for="hour in hours" :key="hour" :class="{ 'current-time-highlight': isCurrentHour(hour) }">
<div class="clothing-index-cell">
<span class="clothing-index-icon">{{ clothingIcon(weatherData[hour]?.apparent_temperature, hour) }}</span>
<span class="clothing-index-label">{{ clothingLabel(weatherData[hour]?.apparent_temperature, hour) }}</span>
</div>
</td>
</tr>
</tbody>
</table>
<table v-if="hasWeatherData" class="mobile-table">
<thead>
<tr>
<th>‚õÖ<br>Â§©Ê∞ó</th>
<th>üåßÔ∏è<br>ÈôçÊ∞¥Á¢∫Áéá</th>
<th>üå°Ô∏è<br>Ê∞óÊ∏©</th>
<th>ü§í<br>‰ΩìÊÑüÊ∏©Â∫¶</th>
<th>üíß<br>ÊπøÂ∫¶</th>
<th>üò∞<br>‰∏çÂø´ÊåáÊï∞</th>
<th>üëï<br>ÊúçË£Ö</th>
</tr>
</thead>
<tbody>
<tr v-for="hour in hours" :key="hour" :class="{ 'current-time-highlight': isCurrentHour(hour) }" :id="`mobile-hour-${hour}`">
<td>
<span class="weather-emoji">{{ weatherIcon(weatherData[hour]?.weather_code, weatherData[hour]?.precipitation_probability) }}</span><br>
{{ hour }}:00
</td>
<td>
<div class="progress-container">
<div class="progress-bar" :style="{ width: (weatherData[hour]?.precipitation_probability ?? 0) + '%' }"></div>
</div>
{{ weatherData[hour]?.precipitation_probability !== undefined ? weatherData[hour].precipitation_probability + "%" : '-' }}
</td>
<td :class="temperatureClass(weatherData[hour]?.temperature_2m)">
{{ weatherData[hour]?.temperature_2m !== undefined ? weatherData[hour].temperature_2m + "‚ÑÉ" : '-' }}
</td>
<td :class="temperatureClass(weatherData[hour]?.apparent_temperature)">
{{ weatherData[hour]?.apparent_temperature !== undefined ? weatherData[hour].apparent_temperature + "‚ÑÉ" : '-' }}
</td>
<td>
{{ weatherData[hour]?.relative_humidity_2m !== undefined ? weatherData[hour].relative_humidity_2m + "%" : '-' }}
</td>
<td>
<div style="font-size: 0.8em; font-weight: bold;">
{{ calculateDiscomfortIndex(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m) !== null ? calculateDiscomfortIndex(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m) : '-' }}
</div>
<div style="font-size: 0.7em; color: #666;">
{{ discomfortLevel(calculateDiscomfortIndex(weatherData[hour]?.temperature_2m, weatherData[hour]?.relative_humidity_2m)) }}
</div>
</td>
<td>
<div class="clothing-index-cell">
<span class="clothing-index-icon">{{ clothingIcon(weatherData[hour]?.apparent_temperature, hour) }}</span>
<span class="clothing-index-label">{{ clothingLabel(weatherData[hour]?.apparent_temperature, hour) }}</span>
</div>
</td>
</tr>
</tbody>
</table>
<div v-if="!hasWeatherData && !errorMessage" class="no-data-message">
üó∫Ô∏èÂú∞Âõ≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Â§©Ê∞ó„Éá„Éº„Çø„ÇíÂèñÂæó„Åó„Å¶„Åè„Å†„Åï„ÅÑ
</div>
</div>
</div>
</div>
<footer class="footer">
<small>&copy; 2025 nokotubo</small>
</footer>
<div v-if="showContextMenu" class="context-menu-overlay" @click="closeContextMenu">
<div class="context-menu" @click.stop :style="{ left: contextMenuPosition.x + 'px', top: contextMenuPosition.y + 'px' }">
<div class="context-menu-header">„É°„É¢„É™{{ getMemoryNumber(contextMenuIndex) }}</div>
<div v-if="!isMemorySlotSaved(contextMenuIndex)" class="context-menu-item register-item" @click="openSaveDialog">
<i class="fas fa-plus"></i>‰ΩçÁΩÆ„ÇíÁôªÈå≤
</div>
<div v-if="isMemorySlotSaved(contextMenuIndex)" class="context-menu-item delete-item" @click="confirmDeleteMemory">
<i class="fas fa-trash"></i>ÂâäÈô§
</div>
</div>
</div>
<div v-if="showSaveDialog" class="location-save-modal" @click="closeSaveDialog">
<div class="location-save-content" @click.stop>
<div class="location-save-title">‰ΩçÁΩÆ„ÇíÁôªÈå≤</div>
<input v-model="saveLocationName" class="location-save-input" placeholder="‰æã: Ëá™ÂÆÖ„ÄÅËÅ∑Â†¥„ÄÅÂ≠¶Ê†°..." @keyup.enter="saveLocationMemory" ref="saveLocationInput" maxlength="20">
<div class="location-save-buttons">
<button class="location-save-btn save-btn" @click="saveLocationMemory">ÁôªÈå≤</button>
<button class="location-save-btn cancel-btn" @click="closeSaveDialog">„Ç≠„É£„É≥„Çª„É´</button>
</div>
</div>
</div>
</div>
<script src="https://unpkg.com/vue@3.0.0"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
<script>
const { createApp, ref, reactive, onMounted, computed, nextTick, watch, onUnmounted } = Vue;
createApp({
  setup() {
    const map = ref(null);
    const marker = ref(null);
    const selectedLatLng = reactive({ lat: 34.6937, lng: 135.5023 });
    const dateList = ref([]);
    const selectedDateIndex = ref(0);
    const weatherData = reactive({});
    const errorMessage = ref('');
    const currentAddress = ref('');
    const hours = Array.from({ length: 17 }, (_, i) => i + 6);
    const tableContainer = ref(null);
    const addressCache = new Map();
    const addressRequestInProgress = ref(false);
    const showContextMenu = ref(false);
    const contextMenuPosition = reactive({ x: 0, y: 0 });
    const contextMenuIndex = ref(0);
    const showSaveDialog = ref(false);
    const locationMemories = ref(Array.from({ length: 5 }, () => ({ name: '', lat: null, lng: null, address: '' })));
    const saveLocationName = ref('');
    const saveLocationIndex = ref(0);
    const longPressTimer = ref(null);
    const saveLocationInput = ref(null);
    const showMap = ref(false);
    const windowWidth = ref(window.innerWidth);
    const selectedMemoryIndex = ref(-1);

    const isMobile = computed(() => windowWidth.value <= 600);
    const hasWeatherData = computed(() => Object.keys(weatherData).length > 0);

    const updateWindowWidth = () => windowWidth.value = window.innerWidth;

    const getMemoryNumber = i => ['‚ë†', '‚ë°', '‚ë¢', '‚ë£', '‚ë§'][i] || `${i + 1}`;

    const isMemorySlotSaved = i => {
      const m = locationMemories.value[i];
      return m.name && m.lat && m.lng;
    };

    const toggleMap = () => {
      showMap.value = !showMap.value;
      showMap.value && map.value && setTimeout(() => map.value.invalidateSize(), 100);
    };

    const startLongPress = (i, e) => {
      longPressTimer.value && clearTimeout(longPressTimer.value);
      longPressTimer.value = setTimeout(() => {
        if (!selectedLatLng.lat || !selectedLatLng.lng) {
          errorMessage.value = 'ÂÖà„Å´Âú∞Âõ≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶‰ΩçÁΩÆ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
          setTimeout(() => errorMessage.value = '', 3000);
          return;
        }
        showContextMenuDialog(i, e);
      }, 600);
    };

    const showContextMenuDialog = (i, e) => {
      contextMenuIndex.value = i;
      let clientX, clientY;
      if (e && e.type.startsWith('touch')) {
        const t = e.touches[0] || e.changedTouches[0];
        clientX = t.clientX;
        clientY = t.clientY;
      } else if (e) {
        clientX = e.clientX;
        clientY = e.clientY;
      } else {
        clientX = windowWidth.value / 2;
        clientY = window.innerHeight / 2;
      }
      const w = 180, h = 120;
      let x = clientX, y = clientY;
      x + w > windowWidth.value - 20 && (x = windowWidth.value - w - 20);
      y + h > window.innerHeight - 20 && (y = clientY - h - 10);
      contextMenuPosition.x = Math.max(20, x);
      contextMenuPosition.y = Math.max(20, y);
      showContextMenu.value = true;
    };

    const openSaveDialog = () => {
      saveLocationIndex.value = contextMenuIndex.value;
      saveLocationName.value = '';
      closeContextMenu();
      showSaveDialog.value = true;
      nextTick(() => setTimeout(() => saveLocationInput.value && saveLocationInput.value.focus(), 200));
    };

    const confirmDeleteMemory = () => {
      const m = locationMemories.value[contextMenuIndex.value];
      confirm(`„Äå${m.name}„Äç„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü`) && deleteLocationMemory();
      closeContextMenu();
    };

    const deleteLocationMemory = () => {
      selectedMemoryIndex.value === contextMenuIndex.value && (selectedMemoryIndex.value = -1);
      locationMemories.value[contextMenuIndex.value] = { name: '', lat: null, lng: null, address: '' };
      saveLocationMemoriesToStorage();
      errorMessage.value = '„É°„É¢„É™„Éº„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü';
      setTimeout(() => errorMessage.value = '', 2000);
    };

    const closeContextMenu = () => {
      showContextMenu.value = false;
      contextMenuPosition.x = 0;
      contextMenuPosition.y = 0;
      contextMenuIndex.value = 0;
    };

    const closeSaveDialog = () => {
      showSaveDialog.value = false;
      saveLocationName.value = '';
      saveLocationIndex.value = 0;
    };

    const endLongPress = () => {
      longPressTimer.value && (clearTimeout(longPressTimer.value), longPressTimer.value = null);
    };

    const getJSTDateString = (d = new Date()) => {
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, '0');
      const day = String(d.getDate()).padStart(2, '0');
      return `${y}-${m}-${day}`;
    };

    const isCurrentHour = h => 0 === selectedDateIndex.value && new Date().getHours() === h;

    const scrollToCurrentTime = () => {
      if (0 !== selectedDateIndex.value) return;
      const now = new Date();
      const h = now.getHours();
      h < 6 || h > 22 || windowWidth.value > 600 || setTimeout(() => {
        const el = document.getElementById(`mobile-hour-${h}`);
        if (el && tableContainer.value) {
          const c = tableContainer.value;
          const rect = c.getBoundingClientRect();
          const abs = el.offsetTop;
          const vh = rect.height;
          const rh = el.offsetHeight;
          const target = abs - vh / 2 + rh / 2;
          c.scrollTo({ top: Math.max(0, target), behavior: 'smooth' });
        }
      }, 1000);
    };

    watch(hasWeatherData, v => v && scrollToCurrentTime());

    const temperatureClass = t => void 0 === t || null === t ? '' : t >= 35 ? 'hot-temperature' : t <= 0 ? 'cold-temperature' : '';

    const weatherIcon = (c, p) => {
      if (void 0 !== p) {
        if (p <= 10) return 0 === c ? '‚òÄÔ∏è' : '‚õÖ';
        if (p >= 50) return '‚òî';
        if (p >= 30) return 'üåßÔ∏è';
        if (p >= 11) return 'üå¶Ô∏è';
        return '‚õÖ';
      }
      if (void 0 === c || null === c) return '‚òÄÔ∏è';
      const icons = {
        0: '‚òÄÔ∏è', 1: '‚õÖ', 2: '‚õÖ', 3: '‚õÖ', 45: 'üå´Ô∏è', 48: 'üå´Ô∏è',
        51: 'üå¶Ô∏è', 53: 'üå¶Ô∏è', 55: 'üå¶Ô∏è', 56: 'üå®Ô∏è', 57: 'üå®Ô∏è',
        61: 'üåßÔ∏è', 63: 'üåßÔ∏è', 65: 'üåßÔ∏è', 66: 'üå®Ô∏è', 67: 'üå®Ô∏è',
        71: '‚ùÑÔ∏è', 73: '‚ùÑÔ∏è', 75: '‚ùÑÔ∏è', 77: '‚ùÑÔ∏è',
        80: 'üå¶Ô∏è', 81: 'üå¶Ô∏è', 82: 'üå¶Ô∏è', 85: 'üå®Ô∏è', 86: 'üå®Ô∏è',
        95: '‚õàÔ∏è', 96: '‚õàÔ∏è', 99: '‚õàÔ∏è'
      };
      return icons[c] || '‚òÄÔ∏è';
    };

    const calculateDiscomfortIndex = (t, h) => void 0 === t || null === t || void 0 === h || null === h ? null : Math.round((0.81 * t + 0.01 * h * (0.99 * t - 14.3) + 46.3) * 10) / 10;

    const discomfortLevel = d => null === d || void 0 === d ? '-' : d < 55 ? 'ÂØí„ÅÑ' : d < 60 ? 'ËÇåÂØí„ÅÑ' : d < 65 ? '‰Ωï„ÇÇÊÑü„Åò„Å™„ÅÑ' : d < 70 ? 'Âø´„ÅÑ' : d < 75 ? 'Êöë„Åè„Å™„ÅÑ' : d < 80 ? '„ÇÑ„ÇÑÊöë„ÅÑ' : d < 85 ? 'Êöë„Åè„Å¶Ê±ó„ÅåÂá∫„Çã' : 'Êöë„Åè„Å¶„Åü„Åæ„Çâ„Å™„ÅÑ';

    const loadLocationMemoriesFromStorage = () => {
      const s = localStorage.getItem('fukuanvi-location-memories');
      if (s) try {
        locationMemories.value = JSON.parse(s);
      } catch (e) {
        console.error('‰ΩçÁΩÆ„É°„É¢„É™„Éº„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:', e);
      }
    };

    const saveLocationMemoriesToStorage = () => localStorage.setItem('fukuanvi-location-memories', JSON.stringify(locationMemories.value));

    const saveLocationMemory = () => {
      const n = saveLocationName.value.trim();
      n && n.length <= 20 ? (
        locationMemories.value[saveLocationIndex.value] = {
          name: n,
          lat: selectedLatLng.lat,
          lng: selectedLatLng.lng,
          address: currentAddress.value
        },
        saveLocationMemoriesToStorage(),
        closeSaveDialog()
      ) : n ? errorMessage.value = '‰ΩçÁΩÆÂêç„ÅØ20ÊñáÂ≠ó‰ª•ÂÜÖ„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ' : saveLocationInput.value && saveLocationInput.value.focus();
      n || (errorMessage.value && setTimeout(() => errorMessage.value = '', 3000));
    };

    const loadLocationMemory = i => {
      const m = locationMemories.value[i];
      m.name && m.lat && m.lng && (
        selectedMemoryIndex.value = i,
        selectedLatLng.lat = m.lat,
        selectedLatLng.lng = m.lng,
        currentAddress.value = '‰ΩçÁΩÆÊÉÖÂ†±ÂèñÂæó‰∏≠...',
        map.value && (map.value.setView([m.lat, m.lng], 10), updateMarker()),
        fetchAddress(m.lat, m.lng),
        fetchWeatherData()
      );
    };

    const fetchAddress = async (lat, lng) => {
      const k = `${lat.toFixed(3)},${lng.toFixed(3)}`;
      if (addressCache.has(k)) return void (currentAddress.value = addressCache.get(k));
      if (addressRequestInProgress.value) return;
      addressRequestInProgress.value = true;
      try {
        const c = new AbortController();
        const tid = setTimeout(() => c.abort(), 3000);
        const r = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json&addressdetails=1&accept-language=ja&zoom=10`, { signal: c.signal });
        if (clearTimeout(tid), !r.ok) throw new Error('‰ΩèÊâÄÂèñÂæó„Å´Â§±Êïó');
        const d = await r.json();
        const a = d.address;
        let display = '‰ΩçÁΩÆ„ÇíÈÅ∏Êäû';
        if (a) {
          const pref = a.state || a.prefecture || '';
          const city = a.city || a.town || a.village || a.municipality || '';
          display = pref && city ? `${pref} ${city}` : pref || city;
        }
        addressCache.size >= 100 && addressCache.delete(addressCache.keys().next().value);
        addressCache.set(k, display);
        currentAddress.value = display;
      } catch (e) {
        currentAddress.value = '‰ΩçÁΩÆ„ÇíÈÅ∏Êäû';
      } finally {
        addressRequestInProgress.value = false;
      }
    };

    const initMap = () => {
      const el = document.getElementById('map');
      if (!el) return;
      map.value && (map.value.remove(), map.value = null);
      try {
        map.value = L.map('map', { preferCanvas: true, zoomControl: true }).setView([selectedLatLng.lat, selectedLatLng.lng], 8);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
          attribution: '¬© OpenStreetMap contributors',
          loading: 'lazy'
        }).addTo(map.value);
        const icon = L.divIcon({
          html: '<div style="background: linear-gradient(135deg, #3385ff, #0059b3); color: white; width: 32px; height: 32px; border-radius: 50% 50% 50% 0; transform: rotate(-45deg); display: flex; align-items: center; justify-content: center; box-shadow: 0 3px 8px rgba(51, 133, 255, 0.4); border: 3px solid white;"><i class="fas fa-shirt" style="transform: rotate(45deg); font-size: 14px;"></i></div>',
          className: 'custom-location-marker',
          iconSize: [32, 32],
          iconAnchor: [16, 32],
          popupAnchor: [0, -32]
        });
        marker.value = L.marker([selectedLatLng.lat, selectedLatLng.lng], { icon }).addTo(map.value);
        map.value.on('click', e => {
          selectedMemoryIndex.value = -1;
          selectedLatLng.lat = e.latlng.lat;
          selectedLatLng.lng = e.latlng.lng;
          updateMarker();
          fetchWeatherData();
          fetchAddress(e.latlng.lat, e.latlng.lng);
        });
        setTimeout(() => map.value && map.value.invalidateSize(), 100);
      } catch (e) {
        errorMessage.value = 'Âú∞Âõ≥„ÅÆÂàùÊúüÂåñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
      }
    };

    const updateMarker = () => marker.value && marker.value.setLatLng([selectedLatLng.lat, selectedLatLng.lng]);

    const getCurrentLocation = () => {
      if (!navigator.geolocation) return void (errorMessage.value = '‚ùå „Åì„ÅÆ„Éá„Éê„Ç§„Çπ„ÅØ‰ΩçÁΩÆÊÉÖÂ†±„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ\nÊâãÂãï„ÅßÂú∞Âõ≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶‰ΩçÁΩÆ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
      selectedMemoryIndex.value = -1;
      currentAddress.value = 'üîÑ ‰ΩçÁΩÆÊÉÖÂ†±ÂèñÂæó‰∏≠...';
      errorMessage.value = '';
      const opts = { enableHighAccuracy: true, timeout: 15000, maximumAge: 60000 };
      navigator.geolocation.getCurrentPosition(pos => {
        selectedLatLng.lat = pos.coords.latitude;
        selectedLatLng.lng = pos.coords.longitude;
        map.value && (map.value.setView([selectedLatLng.lat, selectedLatLng.lng], 12), updateMarker());
        fetchWeatherData();
        fetchAddress(pos.coords.latitude, pos.coords.longitude);
      }, err => {
        let msg = '';
        switch (err.code) {
          case err.PERMISSION_DENIED:
            msg = 'üö´ ‰ΩçÁΩÆÊÉÖÂ†±„ÅÆ„Ç¢„ÇØ„Çª„Çπ„ÅåÊãíÂê¶„Åï„Çå„Åæ„Åó„Åü„ÄÇ\n\n„ÄêËß£Ê±∫ÊñπÊ≥ï„Äë\n1. „Éñ„É©„Ç¶„Ç∂„ÅÆ„Ç¢„Éâ„É¨„Çπ„Éê„ÉºÂ∑¶„ÅÆüîí„Éû„Éº„ÇØ„Çí„Çø„ÉÉ„Éó\n2. ‰ΩçÁΩÆÊÉÖÂ†±„Çí„ÄåË®±ÂèØ„Äç„Å´Â§âÊõ¥\n3. „Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶ÂÜçÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ';
            break;
          case err.POSITION_UNAVAILABLE:
            msg = 'üìç ‰ΩçÁΩÆÊÉÖÂ†±„ÇíÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„ÄÇ\n\n„ÄêÁ¢∫Ë™ç‰∫ãÈ†Ö„Äë\n‚Ä¢ GPS„Åå„Ç™„É≥„Å´„Å™„Å£„Å¶„ÅÑ„Çã„Åã\n‚Ä¢ Â±ãÂ§ñ„Å´„ÅÑ„Çã„ÅãÔºàÂ±ãÂÜÖ„Åß„ÅØÂèñÂæóÂõ∞Èõ£Ôºâ\n‚Ä¢ Ê©üÂÜÖ„É¢„Éº„Éâ„Åå„Ç™„Éï„Å´„Å™„Å£„Å¶„ÅÑ„Çã„Åã';
            break;
          case err.TIMEOUT:
            msg = '‚è±Ô∏è ‰ΩçÁΩÆÊÉÖÂ†±„ÅÆÂèñÂæó„Åå„Çø„Ç§„É†„Ç¢„Ç¶„Éà„Åó„Åæ„Åó„Åü„ÄÇ\n\n„Äê„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„Äë\n‚Ä¢ ÈõªÊ≥¢„ÅÆËâØ„ÅÑÂ†¥ÊâÄ„Å´ÁßªÂãï\n‚Ä¢ Â∞ë„ÅóÊôÇÈñì„Çí„Åä„ÅÑ„Å¶ÂÜçÂ∫¶ÂÆüË°å\n‚Ä¢ ÊâãÂãï„ÅßÂú∞Âõ≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶‰ΩçÁΩÆÈÅ∏Êäû';
            break;
          default:
            msg = `‚ùå ‰ΩçÁΩÆÊÉÖÂ†±ÂèñÂæó„Ç®„É©„Éº\n\n„Ç®„É©„Éº„Ç≥„Éº„Éâ: ${err.code}\n„É°„ÉÉ„Çª„Éº„Ç∏: ${err.message}\n\nÊâãÂãï„ÅßÂú∞Âõ≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶‰ΩçÁΩÆ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;
        }
        errorMessage.value = msg;
        currentAddress.value = '‰ΩçÁΩÆ„ÇíÈÅ∏Êäû';
        setTimeout(() => errorMessage.value = '', 15000);
      }, opts);
    };

    const generateDateList = () => {
      const today = new Date();
      dateList.value = [];
      for (let i = 0; i <= 7; i++) {
        const d = new Date(today);
        d.setDate(today.getDate() + i);
        dateList.value.push(getJSTDateString(d));
      }
    };

    const dateLabel = (s, i) => 0 === i ? '‰ªäÊó•' : 1 === i ? 'ÊòéÊó•' : 2 === i ? 'ÊòéÂæåÊó•' : 7 === i ? '1ÈÄ±ÈñìÂæå' : `${i}Êó•Âæå`;

    const formatDateDetail = s => {
      const d = new Date(s);
      const m = d.getMonth() + 1;
      const day = d.getDate();
      const w = d.toLocaleDateString('ja-JP', { weekday: 'short' });
      return `${m}/${day}Ôºà${w}Ôºâ`;
    };

    const selectDate = i => {
      selectedDateIndex.value = i;
      selectedLatLng.lat && selectedLatLng.lng && fetchWeatherData();
    };

    const fetchWeatherData = () => {
      errorMessage.value = '';
      Object.keys(weatherData).forEach(k => delete weatherData[k]);
      const d = dateList.value[selectedDateIndex.value];
      const lat = selectedLatLng.lat.toFixed(4);
      const lng = selectedLatLng.lng.toFixed(4);
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lng}&hourly=temperature_2m,apparent_temperature,relative_humidity_2m,precipitation_probability,weather_code&start_date=${d}&end_date=${d}&timezone=Asia/Tokyo`;
      const c = new AbortController();
      const tid = setTimeout(() => c.abort(), 15000);
      fetch(url, { signal: c.signal }).then(r => {
        if (clearTimeout(tid), !r.ok) throw new Error('Â§©Ê∞ó„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Ç§„É≥„Çø„Éº„Éç„ÉÉ„ÉàÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
        return r.json();
      }).then(data => {
        if (!data.hourly) throw new Error('Â§©Ê∞ó„Éá„Éº„Çø„ÅÆËß£Êûê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Åó„Å∞„Çâ„ÅèÊôÇÈñì„Çí„Åä„ÅÑ„Å¶ÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
        for (const h of hours) {
          const idx = data.hourly.time.findIndex(t => t.endsWith(`T${h.toString().padStart(2, '0')}:00`));
          -1 !== idx && (weatherData[h] = {
            temperature_2m: Math.round(data.hourly.temperature_2m[idx]),
            apparent_temperature: Math.round(data.hourly.apparent_temperature[idx]),
            relative_humidity_2m: Math.round(data.hourly.relative_humidity_2m[idx]),
            precipitation_probability: Math.round(data.hourly.precipitation_probability[idx] || 0),
            weather_code: data.hourly.weather_code[idx]
          });
        }
      }).catch(e => {
        clearTimeout(tid);
        errorMessage.value = 'AbortError' === e.name ? 'Â§©Ê∞ó„Éá„Éº„Çø„ÅÆÂèñÂæó„Åå„Çø„Ç§„É†„Ç¢„Ç¶„Éà„Åó„Åæ„Åó„Åü„ÄÇÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ' : e.message;
        setTimeout(() => errorMessage.value = '', 8000);
      });
    };

    const clothingIcon = (t, h) => {
      if (void 0 === t || null === t) return '';
      let adj = t;
      h >= 6 && h <= 9 || h >= 18 && h <= 21 ? adj -= 1.5 : (h >= 22 || h <= 5) && (adj -= 1);
      return adj >= 35 ? 'üßò‚Äç‚ôÇÔ∏è' : adj >= 30 ? 'üèãÔ∏è‚Äç‚ôÇÔ∏è' : adj >= 27 ? 'üëï' : adj >= 24 ? 'üëî' : adj >= 21 ? 'ü¶∫' : 'üß•';
    };

    const clothingLabel = (t, h) => {
      if (void 0 === t || null === t) return '-';
      let adj = t;
      h >= 6 && h <= 9 || h >= 18 && h <= 21 ? adj -= 1.5 : (h >= 22 || h <= 5) && (adj -= 1);
      return adj >= 35 ? 'ÂÖ®Ë£∏„É¨„Éô„É´' : adj >= 30 ? '„Çø„É≥„ÇØ„Éà„ÉÉ„Éó' : adj >= 27 ? 'ÂçäË¢ñT„Ç∑„É£„ÉÑ' : adj >= 24 ? 'Èï∑Ë¢ñT„Ç∑„É£„ÉÑ' : adj >= 21 ? 'ËñÑÊâã„Ç´„Éº„Éá„Ç£„Ç¨„É≥' : adj >= 18 ? '„Çª„Éº„Çø„Éº' : adj >= 15 ? '„Éë„Éº„Ç´„Éº' : adj >= 12 ? '„Ç∏„É£„Ç±„ÉÉ„Éà' : adj >= 9 ? '„Ç≥„Éº„Éà' : adj >= 6 ? 'ÂéöÊâã„Ç≥„Éº„Éà' : adj >= 3 ? '„ÉÄ„Ç¶„É≥„Ç∏„É£„Ç±„ÉÉ„Éà' : 'Èò≤ÂØíÁùÄÂÆåÂÖ®Ë£ÖÂÇô';
    };

    onMounted(() => {
      generateDateList();
      const now = new Date();
      now.getHours() >= 21 && (selectedDateIndex.value = 1);
      window.addEventListener('resize', updateWindowWidth);
      nextTick(() => setTimeout(() => {
        initMap();
        loadLocationMemoriesFromStorage();
        locationMemories.value[0].name && locationMemories.value[0].lat && locationMemories.value[0].lng ? (
          selectedMemoryIndex.value = 0,
          selectedLatLng.lat = locationMemories.value[0].lat,
          selectedLatLng.lng = locationMemories.value[0].lng,
          map.value && (map.value.setView([selectedLatLng.lat, selectedLatLng.lng], 10), updateMarker()),
          fetchAddress(selectedLatLng.lat, selectedLatLng.lng),
          fetchWeatherData()
        ) : fetchWeatherData();
      }, 200));
    });

    onUnmounted(() => window.removeEventListener('resize', updateWindowWidth));

    return {
      dateList,
      selectedDateIndex,
      selectDate,
      dateLabel,
      formatDateDetail,
      weatherData,
      hours,
      clothingIcon,
      clothingLabel,
      weatherIcon,
      calculateDiscomfortIndex,
      discomfortLevel,
      errorMessage,
      hasWeatherData,
      getCurrentLocation,
      currentAddress,
      isCurrentHour,
      temperatureClass,
      locationMemories,
      showSaveDialog,
      saveLocationName,
      saveLocationInput,
      startLongPress,
      endLongPress,
      saveLocationMemory,
      closeSaveDialog,
      loadLocationMemory,
      tableContainer,
      scrollToCurrentTime,
      getMemoryNumber,
      showContextMenu,
      contextMenuPosition,
      contextMenuIndex,
      isMemorySlotSaved,
      openSaveDialog,
      confirmDeleteMemory,
      deleteLocationMemory,
      closeContextMenu,
      showMap,
      toggleMap,
      isMobile,
      selectedMemoryIndex
    };
  }
}).mount('#app');

'serviceWorker' in navigator && ('https:' === location.protocol || 'localhost' === location.hostname) && window.addEventListener('load', () => navigator.serviceWorker.register('/sw.js').then(r => console.log('SW registered: ', r)).catch(e => console.log('SW registration failed: ', e)));
</script>
</body>
</html>
