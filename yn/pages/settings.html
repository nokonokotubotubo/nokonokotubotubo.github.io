<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="è¨­å®šç®¡ç† - ã‚ãªãŸã®ãƒ‹ãƒ¥ãƒ¼ã‚¹">
    <title>è¨­å®š - ã‚ãªãŸã®ãƒ‹ãƒ¥ãƒ¼ã‚¹</title>
    
    <!-- PWAè¨­å®š -->
    <meta name="theme-color" content="#2196F3">
    <link rel="manifest" href="../assets/manifest.json">
    
    <!-- ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆ -->
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/responsive.css">
    <link rel="stylesheet" href="../styles/components.css">
    <link rel="stylesheet" href="../styles/themes.css">
    
    <!-- è¨­å®šç”»é¢å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« -->
    <style>
        .settings-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #9C27B0;
        }
        
        .page-title {
            color: #9C27B0;
            margin: 0 0 0.5rem 0;
            font-size: 2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .page-description {
            color: #666;
            font-size: 1.1rem;
            margin: 0;
        }
        
        .settings-sections {
            display: grid;
            gap: 2rem;
        }
        
        .settings-section {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .section-icon {
            font-size: 1.5rem;
        }
        
        .section-title {
            color: #333;
            margin: 0;
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .section-description {
            color: #666;
            font-size: 0.9rem;
            margin: 0.3rem 0 0 0;
            line-height: 1.4;
        }
        
        .setting-group {
            display: grid;
            gap: 1.5rem;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border: 1px solid #f0f0f0;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .setting-item:hover {
            background: #f8f9fa;
            border-color: #e0e0e0;
        }
        
        .setting-info {
            flex: 1;
            min-width: 0;
            margin-right: 1rem;
        }
        
        .setting-label {
            font-weight: 600;
            color: #333;
            margin: 0 0 0.3rem 0;
            font-size: 1rem;
        }
        
        .setting-help {
            color: #666;
            font-size: 0.85rem;
            margin: 0;
            line-height: 1.4;
        }
        
        .setting-control {
            flex-shrink: 0;
        }
        
        /* ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒ */
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #ddd;
            border-radius: 30px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .toggle-switch.active {
            background: #4CAF50;
        }
        
        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 26px;
            height: 26px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.3s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        
        .toggle-switch.active::after {
            transform: translateX(30px);
        }
        
        /* é¸æŠãƒœãƒƒã‚¯ã‚¹ */
        .setting-select {
            padding: 0.6rem 1rem;
            border: 2px solid #ddd;
            border-radius: 6px;
            background: white;
            font-size: 0.9rem;
            cursor: pointer;
            min-width: 150px;
        }
        
        .setting-select:focus {
            outline: none;
            border-color: #9C27B0;
        }
        
        /* æ•°å€¤å…¥åŠ› */
        .setting-number {
            padding: 0.6rem 1rem;
            border: 2px solid #ddd;
            border-radius: 6px;
            background: white;
            font-size: 0.9rem;
            width: 100px;
            text-align: center;
        }
        
        .setting-number:focus {
            outline: none;
            border-color: #9C27B0;
        }
        
        /* ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã‚¨ãƒªã‚¢ */
        .keywords-input {
            width: 100%;
            min-height: 100px;
            padding: 1rem;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
            font-family: inherit;
            resize: vertical;
        }
        
        .keywords-input:focus {
            outline: none;
            border-color: #9C27B0;
        }
        
        .keywords-help {
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: #666;
            font-style: italic;
        }
        
        /* ãƒœã‚¿ãƒ³ */
        .setting-btn {
            padding: 0.7rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #9C27B0;
            color: white;
        }
        
        .btn-primary:hover {
            background: #7B1FA2;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #666;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #555;
        }
        
        .btn-danger {
            background: #f44336;
            color: white;
        }
        
        .btn-danger:hover {
            background: #d32f2f;
        }
        
        .btn-success {
            background: #4CAF50;
            color: white;
        }
        
        .btn-success:hover {
            background: #45a049;
        }
        
        /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ç¾¤ */
        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }
        
        /* ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚¨ãƒªã‚¢ */
        .data-stats {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            text-align: center;
        }
        
        .stat-item {
            padding: 0.8rem;
            background: white;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #9C27B0;
            margin-bottom: 0.3rem;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #666;
        }
        
        /* ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ */
        .file-upload {
            position: relative;
            display: inline-block;
            cursor: pointer;
            overflow: hidden;
        }
        
        .file-upload input[type="file"] {
            position: absolute;
            left: -9999px;
        }
        
        .upload-btn {
            display: inline-block;
            padding: 0.7rem 1.5rem;
            background: #2196F3;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .upload-btn:hover {
            background: #1976D2;
        }
        
        /* ãƒ†ãƒ¼ãƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
        .theme-preview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .theme-option {
            padding: 1rem;
            border: 3px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: white;
        }
        
        .theme-option:hover {
            border-color: #9C27B0;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(156,39,176,0.2);
        }
        
        .theme-option.active {
            border-color: #9C27B0;
            background: #f3e5f5;
        }
        
        .theme-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #333;
        }
        
        .theme-colors {
            display: flex;
            justify-content: center;
            gap: 0.3rem;
            margin-bottom: 0.5rem;
        }
        
        .color-swatch {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .theme-description {
            font-size: 0.8rem;
            color: #666;
        }
        
        /* ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚° */
        .confirm-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .confirm-dialog.show {
            opacity: 1;
            visibility: visible;
        }
        
        .confirm-content {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .confirm-dialog.show .confirm-content {
            transform: scale(1);
        }
        
        .confirm-title {
            color: #f44336;
            margin: 0 0 1rem 0;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .confirm-message {
            margin: 0 0 2rem 0;
            line-height: 1.5;
            color: #333;
        }
        
        .confirm-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .settings-container {
                padding: 1rem;
            }
            
            .settings-section {
                padding: 1rem;
            }
            
            .setting-item {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }
            
            .setting-info {
                margin-right: 0;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .theme-preview {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .page-title {
                font-size: 1.5rem;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .confirm-content {
                padding: 1.5rem;
            }
            
            .confirm-actions {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
        
        /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ */
        @media (prefers-color-scheme: dark) {
            .settings-section {
                background: #2e2e2e;
                border-color: #444;
                color: #e0e0e0;
            }
            
            .setting-item {
                border-color: #444;
            }
            
            .setting-item:hover {
                background: #3a3a3a;
            }
            
            .setting-label {
                color: #e0e0e0;
            }
            
            .data-stats {
                background: #1a1a1a;
            }
            
            .stat-item {
                background: #2e2e2e;
                border-color: #444;
            }
            
            .theme-option {
                background: #2e2e2e;
                border-color: #444;
            }
            
            .theme-option.active {
                background: #3a3a3a;
                border-color: #BA68C8;
            }
        }
    </style>
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ -->
    <header class="main-header">
        <div class="header-container">
            <h1 class="app-title">ã‚ãªãŸã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ - è¨­å®š</h1>
            <nav class="main-nav">
                <button class="nav-btn" onclick="location.href='../index.html'">è¨˜äº‹ä¸€è¦§</button>
                <button class="nav-btn" onclick="location.href='rss-manager.html'">RSSç®¡ç†</button>
                <button class="nav-btn" onclick="location.href='favorites.html'">ãŠæ°—ã«å…¥ã‚Š</button>
                <button class="nav-btn active">è¨­å®š</button>
            </nav>
        </div>
    </header>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="settings-container">
        <!-- ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="page-header">
            <h1 class="page-title">
                <span>âš™ï¸</span>
                <span>è¨­å®š</span>
            </h1>
            <p class="page-description">
                ã‚¢ãƒ—ãƒªã®å‹•ä½œè¨­å®šãƒ»AIå­¦ç¿’è¨­å®šãƒ»ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚’è¡Œã„ã¾ã™
            </p>
        </div>

        <!-- è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="settings-sections">
            <!-- åŸºæœ¬è¨­å®š -->
            <section class="settings-section">
                <div class="section-header">
                    <span class="section-icon">ğŸ“±</span>
                    <div>
                        <h2 class="section-title">åŸºæœ¬è¨­å®š</h2>
                        <p class="section-description">ã‚¢ãƒ—ãƒªã®åŸºæœ¬çš„ãªå‹•ä½œã‚’è¨­å®šã—ã¾ã™</p>
                    </div>
                </div>
                
                <div class="setting-group">
                    <div class="setting-item">
                        <div class="setting-info">
                            <h3 class="setting-label">è‡ªå‹•æ›´æ–°</h3>
                            <p class="setting-help">RSSè¨˜äº‹ã®è‡ªå‹•å–å¾—æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã—ã¾ã™</p>
                        </div>
                        <div class="setting-control">
                            <div class="toggle-switch" id="autoRefreshToggle" data-setting="autoRefresh"></div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <h3 class="setting-label">æ›´æ–°é–“éš”</h3>
                            <p class="setting-help">è‡ªå‹•æ›´æ–°ã®é–“éš”ï¼ˆåˆ†ï¼‰</p>
                        </div>
                        <div class="setting-control">
                            <input type="number" class="setting-number" id="refreshInterval" 
                                   min="5" max="180" step="5" value="30">
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <h3 class="setting-label">1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®è¨˜äº‹æ•°</h3>
                            <p class="setting-help">ä¸€åº¦ã«è¡¨ç¤ºã™ã‚‹è¨˜äº‹ã®æ•°</p>
                        </div>
                        <div class="setting-control">
                            <select class="setting-select" id="articlesPerPage">
                                <option value="20">20ä»¶</option>
                                <option value="50">50ä»¶</option>
                                <option value="100">100ä»¶</option>
                                <option value="200">200ä»¶</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <h3 class="setting-label">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚½ãƒ¼ãƒˆ</h3>
                            <p class="setting-help">è¨˜äº‹ä¸€è¦§ã®åˆæœŸä¸¦ã³é †</p>
                        </div>
                        <div class="setting-control">
                            <select class="setting-select" id="defaultSort">
                                <option value="interest">AIèˆˆå‘³åº¦é †</option>
                                <option value="date">æ›´æ–°æ—¥æ™‚é †</option>
                                <option value="domain">ãƒ‰ãƒ¡ã‚¤ãƒ³é †</option>
                                <option value="keyword-match">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¸€è‡´åº¦é †</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <h3 class="setting-label">è¨˜äº‹ç”»åƒè¡¨ç¤º</h3>
                            <p class="setting-help">è¨˜äº‹ã‚«ãƒ¼ãƒ‰ã«ç”»åƒã‚’è¡¨ç¤ºã—ã¾ã™</p>
                        </div>
                        <div class="setting-control">
                            <div class="toggle-switch" id="showImagesToggle" data-setting="showImages"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- AIãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¨­å®š -->
            <section class="settings-section">
                <div class="section-header">
                    <span class="section-icon">ğŸ¤–</span>
                    <div>
                        <h2 class="section-title">AIãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¨­å®š</h2>
                        <p class="section-description">AIå­¦ç¿’ã¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œå‡ºã®è¨­å®šã‚’è¡Œã„ã¾ã™</p>
                    </div>
                </div>
                
                <div class="setting-group">
                    <div class="setting-item">
                        <div class="setting-info">
                            <h3 class="setting-label">æ°—ã«ãªã‚‹ãƒ¯ãƒ¼ãƒ‰</h3>
                            <p class="setting-help">ã“ã®ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹è¨˜äº‹ã®èˆˆå‘³åº¦ãŒã‚¢ãƒƒãƒ—ã—ã¾ã™</p>
                            <textarea class="keywords-input" id="interestKeywords" 
                                      placeholder="ä¾‹: AI, æŠ€è¡“, ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°, ãƒ‹ãƒ¥ãƒ¼ã‚¹&#10;ï¼ˆ1è¡Œã«1ã¤ãšã¤å…¥åŠ›ï¼‰"></textarea>
                            <div class="keywords-help">
                                â€» 1è¡Œã«1ã¤ã®ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã€‚ãƒãƒƒãƒã—ãŸè¨˜äº‹ã¯+20ç‚¹ãƒœãƒ¼ãƒŠã‚¹
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <h3 class="setting-label">NGãƒ¯ãƒ¼ãƒ‰</h3>
                            <p class="setting-help">ã“ã®ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹è¨˜äº‹ã¯è‡ªå‹•çš„ã«éè¡¨ç¤ºã«ãªã‚Šã¾ã™</p>
                            <textarea class="keywords-input" id="ngKeywords" 
                                      placeholder="ä¾‹: äº‹æ•…, äº‹ä»¶, æ”¿æ²»&#10;ï¼ˆ1è¡Œã«1ã¤ãšã¤å…¥åŠ›ï¼‰"></textarea>
                            <div class="keywords-help">
                                â€» 1è¡Œã«1ã¤ã®ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã€‚ãƒãƒƒãƒã—ãŸè¨˜äº‹ã¯å³åº§ã«éè¡¨ç¤º
                            </div>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="setting-btn btn-primary" id="saveKeywordsBtn">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¨­å®šä¿å­˜</button>
                        <button class="setting-btn btn-secondary" id="resetAIBtn">AIå­¦ç¿’ãƒªã‚»ãƒƒãƒˆ</button>
                        <button class="setting-btn btn-success" id="retrainAIBtn">AIå†å­¦ç¿’å®Ÿè¡Œ</button>
                    </div>
                </div>
            </section>

            <!-- ãƒ†ãƒ¼ãƒãƒ»å¤–è¦³è¨­å®š -->
            <section class="settings-section">
                <div class="section-header">
                    <span class="section-icon">ğŸ¨</span>
                    <div>
                        <h2 class="section-title">ãƒ†ãƒ¼ãƒãƒ»å¤–è¦³è¨­å®š</h2>
                        <p class="section-description">ã‚¢ãƒ—ãƒªã®è¦‹ãŸç›®ã‚’å¤‰æ›´ã§ãã¾ã™</p>
                    </div>
                </div>
                
                <div class="setting-group">
                    <div class="theme-preview">
                        <div class="theme-option active" data-theme="light">
                            <div class="theme-name">ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒ</div>
                            <div class="theme-colors">
                                <div class="color-swatch" style="background: #ffffff;"></div>
                                <div class="color-swatch" style="background: #2196F3;"></div>
                                <div class="color-swatch" style="background: #4CAF50;"></div>
                            </div>
                            <div class="theme-description">æ˜ã‚‹ãè¦‹ã‚„ã™ã„ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒ¼ãƒ</div>
                        </div>
                        
                        <div class="theme-option" data-theme="dark">
                            <div class="theme-name">ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒ</div>
                            <div class="theme-colors">
                                <div class="color-swatch" style="background: #121212;"></div>
                                <div class="color-swatch" style="background: #64B5F6;"></div>
                                <div class="color-swatch" style="background: #66BB6A;"></div>
                            </div>
                            <div class="theme-description">ç›®ã«å„ªã—ã„æš—ã‚ã®ãƒ†ãƒ¼ãƒ</div>
                        </div>
                        
                        <div class="theme-option" data-theme="sepia">
                            <div class="theme-name">ã‚»ãƒ”ã‚¢ãƒ†ãƒ¼ãƒ</div>
                            <div class="theme-colors">
                                <div class="color-swatch" style="background: #f4f1ea;"></div>
                                <div class="color-swatch" style="background: #8b4513;"></div>
                                <div class="color-swatch" style="background: #6b8e23;"></div>
                            </div>
                            <div class="theme-description">èª­æ›¸ã«é›†ä¸­ã§ãã‚‹è½ã¡ç€ã„ãŸãƒ†ãƒ¼ãƒ</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç† -->
            <section class="settings-section">
                <div class="section-header">
                    <span class="section-icon">ğŸ’¾</span>
                    <div>
                        <h2 class="section-title">ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
                        <p class="section-description">ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†ãƒ»ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’è¡Œã„ã¾ã™</p>
                    </div>
                </div>
                
                <div class="data-stats">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="totalArticlesData">0</div>
                            <div class="stat-label">ä¿å­˜è¨˜äº‹æ•°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="totalRSSData">0</div>
                            <div class="stat-label">RSSæ•°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="storageUsage">0</div>
                            <div class="stat-label">ä½¿ç”¨å®¹é‡ (KB)</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="lastBackup">æœªå®Ÿè¡Œ</div>
                            <div class="stat-label">æœ€çµ‚ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</div>
                        </div>
                    </div>
                </div>
                
                <div class="setting-group">
                    <div class="action-buttons">
                        <button class="setting-btn btn-success" id="exportDataBtn">ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                        <div class="file-upload">
                            <input type="file" id="importDataFile" accept=".json">
                            <label for="importDataFile" class="upload-btn">ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</label>
                        </div>
                        <button class="setting-btn btn-secondary" id="cleanOldDataBtn">å¤ã„ãƒ‡ãƒ¼ã‚¿å‰Šé™¤</button>
                        <button class="setting-btn btn-danger" id="clearAllDataBtn">å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤</button>
                    </div>
                </div>
            </section>

            <!-- ã‚¢ãƒ—ãƒªæƒ…å ± -->
            <section class="settings-section">
                <div class="section-header">
                    <span class="section-icon">â„¹ï¸</span>
                    <div>
                        <h2 class="section-title">ã‚¢ãƒ—ãƒªæƒ…å ±</h2>
                        <p class="section-description">ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã¨ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹</p>
                    </div>
                </div>
                
                <div class="setting-group">
                    <div class="setting-item">
                        <div class="setting-info">
                            <h3 class="setting-label">ã‚¢ãƒ—ãƒªãƒãƒ¼ã‚¸ãƒ§ãƒ³</h3>
                            <p class="setting-help">ç¾åœ¨ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³</p>
                        </div>
                        <div class="setting-control">
                            <span id="appVersion">1.0.0</span>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <h3 class="setting-label">AIå­¦ç¿’çŠ¶æ³</h3>
                            <p class="setting-help">å­¦ç¿’æ¸ˆã¿èªå½™æ•°ã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ•°</p>
                        </div>
                        <div class="setting-control">
                            <span id="aiLearningStatus">èª­ã¿è¾¼ã¿ä¸­...</span>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <h3 class="setting-label">PWAçŠ¶æ…‹</h3>
                            <p class="setting-help">ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«çŠ¶æ³</p>
                        </div>
                        <div class="setting-control">
                            <span id="pwaStatus">ç¢ºèªä¸­...</span>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="setting-btn btn-primary" id="checkUpdateBtn">æ›´æ–°ç¢ºèª</button>
                        <button class="setting-btn btn-secondary" id="resetSettingsBtn">è¨­å®šãƒªã‚»ãƒƒãƒˆ</button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚° -->
    <div class="confirm-dialog" id="confirmDialog">
        <div class="confirm-content">
            <h3 class="confirm-title" id="confirmTitle">ç¢ºèª</h3>
            <p class="confirm-message" id="confirmMessage">ã“ã®æ“ä½œã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ</p>
            <div class="confirm-actions">
                <button class="setting-btn btn-danger" id="confirmYes">å®Ÿè¡Œ</button>
                <button class="setting-btn btn-secondary" id="confirmNo">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>

    <!-- ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã‚¨ãƒªã‚¢ -->
    <div class="notification-area" id="notificationArea"></div>

    <!-- ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ -->
    <script src="../scripts/data-manager.js"></script>
    <script src="../scripts/utils.js"></script>
    
    <!-- è¨­å®šç”»é¢å°‚ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script>
        class SettingsManager {
            constructor() {
                this.dataManager = null;
                this.currentSettings = {};
                this.isInitialized = false;
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
                this.defaultSettings = {
                    autoRefresh: false,
                    refreshInterval: 30,
                    articlesPerPage: 50,
                    defaultSort: 'interest',
                    showImages: true,
                    theme: 'light',
                    interestKeywords: [],
                    ngKeywords: []
                };
            }
            
            async initialize() {
                try {
                    console.log('Settings ManageråˆæœŸåŒ–é–‹å§‹');
                    
                    // ä¾å­˜ã‚¯ãƒ©ã‚¹åˆæœŸåŒ–
                    this.dataManager = new DataManager();
                    await this.dataManager.initialize();
                    
                    // è¨­å®šãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
                    await this.loadSettings();
                    
                    // UIåˆæœŸåŒ–
                    this.setupEventListeners();
                    this.updateUI();
                    this.updateDataStats();
                    this.updateSystemInfo();
                    
                    this.isInitialized = true;
                    console.log('Settings ManageråˆæœŸåŒ–å®Œäº†');
                    
                } catch (error) {
                    console.error('Settings ManageråˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                    this.showNotification('è¨­å®šç®¡ç†æ©Ÿèƒ½ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
            
            async loadSettings() {
                try {
                    // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šèª­ã¿è¾¼ã¿
                    const userPrefs = await this.dataManager.loadUserPreferences();
                    
                    // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¨­å®šèª­ã¿è¾¼ã¿
                    const keywords = await this.dataManager.loadData('yourNews_keywords') || 
                                   { interestWords: [], ngWords: [] };
                    
                    // è¨­å®šçµ±åˆ
                    this.currentSettings = {
                        ...this.defaultSettings,
                        ...userPrefs,
                        interestKeywords: keywords.interestWords || [],
                        ngKeywords: keywords.ngWords || []
                    };
                    
                    console.log('è¨­å®šãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†:', this.currentSettings);
                    
                } catch (error) {
                    console.error('è¨­å®šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                    this.currentSettings = { ...this.defaultSettings };
                }
            }
            
            setupEventListeners() {
                // ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒ
                document.querySelectorAll('.toggle-switch').forEach(toggle => {
                    toggle.addEventListener('click', () => {
                        const setting = toggle.dataset.setting;
                        if (setting) {
                            this.toggleSetting(setting, toggle);
                        }
                    });
                });
                
                // æ•°å€¤ãƒ»é¸æŠå…¥åŠ›
                ['refreshInterval', 'articlesPerPage', 'defaultSort'].forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.addEventListener('change', (e) => {
                            const value = e.target.type === 'number' ? parseInt(e.target.value) : e.target.value;
                            this.updateSetting(id, value);
                        });
                    }
                });
                
                // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¿å­˜
                const saveKeywordsBtn = document.getElementById('saveKeywordsBtn');
                if (saveKeywordsBtn) {
                    saveKeywordsBtn.addEventListener('click', () => {
                        this.saveKeywords();
                    });
                }
                
                // AIæ“ä½œãƒœã‚¿ãƒ³
                const resetAIBtn = document.getElementById('resetAIBtn');
                if (resetAIBtn) {
                    resetAIBtn.addEventListener('click', () => {
                        this.confirmAction('AIå­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ', 'AIå­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã€‚ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚', () => {
                            this.resetAILearning();
                        });
                    });
                }
                
                const retrainAIBtn = document.getElementById('retrainAIBtn');
                if (retrainAIBtn) {
                    retrainAIBtn.addEventListener('click', () => {
                        this.retrainAI();
                    });
                }
                
                // ãƒ†ãƒ¼ãƒé¸æŠ
                document.querySelectorAll('.theme-option').forEach(option => {
                    option.addEventListener('click', () => {
                        const theme = option.dataset.theme;
                        this.changeTheme(theme);
                    });
                });
                
                // ãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒœã‚¿ãƒ³
                this.setupDataManagementListeners();
                
                // ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±ãƒœã‚¿ãƒ³
                this.setupSystemInfoListeners();
                
                // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
                this.setupConfirmDialog();
            }
            
            setupDataManagementListeners() {
                // ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                const exportBtn = document.getElementById('exportDataBtn');
                if (exportBtn) {
                    exportBtn.addEventListener('click', () => {
                        this.exportData();
                    });
                }
                
                // ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                const importFile = document.getElementById('importDataFile');
                if (importFile) {
                    importFile.addEventListener('change', (e) => {
                        if (e.target.files.length > 0) {
                            this.importData(e.target.files[0]);
                        }
                    });
                }
                
                // å¤ã„ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
                const cleanBtn = document.getElementById('cleanOldDataBtn');
                if (cleanBtn) {
                    cleanBtn.addEventListener('click', () => {
                        this.confirmAction('å¤ã„ãƒ‡ãƒ¼ã‚¿å‰Šé™¤', '7æ—¥ä»¥ä¸Šå‰ã®è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã€‚', () => {
                            this.cleanOldData();
                        });
                    });
                }
                
                // å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
                const clearBtn = document.getElementById('clearAllDataBtn');
                if (clearBtn) {
                    clearBtn.addEventListener('click', () => {
                        this.confirmAction('å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤', 'ã™ã¹ã¦ã®è¨˜äº‹ãƒ»è¨­å®šãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã€‚ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚', () => {
                            this.clearAllData();
                        });
                    });
                }
            }
            
            setupSystemInfoListeners() {
                // æ›´æ–°ç¢ºèª
                const checkUpdateBtn = document.getElementById('checkUpdateBtn');
                if (checkUpdateBtn) {
                    checkUpdateBtn.addEventListener('click', () => {
                        this.checkForUpdates();
                    });
                }
                
                // è¨­å®šãƒªã‚»ãƒƒãƒˆ
                const resetSettingsBtn = document.getElementById('resetSettingsBtn');
                if (resetSettingsBtn) {
                    resetSettingsBtn.addEventListener('click', () => {
                        this.confirmAction('è¨­å®šãƒªã‚»ãƒƒãƒˆ', 'ã™ã¹ã¦ã®è¨­å®šã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã—ã¾ã™ã€‚', () => {
                            this.resetSettings();
                        });
                    });
                }
            }
            
            setupConfirmDialog() {
                const dialog = document.getElementById('confirmDialog');
                const yesBtn = document.getElementById('confirmYes');
                const noBtn = document.getElementById('confirmNo');
                
                if (noBtn) {
                    noBtn.addEventListener('click', () => {
                        this.hideConfirmDialog();
                    });
                }
                
                if (dialog) {
                    dialog.addEventListener('click', (e) => {
                        if (e.target === dialog) {
                            this.hideConfirmDialog();
                        }
                    });
                }
            }
            
            updateUI() {
                try {
                    // ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒæ›´æ–°
                    document.querySelectorAll('.toggle-switch').forEach(toggle => {
                        const setting = toggle.dataset.setting;
                        if (setting && this.currentSettings[setting] !== undefined) {
                            toggle.classList.toggle('active', this.currentSettings[setting]);
                        }
                    });
                    
                    // å…¥åŠ›å€¤æ›´æ–°
                    const inputMappings = {
                        refreshInterval: 'refreshInterval',
                        articlesPerPage: 'articlesPerPage',
                        defaultSort: 'defaultSort'
                    };
                    
                    Object.entries(inputMappings).forEach(([elementId, settingKey]) => {
                        const element = document.getElementById(elementId);
                        if (element && this.currentSettings[settingKey] !== undefined) {
                            element.value = this.currentSettings[settingKey];
                        }
                    });
                    
                    // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ›´æ–°
                    const interestInput = document.getElementById('interestKeywords');
                    if (interestInput) {
                        interestInput.value = this.currentSettings.interestKeywords.join('\n');
                    }
                    
                    const ngInput = document.getElementById('ngKeywords');
                    if (ngInput) {
                        ngInput.value = this.currentSettings.ngKeywords.join('\n');
                    }
                    
                    // ãƒ†ãƒ¼ãƒæ›´æ–°
                    document.querySelectorAll('.theme-option').forEach(option => {
                        option.classList.toggle('active', option.dataset.theme === this.currentSettings.theme);
                    });
                    
                    // ãƒ†ãƒ¼ãƒé©ç”¨
                    this.applyTheme(this.currentSettings.theme);
                    
                } catch (error) {
                    console.error('UIæ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                }
            }
            
            toggleSetting(settingKey, toggleElement) {
                const newValue = !this.currentSettings[settingKey];
                this.updateSetting(settingKey, newValue);
                toggleElement.classList.toggle('active', newValue);
            }
            
            async updateSetting(settingKey, value) {
                try {
                    this.currentSettings[settingKey] = value;
                    
                    // è¨­å®šä¿å­˜
                    const settingsToSave = { ...this.currentSettings };
                    delete settingsToSave.interestKeywords;
                    delete settingsToSave.ngKeywords;
                    
                    await this.dataManager.saveUserPreferences(settingsToSave);
                    
                    console.log(`è¨­å®šæ›´æ–°: ${settingKey} = ${value}`);
                    
                } catch (error) {
                    console.error('è¨­å®šæ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                    this.showNotification('è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
            
            async saveKeywords() {
                try {
                    const interestInput = document.getElementById('interestKeywords');
                    const ngInput = document.getElementById('ngKeywords');
                    
                    const interestWords = interestInput.value
                        .split('\n')
                        .map(word => word.trim())
                        .filter(word => word.length > 0);
                    
                    const ngWords = ngInput.value
                        .split('\n')
                        .map(word => word.trim())
                        .filter(word => word.length > 0);
                    
                    const keywordsData = {
                        interestWords: interestWords,
                        ngWords: ngWords
                    };
                    
                    await this.dataManager.saveData('yourNews_keywords', keywordsData);
                    
                    this.currentSettings.interestKeywords = interestWords;
                    this.currentSettings.ngKeywords = ngWords;
                    
                    this.showNotification('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'success');
                    
                } catch (error) {
                    console.error('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                    this.showNotification('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
            
            async resetAILearning() {
                try {
                    // AIé–¢é€£ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
                    localStorage.removeItem('yourNews_feedback');
                    localStorage.removeItem('yourNews_aiModel');
                    localStorage.removeItem('yourNews_vocabulary');
                    localStorage.removeItem('yourNews_idf');
                    
                    // AIã‚¨ãƒ³ã‚¸ãƒ³ãƒªã‚»ãƒƒãƒˆ
                    if (window.yourNewsApp && window.yourNewsApp.aiEngine) {
                        await window.yourNewsApp.aiEngine.resetModel();
                    }
                    
                    this.showNotification('AIå­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ', 'success');
                    this.updateSystemInfo();
                    
                } catch (error) {
                    console.error('AIå­¦ç¿’ãƒªã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼:', error);
                    this.showNotification('AIå­¦ç¿’ãƒªã‚»ãƒƒãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
            
            async retrainAI() {
                try {
                    if (!window.yourNewsApp || !window.yourNewsApp.aiEngine) {
                        this.showNotification('AIæ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“', 'warning');
                        return;
                    }
                    
                    const retrainBtn = document.getElementById('retrainAIBtn');
                    if (retrainBtn) {
                        retrainBtn.disabled = true;
                        retrainBtn.textContent = 'AIå†å­¦ç¿’ä¸­...';
                    }
                    
                    // å…¨è¨˜äº‹ã®AIå†è¨ˆç®—
                    const articles = await this.dataManager.loadArticles();
                    const keywords = {
                        interestWords: this.currentSettings.interestKeywords,
                        ngWords: this.currentSettings.ngKeywords
                    };
                    
                    for (const article of articles) {
                        const newScore = await window.yourNewsApp.aiEngine.calculateInterestScore(article, keywords);
                        article.interestScore = newScore;
                    }
                    
                    await this.dataManager.saveArticles(articles);
                    
                    this.showNotification('AIå†å­¦ç¿’ãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
                    this.updateSystemInfo();
                    
                } catch (error) {
                    console.error('AIå†å­¦ç¿’ã‚¨ãƒ©ãƒ¼:', error);
                    this.showNotification('AIå†å­¦ç¿’ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                } finally {
                    const retrainBtn = document.getElementById('retrainAIBtn');
                    if (retrainBtn) {
                        retrainBtn.disabled = false;
                        retrainBtn.textContent = 'AIå†å­¦ç¿’å®Ÿè¡Œ';
                    }
                }
            }
            
            changeTheme(theme) {
                try {
                    this.updateSetting('theme', theme);
                    this.applyTheme(theme);
                    
                    // UIæ›´æ–°
                    document.querySelectorAll('.theme-option').forEach(option => {
                        option.classList.toggle('active', option.dataset.theme === theme);
                    });
                    
                    this.showNotification(`ãƒ†ãƒ¼ãƒã‚’${theme}ã«å¤‰æ›´ã—ã¾ã—ãŸ`, 'success');
                    
                } catch (error) {
                    console.error('ãƒ†ãƒ¼ãƒå¤‰æ›´ã‚¨ãƒ©ãƒ¼:', error);
                    this.showNotification('ãƒ†ãƒ¼ãƒã®å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
            
            applyTheme(theme) {
                // ãƒ«ãƒ¼ãƒˆè¦ç´ ã«ãƒ†ãƒ¼ãƒå±æ€§ã‚’è¨­å®š
                document.documentElement.setAttribute('data-theme', theme);
                
                // bodyè¦ç´ ã«ã‚‚ã‚¯ãƒ©ã‚¹è¿½åŠ ï¼ˆäº’æ›æ€§ï¼‰
                document.body.className = document.body.className.replace(/theme-\w+/g, '');
                document.body.classList.add(`theme-${theme}`);
            }
            
            async updateDataStats() {
                try {
                    const articles = await this.dataManager.loadArticles();
                    const rssFeeds = await this.dataManager.loadRssFeeds();
                    
                    // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡è¨ˆç®—
                    let totalSize = 0;
                    for (let key in localStorage) {
                        if (key.startsWith('yourNews_')) {
                            totalSize += localStorage[key].length;
                        }
                    }
                    
                    const sizeKB = Math.round(totalSize / 1024 * 100) / 100;
                    
                    // UIæ›´æ–°
                    const elements = {
                        totalArticlesData: articles.length,
                        totalRSSData: rssFeeds.length,
                        storageUsage: sizeKB,
                        lastBackup: this.getLastBackupDate()
                    };
                    
                    Object.entries(elements).forEach(([id, value]) => {
                        const element = document.getElementById(id);
                        if (element) {
                            element.textContent = value;
                        }
                    });
                    
                } catch (error) {
                    console.error('ãƒ‡ãƒ¼ã‚¿çµ±è¨ˆæ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                }
            }
            
                        updateSystemInfo() {
                try {
                    // ã‚¢ãƒ—ãƒªãƒãƒ¼ã‚¸ãƒ§ãƒ³
                    const versionElement = document.getElementById('appVersion');
                    if (versionElement) {
                        versionElement.textContent = '1.0.0';
                    }
                    
                    // AIå­¦ç¿’çŠ¶æ³
                    const aiStatusElement = document.getElementById('aiLearningStatus');
                    if (aiStatusElement) {
                        if (window.yourNewsApp && window.yourNewsApp.aiEngine) {
                            const stats = window.yourNewsApp.aiEngine.getStats();
                            aiStatusElement.textContent = `èªå½™: ${stats.vocabularySize}èª, ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯: ${stats.feedbackCount}ä»¶`;
                        } else {
                            aiStatusElement.textContent = 'æœªåˆæœŸåŒ–';
                        }
                    }
                    
                    // PWAçŠ¶æ…‹
                    const pwaStatusElement = document.getElementById('pwaStatus');
                    if (pwaStatusElement) {
                        const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
                        const isOnline = navigator.onLine;
                        const swSupported = 'serviceWorker' in navigator;
                        
                        pwaStatusElement.textContent = 
                            `${isStandalone ? 'ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆ' : 'ãƒ–ãƒ©ã‚¦ã‚¶ç‰ˆ'}, ${isOnline ? 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³' : 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³'}, SW: ${swSupported ? 'å¯¾å¿œ' : 'éå¯¾å¿œ'}`;
                    }
                    
                } catch (error) {
                    console.error('ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                }
            }
            
            async exportData() {
                try {
                    const exportData = await this.dataManager.exportData();
                    if (!exportData) {
                        this.showNotification('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'warning');
                        return;
                    }
                    
                    const dataStr = JSON.stringify(exportData, null, 2);
                    const blob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `your-news-backup_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    // æœ€çµ‚ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ—¥æ™‚æ›´æ–°
                    localStorage.setItem('yourNews_lastBackup', new Date().toISOString());
                    this.updateDataStats();
                    
                    this.showNotification('ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ', 'success');
                    
                } catch (error) {
                    console.error('ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error);
                    this.showNotification('ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
            
            async importData(file) {
                try {
                    if (!file || file.type !== 'application/json') {
                        this.showNotification('æœ‰åŠ¹ãªJSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„', 'warning');
                        return;
                    }
                    
                    const text = await file.text();
                    const importData = JSON.parse(text);
                    
                    if (!importData.version || !importData.articles) {
                        this.showNotification('ç„¡åŠ¹ãªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™', 'error');
                        return;
                    }
                    
                    this.confirmAction('ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ', 
                        `${importData.articles.length}ä»¶ã®è¨˜äº‹ã‚’å«ã‚€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚`, 
                        async () => {
                            const success = await this.dataManager.importData(importData);
                            if (success) {
                                this.showNotification('ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ', 'success');
                                this.updateDataStats();
                                this.updateSystemInfo();
                            } else {
                                this.showNotification('ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                            }
                        }
                    );
                    
                } catch (error) {
                    console.error('ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error);
                    this.showNotification('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
            
            async cleanOldData() {
                try {
                    const beforeStats = await this.getDataStats();
                    
                    // å¤ã„è¨˜äº‹å‰Šé™¤
                    await this.dataManager.cleanOldArticles();
                    
                    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
                    if ('caches' in window) {
                        const cacheNames = await caches.keys();
                        await Promise.all(
                            cacheNames.map(name => caches.delete(name))
                        );
                    }
                    
                    const afterStats = await this.getDataStats();
                    const deletedCount = beforeStats.totalArticles - afterStats.totalArticles;
                    
                    this.updateDataStats();
                    this.showNotification(`${deletedCount}ä»¶ã®å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`, 'success');
                    
                } catch (error) {
                    console.error('ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼:', error);
                    this.showNotification('ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
            
            async clearAllData() {
                try {
                    // å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
                    await this.dataManager.clearAllData();
                    
                    // AIé–¢é€£ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
                    localStorage.removeItem('yourNews_feedback');
                    localStorage.removeItem('yourNews_aiModel');
                    localStorage.removeItem('yourNews_vocabulary');
                    localStorage.removeItem('yourNews_idf');
                    localStorage.removeItem('yourNews_keywords');
                    localStorage.removeItem('yourNews_lastBackup');
                    
                    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
                    if ('caches' in window) {
                        const cacheNames = await caches.keys();
                        await Promise.all(
                            cacheNames.map(name => caches.delete(name))
                        );
                    }
                    
                    // è¨­å®šãƒªã‚»ãƒƒãƒˆ
                    this.currentSettings = { ...this.defaultSettings };
                    await this.dataManager.saveUserPreferences(this.currentSettings);
                    
                    this.updateUI();
                    this.updateDataStats();
                    this.updateSystemInfo();
                    
                    this.showNotification('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
                    
                } catch (error) {
                    console.error('å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
                    this.showNotification('ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
            
            async resetSettings() {
                try {
                    this.currentSettings = { ...this.defaultSettings };
                    await this.dataManager.saveUserPreferences(this.currentSettings);
                    
                    this.updateUI();
                    this.showNotification('è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ', 'success');
                    
                } catch (error) {
                    console.error('è¨­å®šãƒªã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼:', error);
                    this.showNotification('è¨­å®šãƒªã‚»ãƒƒãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
            
            async checkForUpdates() {
                try {
                    const checkBtn = document.getElementById('checkUpdateBtn');
                    if (checkBtn) {
                        checkBtn.disabled = true;
                        checkBtn.textContent = 'ç¢ºèªä¸­...';
                    }
                    
                    // Service Workeræ›´æ–°ç¢ºèª
                    if ('serviceWorker' in navigator) {
                        const registration = await navigator.serviceWorker.getRegistration();
                        if (registration) {
                            await registration.update();
                            this.showNotification('æ›´æ–°ã‚’ç¢ºèªã—ã¾ã—ãŸ', 'info');
                        } else {
                            this.showNotification('Service WorkerãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'warning');
                        }
                    } else {
                        this.showNotification('æ›´æ–°æ©Ÿèƒ½ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“', 'warning');
                    }
                    
                } catch (error) {
                    console.error('æ›´æ–°ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
                    this.showNotification('æ›´æ–°ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                } finally {
                    const checkBtn = document.getElementById('checkUpdateBtn');
                    if (checkBtn) {
                        checkBtn.disabled = false;
                        checkBtn.textContent = 'æ›´æ–°ç¢ºèª';
                    }
                }
            }
            
            async getDataStats() {
                try {
                    const articles = await this.dataManager.loadArticles();
                    const rssFeeds = await this.dataManager.loadRssFeeds();
                    
                    return {
                        totalArticles: articles.length,
                        totalRSS: rssFeeds.length
                    };
                } catch (error) {
                    return { totalArticles: 0, totalRSS: 0 };
                }
            }
            
            getLastBackupDate() {
                try {
                    const lastBackup = localStorage.getItem('yourNews_lastBackup');
                    if (lastBackup) {
                        return Utils.formatDate(lastBackup, 'relative');
                    }
                    return 'æœªå®Ÿè¡Œ';
                } catch (error) {
                    return 'ä¸æ˜';
                }
            }
            
            confirmAction(title, message, callback) {
                const dialog = document.getElementById('confirmDialog');
                const titleElement = document.getElementById('confirmTitle');
                const messageElement = document.getElementById('confirmMessage');
                const yesBtn = document.getElementById('confirmYes');
                
                if (dialog && titleElement && messageElement && yesBtn) {
                    titleElement.textContent = title;
                    messageElement.textContent = message;
                    
                    // æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤
                    const newYesBtn = yesBtn.cloneNode(true);
                    yesBtn.parentNode.replaceChild(newYesBtn, yesBtn);
                    
                    // æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
                    newYesBtn.addEventListener('click', () => {
                        this.hideConfirmDialog();
                        callback();
                    });
                    
                    this.showConfirmDialog();
                }
            }
            
            showConfirmDialog() {
                const dialog = document.getElementById('confirmDialog');
                if (dialog) {
                    dialog.classList.add('show');
                }
            }
            
            hideConfirmDialog() {
                const dialog = document.getElementById('confirmDialog');
                if (dialog) {
                    dialog.classList.remove('show');
                }
            }
            
            showNotification(message, type = 'info', duration = 5000) {
                // ã‚°ãƒ­ãƒ¼ãƒãƒ«é€šçŸ¥é–¢æ•°ã‚’åˆ©ç”¨
                if (window.yourNewsApp && window.yourNewsApp.showNotification) {
                    window.yourNewsApp.showNotification(message, type, duration);
                } else {
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                    console.log(`${type.toUpperCase()}: ${message}`);
                    alert(message);
                }
            }
        }
        
        // åˆæœŸåŒ–
        let settingsManager;
        
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                settingsManager = new SettingsManager();
                await settingsManager.initialize();
            } catch (error) {
                console.error('è¨­å®šç”»é¢åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
            }
        });
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å…¬é–‹ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
        window.settingsManager = () => settingsManager;
    </script>
</body>
</html>
