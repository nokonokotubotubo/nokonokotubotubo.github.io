<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨­å®š - ã‚ãªãŸã®ãƒ‹ãƒ¥ãƒ¼ã‚¹</title>
    
    <!-- ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆ -->
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/responsive.css">
    <link rel="stylesheet" href="../styles/components.css">
    <link rel="stylesheet" href="../styles/themes.css">
    
    <!-- TensorFlow.js CDNï¼ˆAIæ©Ÿèƒ½ç”¨ï¼‰ -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
    
    <style>
        .settings-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .settings-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            border-radius: 12px;
        }
        
        .settings-section {
            background: white;
            margin-bottom: 2rem;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .section-header {
            background: #f5f5f5;
            padding: 1.5rem;
            border-bottom: 1px solid #ddd;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .section-icon {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            background: #2196F3;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .section-title {
            margin: 0;
            font-size: 1.2rem;
            color: #333;
        }
        
        .section-description {
            margin: 0;
            font-size: 0.9rem;
            color: #666;
        }
        
        .setting-group {
            padding: 1.5rem;
        }
        
        .setting-item {
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }
        
        .setting-info {
            flex: 1;
        }
        
        .setting-label {
            margin: 0 0 0.5rem 0;
            font-weight: 600;
            color: #333;
        }
        
        .setting-help {
            margin: 0;
            font-size: 0.85rem;
            color: #666;
        }
        
        .setting-control {
            flex-shrink: 0;
        }
        
        .setting-toggle {
            position: relative;
            width: 50px;
            height: 24px;
            background: #ccc;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .setting-toggle.active {
            background: #2196F3;
        }
        
        .setting-toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }
        
        .setting-toggle.active::after {
            transform: translateX(26px);
        }
        
        .setting-select {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
        }
        
        .setting-input {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100px;
        }
        
        .keywords-input {
            width: 100%;
            min-height: 100px;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            resize: vertical;
        }
        
        .keywords-help {
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: #999;
        }
        
        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }
        
        .setting-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
        }
        
        .btn-primary {
            background: #2196F3;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1976D2;
        }
        
        .btn-success {
            background: #4CAF50;
            color: white;
        }
        
        .btn-success:hover {
            background: #45a049;
        }
        
        .btn-secondary {
            background: #9E9E9E;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #757575;
        }
        
        .btn-danger {
            background: #f44336;
            color: white;
        }
        
        .btn-danger:hover {
            background: #d32f2f;
        }
        
        .system-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 6px;
            margin-top: 1rem;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .navigation-buttons {
            text-align: center;
            margin-top: 2rem;
            display: flex;
            gap: 1rem;
            justify-content: center;
        }
        
        .nav-btn {
            padding: 0.75rem 1.5rem;
            background: #2196F3;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover {
            background: #1976D2;
            transform: translateY(-1px);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 1rem;
            border-radius: 6px;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        
        .notification.success {
            background: #4CAF50;
        }
        
        .notification.error {
            background: #f44336;
        }
        
        .notification.warning {
            background: #FF9800;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .confirmation-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }
        
        .dialog-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }
        
        .dialog-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            justify-content: center;
        }
        
        @media (max-width: 768px) {
            .settings-container {
                padding: 1rem;
            }
            
            .setting-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .navigation-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="settings-container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="settings-header">
            <h1>âš™ï¸ è¨­å®š</h1>
            <p>ã‚ãªãŸã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚¢ãƒ—ãƒªã®è¨­å®šã‚’ç®¡ç†ã—ã¾ã™</p>
        </div>
        
        <!-- RSSè¨­å®š -->
        <section class="settings-section">
            <div class="section-header">
                <span class="section-icon">ğŸ“¡</span>
                <div>
                    <h2 class="section-title">RSSè¨­å®š</h2>
                    <p class="section-description">RSSå–å¾—ã«é–¢ã™ã‚‹è¨­å®šã‚’è¡Œã„ã¾ã™</p>
                </div>
            </div>
            
            <div class="setting-group">
                <div class="setting-item">
                    <div class="setting-info">
                        <h3 class="setting-label">è‡ªå‹•æ›´æ–°</h3>
                        <p class="setting-help">å®šæœŸçš„ã«RSSãƒ•ã‚£ãƒ¼ãƒ‰ã‚’è‡ªå‹•å–å¾—ã—ã¾ã™</p>
                    </div>
                    <div class="setting-control">
                        <div class="setting-toggle" id="autoRefreshToggle"></div>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <h3 class="setting-label">æ›´æ–°é–“éš”</h3>
                        <p class="setting-help">è‡ªå‹•æ›´æ–°ã®é–“éš”ã‚’åˆ†å˜ä½ã§è¨­å®š</p>
                    </div>
                    <div class="setting-control">
                        <select class="setting-select" id="refreshInterval">
                            <option value="15">15åˆ†</option>
                            <option value="30">30åˆ†</option>
                            <option value="60">1æ™‚é–“</option>
                            <option value="180">3æ™‚é–“</option>
                            <option value="360">6æ™‚é–“</option>
                        </select>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <h3 class="setting-label">è¨˜äº‹è¡¨ç¤ºä»¶æ•°</h3>
                        <p class="setting-help">1ãƒšãƒ¼ã‚¸ã«è¡¨ç¤ºã™ã‚‹è¨˜äº‹æ•°</p>
                    </div>
                    <div class="setting-control">
                        <select class="setting-select" id="articlesPerPage">
                            <option value="25">25ä»¶</option>
                            <option value="50">50ä»¶</option>
                            <option value="100">100ä»¶</option>
                            <option value="200">200ä»¶</option>
                        </select>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- è¡¨ç¤ºè¨­å®š -->
        <section class="settings-section">
            <div class="section-header">
                <span class="section-icon">ğŸ¨</span>
                <div>
                    <h2 class="section-title">è¡¨ç¤ºè¨­å®š</h2>
                    <p class="section-description">UIãƒ»è¡¨ç¤ºã«é–¢ã™ã‚‹è¨­å®šã‚’è¡Œã„ã¾ã™</p>
                </div>
            </div>
            
            <div class="setting-group">
                <div class="setting-item">
                    <div class="setting-info">
                        <h3 class="setting-label">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚½ãƒ¼ãƒˆ</h3>
                        <p class="setting-help">è¨˜äº‹ä¸€è¦§ã®åˆæœŸã‚½ãƒ¼ãƒˆé †</p>
                    </div>
                    <div class="setting-control">
                        <select class="setting-select" id="defaultSort">
                            <option value="interest">AIèˆˆå‘³åº¦é †</option>
                            <option value="date">æ›´æ–°æ—¥æ™‚é †</option>
                            <option value="domain">ãƒ‰ãƒ¡ã‚¤ãƒ³é †</option>
                            <option value="keyword-match">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¸€è‡´åº¦é †</option>
                        </select>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <h3 class="setting-label">ç”»åƒè¡¨ç¤º</h3>
                        <p class="setting-help">è¨˜äº‹ç”»åƒã®è¡¨ç¤ºã‚’æœ‰åŠ¹ã«ã—ã¾ã™</p>
                    </div>
                    <div class="setting-control">
                        <div class="setting-toggle" id="showImagesToggle"></div>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <h3 class="setting-label">ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</h3>
                        <p class="setting-help">æš—ã„ãƒ†ãƒ¼ãƒã«åˆ‡ã‚Šæ›¿ãˆã¾ã™</p>
                    </div>
                    <div class="setting-control">
                        <div class="setting-toggle" id="darkModeToggle"></div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- AIãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¨­å®š -->
        <section class="settings-section">
            <div class="section-header">
                <span class="section-icon">ğŸ¤–</span>
                <div>
                    <h2 class="section-title">AIãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¨­å®š</h2>
                    <p class="section-description">AIå­¦ç¿’ã¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œå‡ºã®è¨­å®šã‚’è¡Œã„ã¾ã™</p>
                </div>
            </div>
            
            <div class="setting-group">
                <div class="setting-item">
                    <div class="setting-info">
                        <h3 class="setting-label">æ°—ã«ãªã‚‹ãƒ¯ãƒ¼ãƒ‰</h3>
                        <p class="setting-help">ã“ã®ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹è¨˜äº‹ã®èˆˆå‘³åº¦ãŒã‚¢ãƒƒãƒ—ã—ã¾ã™</p>
                        <textarea class="keywords-input" id="interestKeywords" 
                                  placeholder="ä¾‹: AI, æŠ€è¡“, ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°, ãƒ‹ãƒ¥ãƒ¼ã‚¹&#10;ï¼ˆ1è¡Œã«1ã¤ãšã¤å…¥åŠ›ï¼‰"></textarea>
                        <div class="keywords-help">
                            â€» 1è¡Œã«1ã¤ã®ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã€‚ãƒãƒƒãƒã—ãŸè¨˜äº‹ã¯+20ç‚¹ãƒœãƒ¼ãƒŠã‚¹
                        </div>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <h3 class="setting-label">NGãƒ¯ãƒ¼ãƒ‰</h3>
                        <p class="setting-help">ã“ã®ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹è¨˜äº‹ã¯è‡ªå‹•çš„ã«éè¡¨ç¤ºã«ãªã‚Šã¾ã™</p>
                        <textarea class="keywords-input" id="ngKeywords" 
                                  placeholder="ä¾‹: äº‹æ•…, äº‹ä»¶, æ”¿æ²»&#10;ï¼ˆ1è¡Œã«1ã¤ãšã¤å…¥åŠ›ï¼‰"></textarea>
                        <div class="keywords-help">
                            â€» 1è¡Œã«1ã¤ã®ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã€‚ãƒãƒƒãƒã—ãŸè¨˜äº‹ã¯å³åº§ã«éè¡¨ç¤º
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="setting-btn btn-primary" id="saveKeywordsBtn">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¨­å®šä¿å­˜</button>
                    <button class="setting-btn btn-success" id="retrainAIBtn">AIå†å­¦ç¿’å®Ÿè¡Œ</button>
                    <button class="setting-btn btn-secondary" id="resetAIBtn">AIå­¦ç¿’ãƒªã‚»ãƒƒãƒˆ</button>
                </div>
            </div>
        </section>
        
        <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç† -->
        <section class="settings-section">
            <div class="section-header">
                <span class="section-icon">ğŸ’¾</span>
                <div>
                    <h2 class="section-title">ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
                    <p class="section-description">è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã¨ã‚¢ãƒ—ãƒªãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†ã‚’è¡Œã„ã¾ã™</p>
                </div>
            </div>
            
            <div class="setting-group">
                <div class="action-buttons">
                    <button class="setting-btn btn-secondary" id="exportDataBtn">ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                    <button class="setting-btn btn-secondary" id="importDataBtn">ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                    <button class="setting-btn btn-danger" id="clearArticlesBtn">è¨˜äº‹ãƒ‡ãƒ¼ã‚¿å‰Šé™¤</button>
                    <button class="setting-btn btn-danger" id="clearAllDataBtn">å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤</button>
                </div>
                <input type="file" id="importFileInput" accept=".json" style="display: none;">
            </div>
        </section>
        
        <!-- ã‚·ã‚¹ãƒ†ãƒ æƒ…å ± -->
        <section class="settings-section">
            <div class="section-header">
                <span class="section-icon">â„¹ï¸</span>
                <div>
                    <h2 class="section-title">ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±</h2>
                    <p class="section-description">ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ã¨çµ±è¨ˆæƒ…å ±</p>
                </div>
            </div>
            
            <div class="setting-group">
                <div class="system-info" id="systemInfo">
                    <!-- ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                </div>
            </div>
        </section>
        
        <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <div class="navigation-buttons">
            <a href="../index.html" class="nav-btn">ğŸ“° è¨˜äº‹ä¸€è¦§ã«æˆ»ã‚‹</a>
            <a href="rss-manager.html" class="nav-btn">ğŸ“¡ RSSç®¡ç†</a>
            <a href="favorites.html" class="nav-btn">â­ ãŠæ°—ã«å…¥ã‚Š</a>
        </div>
    </div>
    
    <!-- å¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ -->
    <script src="../scripts/data-manager.js"></script>
    <script src="../scripts/ai-engine.js"></script>
    
    <script>
        // Settings Manager Classï¼ˆAIæ©Ÿèƒ½ã‚¨ãƒ©ãƒ¼å¯¾å¿œç‰ˆï¼‰
        class SettingsManager {
            constructor() {
                this.dataManager = null;
                this.aiEngine = null;
                this.currentSettings = {};
                this.aiInitialized = false;
            }
            
            async initialize() {
                try {
                    console.log('Settings ManageråˆæœŸåŒ–é–‹å§‹');
                    
                    // DataManageråˆæœŸåŒ–
                    this.dataManager = new DataManager();
                    await this.dataManager.initialize();
                    
                    // AIæ©Ÿèƒ½åˆæœŸåŒ–ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰
                    await this.initializeAI();
                    
                    // è¨­å®šãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
                    await this.loadSettings();
                    
                    // UIåˆæœŸåŒ–
                    this.setupEventListeners();
                    this.updateUI();
                    this.updateSystemInfo();
                    
                    console.log('Settings ManageråˆæœŸåŒ–å®Œäº†');
                    
                } catch (error) {
                    console.error('Settings ManageråˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                    this.showNotification('è¨­å®šç”»é¢ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
            
            // AIæ©Ÿèƒ½åˆæœŸåŒ–ï¼ˆã‚¨ãƒ©ãƒ¼å¯¾å¿œç‰ˆï¼‰
            async initializeAI() {
                try {
                    if (typeof tf === 'undefined') {
                        console.warn('TensorFlow.js not loaded, AIæ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–');
                        return false;
                    }
                    
                    if (typeof AIEngine === 'undefined') {
                        console.warn('AIEngine class not available, AIæ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–');
                        return false;
                    }
                    
                    // TensorFlow.jsåˆæœŸåŒ–
                    await tf.ready();
                    
                    // AIEngineåˆæœŸåŒ–
                    this.aiEngine = new AIEngine();
                    await this.aiEngine.initialize();
                    
                    this.aiInitialized = true;
                    console.log('âœ… Settings AIæ©Ÿèƒ½åˆæœŸåŒ–å®Œäº†');
                    
                    return true;
                    
                } catch (error) {
                    console.warn('âš ï¸ Settings AIåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                    console.log('AIæ©Ÿèƒ½ãªã—ã§è¨­å®šç”»é¢ã‚’ç¶™ç¶šã—ã¾ã™');
                    this.aiInitialized = false;
                    return false;
                }
            }
            
            async loadSettings() {
                try {
                    const defaultSettings = {
                        autoRefresh: false,
                        refreshInterval: 30,
                        articlesPerPage: 50,
                        defaultSort: 'interest',
                        showImages: true,
                        darkMode: false
                    };
                    
                    const savedSettings = await this.dataManager.loadUserPreferences();
                    this.currentSettings = { ...defaultSettings, ...savedSettings };
                    
                    console.log('è¨­å®šãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†:', this.currentSettings);
                    
                } catch (error) {
                    console.error('è¨­å®šãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                    this.currentSettings = {
                        autoRefresh: false,
                        refreshInterval: 30,
                        articlesPerPage: 50,
                        defaultSort: 'interest',
                        showImages: true,
                        darkMode: false
                    };
                }
            }
            
            async saveSettings() {
                try {
                    await this.dataManager.saveUserPreferences(this.currentSettings);
                    this.showNotification('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'success');
                } catch (error) {
                    console.error('è¨­å®šä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                    this.showNotification('è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
            
            setupEventListeners() {
                // ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒ
                this.setupToggle('autoRefreshToggle', 'autoRefresh');
                this.setupToggle('showImagesToggle', 'showImages');
                this.setupToggle('darkModeToggle', 'darkMode');
                
                // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹
                this.setupSelect('refreshInterval');
                this.setupSelect('articlesPerPage');
                this.setupSelect('defaultSort');
                
                // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¿å­˜
                const saveKeywordsBtn = document.getElementById('saveKeywordsBtn');
                if (saveKeywordsBtn) {
                    saveKeywordsBtn.addEventListener('click', async () => {
                        await this.saveKeywords();
                    });
                }
                
                // AIå†å­¦ç¿’ãƒœã‚¿ãƒ³ï¼ˆã‚¨ãƒ©ãƒ¼å¯¾å¿œç‰ˆï¼‰
                const retrainAIBtn = document.getElementById('retrainAIBtn');
                if (retrainAIBtn) {
                    retrainAIBtn.addEventListener('click', async () => {
                        if (!this.aiInitialized) {
                            this.showNotification('AIæ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“', 'warning');
                            return;
                        }
                        
                        this.confirmAction('AIå†å­¦ç¿’å®Ÿè¡Œ', 'AIå†å­¦ç¿’ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚å…¨è¨˜äº‹ã®èˆˆå‘³åº¦ãŒå†è¨ˆç®—ã•ã‚Œã¾ã™ã€‚', async () => {
                            try {
                                retrainAIBtn.disabled = true;
                                retrainAIBtn.textContent = 'ğŸ”„ å®Ÿè¡Œä¸­...';
                                
                                // AIå†å­¦ç¿’å‡¦ç†
                                await this.executeAIRetraining();
                                
                                this.showNotification('AIå†å­¦ç¿’ãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
                                this.updateSystemInfo();
                                
                            } catch (error) {
                                console.error('AIå†å­¦ç¿’ã‚¨ãƒ©ãƒ¼:', error);
                                this.showNotification('AIå†å­¦ç¿’ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                            } finally {
                                retrainAIBtn.disabled = false;
                                retrainAIBtn.textContent = 'AIå†å­¦ç¿’å®Ÿè¡Œ';
                            }
                        });
                    });
                }
                
                // AIå­¦ç¿’ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ï¼ˆã‚¨ãƒ©ãƒ¼å¯¾å¿œç‰ˆï¼‰
                const resetAIBtn = document.getElementById('resetAIBtn');
                if (resetAIBtn) {
                    resetAIBtn.addEventListener('click', () => {
                        if (!this.aiInitialized) {
                            this.showNotification('AIæ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“', 'warning');
                            return;
                        }
                        
                        this.confirmAction('AIå­¦ç¿’ãƒªã‚»ãƒƒãƒˆ', 'AIå­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¨­å®šã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã€‚ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚', async () => {
                            try {
                                await this.aiEngine.resetModel();
                                
                                // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›æ¬„ã‚‚ã‚¯ãƒªã‚¢
                                const interestInput = document.getElementById('interestKeywords');
                                const ngInput = document.getElementById('ngKeywords');
                                if (interestInput) interestInput.value = '';
                                if (ngInput) ngInput.value = '';
                                
                                this.showNotification('AIå­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ', 'success');
                                this.updateSystemInfo();
                                
                            } catch (error) {
                                console.error('AIå­¦ç¿’ãƒªã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼:', error);
                                this.showNotification('AIå­¦ç¿’ãƒªã‚»ãƒƒãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                            }
                        });
                    });
                }
                
                // ãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒœã‚¿ãƒ³
                this.setupDataManagementButtons();
            }
            
            setupToggle(toggleId, settingKey) {
                const toggle = document.getElementById(toggleId);
                if (toggle) {
                    toggle.addEventListener('click', () => {
                        this.currentSettings[settingKey] = !this.currentSettings[settingKey];
                        this.updateToggle(toggleId, this.currentSettings[settingKey]);
                        this.saveSettings();
                    });
                }
            }
            
            setupSelect(selectId) {
                const select = document.getElementById(selectId);
                if (select) {
                    select.addEventListener('change', (e) => {
                        this.currentSettings[selectId] = e.target.value;
                        this.saveSettings();
                    });
                }
            }
            
            updateUI() {
                // ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒæ›´æ–°
                this.updateToggle('autoRefreshToggle', this.currentSettings.autoRefresh);
                this.updateToggle('showImagesToggle', this.currentSettings.showImages);
                this.updateToggle('darkModeToggle', this.currentSettings.darkMode);
                
                // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹æ›´æ–°
                this.updateSelect('refreshInterval', this.currentSettings.refreshInterval);
                this.updateSelect('articlesPerPage', this.currentSettings.articlesPerPage);
                this.updateSelect('defaultSort', this.currentSettings.defaultSort);
                
                // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰èª­ã¿è¾¼ã¿
                this.loadKeywords();
                
                // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰é©ç”¨
                if (this.currentSettings.darkMode) {
                    document.body.classList.add('dark-mode');
                } else {
                    document.body.classList.remove('dark-mode');
                }
            }
            
            updateToggle(toggleId, value) {
                const toggle = document.getElementById(toggleId);
                if (toggle) {
                    if (value) {
                        toggle.classList.add('active');
                    } else {
                        toggle.classList.remove('active');
                    }
                }
            }
            
            updateSelect(selectId, value) {
                const select = document.getElementById(selectId);
                if (select) {
                    select.value = value;
                }
            }
            
            async loadKeywords() {
                try {
                    const keywords = await this.dataManager.loadData('yourNews_keywords');
                    if (keywords) {
                        const interestInput = document.getElementById('interestKeywords');
                        const ngInput = document.getElementById('ngKeywords');
                        
                        if (interestInput && keywords.interestWords) {
                            interestInput.value = keywords.interestWords.join('\n');
                        }
                        
                        if (ngInput && keywords.ngWords) {
                            ngInput.value = keywords.ngWords.join('\n');
                        }
                    }
                } catch (error) {
                    console.error('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                }
            }
            
            async saveKeywords() {
                try {
                    const interestInput = document.getElementById('interestKeywords');
                    const ngInput = document.getElementById('ngKeywords');
                    
                    const interestWords = interestInput.value
                        .split('\n')
                        .map(word => word.trim())
                        .filter(word => word.length > 0);
                    
                    const ngWords = ngInput.value
                        .split('\n')
                        .map(word => word.trim())
                        .filter(word => word.length > 0);
                    
                    const keywordsData = {
                        interestWords: interestWords,
                        ngWords: ngWords
                    };
                    
                    await this.dataManager.saveData('yourNews_keywords', keywordsData);
                    
                    // AIæ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½ãªå ´åˆã¯ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¨­å®šã‚’æ›´æ–°
                    if (this.aiInitialized && this.aiEngine) {
                        await this.aiEngine.updateKeywordSettings(keywordsData);
                        
                        // å…¨è¨˜äº‹ã®å†è©•ä¾¡å®Ÿè¡Œ
                        await this.recalculateAllArticles();
                    }
                    
                    this.showNotification('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'success');
                    
                } catch (error) {
                    console.error('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                    this.showNotification('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
            
            // AIå†å­¦ç¿’å®Ÿè¡Œï¼ˆè¨­å®šç”»é¢ç‰ˆï¼‰
            async executeAIRetraining() {
                if (!this.aiInitialized || !this.aiEngine) {
                    throw new Error('AIæ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }
                
                // å…¨è¨˜äº‹ã®èˆˆå‘³åº¦å†è¨ˆç®—
                await this.recalculateAllArticles();
                
                // å­¦ç¿’çµ±è¨ˆæ›´æ–°
                this.aiEngine.updateLearningStatistics();
                
                // AIå­¦ç¿’ãƒ‡ãƒ¼ã‚¿ä¿å­˜
                await this.aiEngine.saveAIData();
            }
            
            // å…¨è¨˜äº‹å†è¨ˆç®—ï¼ˆè¨­å®šç”»é¢ç‰ˆï¼‰
            async recalculateAllArticles() {
                if (!this.aiInitialized || !this.aiEngine) {
                    console.warn('AIæ©Ÿèƒ½ç„¡åŠ¹ã®ãŸã‚å†è¨ˆç®—ã‚’ã‚¹ã‚­ãƒƒãƒ—');
                    return;
                }
                
                const articles = await this.dataManager.loadArticles();
                const keywords = await this.dataManager.loadData('yourNews_keywords') || 
                               { interestWords: [], ngWords: [] };
                
                console.log(`ğŸ”„ å…¨è¨˜äº‹èˆˆå‘³åº¦å†è¨ˆç®—é–‹å§‹: ${articles.length}ä»¶`);
                
                // AIã‚¨ãƒ³ã‚¸ãƒ³ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¨­å®šã‚’æ›´æ–°
                await this.aiEngine.updateKeywordSettings(keywords);
                
                let updatedCount = 0;
                let ngArticleCount = 0;
                
                for (const article of articles) {
                    try {
                        const oldScore = article.interestScore || 50;
                        const newScore = await this.aiEngine.calculateInterestScore(article);
                        
                        // ã‚¹ã‚³ã‚¢æ›´æ–°
                        article.interestScore = newScore;
                        
                        // NGãƒ¯ãƒ¼ãƒ‰åˆ¤å®š
                        if (newScore === -1) {
                            article.ngDomain = true;
                            article.readStatus = 'read';
                            ngArticleCount++;
                        }
                        
                        // å¤‰æ›´ãŒã‚ã£ãŸå ´åˆã®ã¿ã‚«ã‚¦ãƒ³ãƒˆ
                        if (Math.abs(newScore - oldScore) > 1 || newScore === -1) {
                            updatedCount++;
                        }
                        
                    } catch (error) {
                        console.warn(`è¨˜äº‹ ${article.articleId} ã®å†è¨ˆç®—ã‚¨ãƒ©ãƒ¼:`, error);
                    }
                }
                
                // æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                if (updatedCount > 0) {
                    await this.dataManager.saveArticles(articles);
                    
                    let message = `${updatedCount}ä»¶ã®è¨˜äº‹ã‚¹ã‚³ã‚¢ã‚’æ›´æ–°ã—ã¾ã—ãŸ`;
                    if (ngArticleCount > 0) {
                        message += `ï¼ˆ${ngArticleCount}ä»¶ã‚’NGè¨˜äº‹ã¨ã—ã¦éè¡¨ç¤ºï¼‰`;
                    }
                    
                    this.showNotification(message, 'success');
                } else {
                    this.showNotification('è¨˜äº‹ã‚¹ã‚³ã‚¢ã«å¤‰æ›´ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ', 'info');
                }
                
                console.log(`âœ… å…¨è¨˜äº‹å†è¨ˆç®—å®Œäº†: ${updatedCount}ä»¶æ›´æ–°, ${ngArticleCount}ä»¶NGåŒ–`);
            }
            
            setupDataManagementButtons() {
                // ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                const exportBtn = document.getElementById('exportDataBtn');
                if (exportBtn) {
                    exportBtn.addEventListener('click', async () => {
                        await this.exportData();
                    });
                }
                
                // ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                const importBtn = document.getElementById('importDataBtn');
                const importInput = document.getElementById('importFileInput');
                if (importBtn && importInput) {
                    importBtn.addEventListener('click', () => {
                        importInput.click();
                    });
                    
                    importInput.addEventListener('change', async (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            await this.importData(file);
                        }
                    });
                }
                
                // è¨˜äº‹ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
                const clearArticlesBtn = document.getElementById('clearArticlesBtn');
                if (clearArticlesBtn) {
                    clearArticlesBtn.addEventListener('click', () => {
                        this.confirmAction('è¨˜äº‹ãƒ‡ãƒ¼ã‚¿å‰Šé™¤', 'å…¨ã¦ã®è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã€‚ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚', async () => {
                            try {
                                await this.dataManager.saveArticles([]);
                                this.showNotification('è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
                                this.updateSystemInfo();
                            } catch (error) {
                                console.error('è¨˜äº‹å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
                                this.showNotification('è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                            }
                        });
                    });
                }
                
                // å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
                const clearAllBtn = document.getElementById('clearAllDataBtn');
                if (clearAllBtn) {
                    clearAllBtn.addEventListener('click', () => {
                        this.confirmAction('å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤', 'è¨˜äº‹ã€è¨­å®šã€AIå­¦ç¿’ãƒ‡ãƒ¼ã‚¿ãªã©å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã€‚ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚', async () => {
                            try {
                                await this.dataManager.clearAllData();
                                if (this.aiInitialized && this.aiEngine) {
                                    await this.aiEngine.resetModel();
                                }
                                this.showNotification('å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
                                setTimeout(() => {
                                    location.reload();
                                }, 2000);
                            } catch (error) {
                                console.error('å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
                                this.showNotification('ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                            }
                        });
                    });
                }
            }
            
            async exportData() {
                try {
                    const exportData = await this.dataManager.exportData();
                    const dataStr = JSON.stringify(exportData, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(dataBlob);
                    link.download = `your-news-backup-${new Date().toISOString().split('T')[0]}.json`;
                    link.click();
                    
                    this.showNotification('ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ', 'success');
                    
                } catch (error) {
                    console.error('ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error);
                    this.showNotification('ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
            
            async importData(file) {
                try {
                    const text = await file.text();
                    const importData = JSON.parse(text);
                    
                    await this.dataManager.importData(importData);
                    
                    this.showNotification('ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ', 'success');
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                    
                } catch (error) {
                    console.error('ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error);
                    this.showNotification('ãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
            
            async updateSystemInfo() {
                try {
                    const articles = await this.dataManager.loadArticles();
                    const rssFeeds = await this.dataManager.loadRssFeeds();
                    
                    const unreadCount = articles.filter(a => a.readStatus !== 'read').length;
                    const favoritesCount = articles.filter(a => a.favorited).length;
                    
                    let aiInfo = 'AIæ©Ÿèƒ½ç„¡åŠ¹';
                    if (this.aiInitialized && this.aiEngine) {
                        const aiStats = this.aiEngine.getStats();
                        aiInfo = `èªå½™: ${aiStats.vocabularySize}, ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯: ${aiStats.feedbackCount}ä»¶`;
                    } else {
                        console.log('WARNING: AIæ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                    }
                    
                    const systemInfo = document.getElementById('systemInfo');
                    if (systemInfo) {
                        systemInfo.innerHTML = `
                            <div class="info-item">
                                <span>è¨˜äº‹æ•°:</span>
                                <span>${articles.length}ä»¶</span>
                            </div>
                            <div class="info-item">
                                <span>æœªèª­è¨˜äº‹:</span>
                                <span>${unreadCount}ä»¶</span>
                            </div>
                            <div class="info-item">
                                <span>ãŠæ°—ã«å…¥ã‚Š:</span>
                                <span>${favoritesCount}ä»¶</span>
                            </div>
                            <div class="info-item">
                                <span>RSSç™»éŒ²æ•°:</span>
                                <span>${rssFeeds.length}ä»¶</span>
                            </div>
                            <div class="info-item">
                                <span>AIå­¦ç¿’çŠ¶æ³:</span>
                                <span>${aiInfo}</span>
                            </div>
                            <div class="info-item">
                                <span>ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡:</span>
                                <span>${this.calculateStorageUsage()}</span>
                            </div>
                        `;
                    }
                    
                } catch (error) {
                    console.error('ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                }
            }
            
            calculateStorageUsage() {
                try {
                    let totalSize = 0;
                    for (let key in localStorage) {
                        if (localStorage.hasOwnProperty(key)) {
                            totalSize += localStorage[key].length;
                        }
                    }
                    
                    const sizeInKB = Math.round(totalSize / 1024);
                    if (sizeInKB < 1024) {
                        return `${sizeInKB} KB`;
                    } else {
                        return `${Math.round(sizeInKB / 1024 * 10) / 10} MB`;
                    }
                } catch (error) {
                    return 'è¨ˆç®—ä¸å¯';
                }
            }
            
            confirmAction(title, message, callback) {
                const dialog = document.createElement('div');
                dialog.className = 'confirmation-dialog';
                dialog.innerHTML = `
                    <div class="dialog-content">
                        <h3>${title}</h3>
                        <p>${message}</p>
                        <div class="dialog-buttons">
                            <button class="setting-btn btn-danger" onclick="this.closest('.confirmation-dialog').remove(); (${callback.toString()})()">å®Ÿè¡Œ</button>
                            <button class="setting-btn btn-secondary" onclick="this.closest('.confirmation-dialog').remove()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(dialog);
                
                // å®Ÿè¡Œãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’æ­£ã—ãè¨­å®š
                const executeBtn = dialog.querySelector('.btn-danger');
                const cancelBtn = dialog.querySelector('.btn-secondary');
                
                executeBtn.onclick = () => {
                    dialog.remove();
                    callback();
                };
                
                cancelBtn.onclick = () => {
                    dialog.remove();
                };
            }
            
            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 5000);
            }
        }
        
        // è¨­å®šç”»é¢åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const settingsManager = new SettingsManager();
                await settingsManager.initialize();
                
                // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
                window.settingsManager = settingsManager;
                
            } catch (error) {
                console.error('è¨­å®šç”»é¢åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                
                const errorDiv = document.createElement('div');
                errorDiv.innerHTML = `
                    <div style="
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: white;
                        padding: 2rem;
                        border-radius: 8px;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                        text-align: center;
                        z-index: 10000;
                        max-width: 400px;
                        width: 90%;
                    ">
                        <h3 style="color: #f44336; margin: 0 0 1rem 0;">è¨­å®šç”»é¢ã‚¨ãƒ©ãƒ¼</h3>
                        <p style="margin: 0 0 1rem 0;">è¨­å®šç”»é¢ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ</p>
                        <p style="margin: 0 0 1rem 0; font-size: 0.9rem; color: #666;">
                            ${error.message}
                        </p>
                        <button onclick="location.reload()" style="
                            background: #2196F3;
                            color: white;
                            border: none;
                            padding: 0.5rem 1rem;
                            border-radius: 4px;
                            cursor: pointer;
                        ">å†èª­ã¿è¾¼ã¿</button>
                    </div>
                `;
                document.body.appendChild(errorDiv);
            }
        });
    </script>
</body>
</html>
