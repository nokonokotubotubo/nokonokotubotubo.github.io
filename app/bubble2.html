<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bublerch デバッグ版</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #e3f2fd; }
        .test-section { margin: 20px 0; padding: 20px; background: white; border-radius: 10px; }
        button { padding: 10px 20px; margin: 10px; background: #0288d1; color: white; border: none; border-radius: 5px; }
        #status { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        #bubbleArea { background: rgba(255,255,255,0.3); min-height: 200px; border: 2px solid #81d4fa; border-radius: 10px; position: relative; }
        .bubble { position: absolute; background: #81d4fa; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Bublerch デバッグ版</h1>
    
    <div class="test-section">
        <h2>基本動作テスト</h2>
        <button id="testBtn1">テスト1: アラート表示</button>
        <button id="testBtn2">テスト2: コンソール出力</button>
        <button id="testBtn3">テスト3: DOM操作</button>
        <div id="status">待機中...</div>
    </div>

    <div class="test-section">
        <h2>シャボン玉機能テスト</h2>
        <input type="text" id="testInput" placeholder="テストキーワード" style="padding: 10px; margin: 10px;">
        <button id="testBubble">シャボン玉生成テスト</button>
        <div id="bubbleArea"></div>
    </div>

    <script>
        // デバッグ用ログ関数
        function debugLog(message) {
            console.log(`[DEBUG] ${message}`);
            const status = document.getElementById('status');
            if (status) {
                status.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            }
        }

        // 初期化確認
        debugLog('スクリプト開始');

        // DOM読み込み完了待機
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('DOM読み込み完了');
            initializeTests();
        });

        // 念のため、window.onloadでも初期化
        window.addEventListener('load', function() {
            debugLog('window.load完了');
            if (!window.testsInitialized) {
                initializeTests();
            }
        });

        function initializeTests() {
            debugLog('テスト初期化開始');
            
            try {
                // 基本動作テスト
                const testBtn1 = document.getElementById('testBtn1');
                const testBtn2 = document.getElementById('testBtn2');
                const testBtn3 = document.getElementById('testBtn3');
                const testBubble = document.getElementById('testBubble');

                if (!testBtn1 || !testBtn2 || !testBtn3 || !testBubble) {
                    throw new Error('必要な要素が見つかりません');
                }

                // イベントリスナー設定
                testBtn1.addEventListener('click', function() {
                    debugLog('テスト1実行');
                    alert('JavaScriptが正常に動作しています！');
                });

                testBtn2.addEventListener('click', function() {
                    debugLog('テスト2実行');
                    console.log('コンソール出力テスト成功');
                    console.table(['テスト', 'データ', '表示']);
                });

                testBtn3.addEventListener('click', function() {
                    debugLog('テスト3実行');
                    const status = document.getElementById('status');
                    status.style.background = '#c8e6c9';
                    status.textContent = 'DOM操作成功！';
                });

                testBubble.addEventListener('click', function() {
                    debugLog('シャボン玉テスト実行');
                    testBubbleGeneration();
                });

                window.testsInitialized = true;
                debugLog('テスト初期化完了');

            } catch (error) {
                debugLog(`初期化エラー: ${error.message}`);
                console.error('初期化エラー詳細:', error);
            }
        }

        function testBubbleGeneration() {
            try {
                const input = document.getElementById('testInput');
                const bubbleArea = document.getElementById('bubbleArea');
                
                if (!input || !bubbleArea) {
                    throw new Error('シャボン玉テスト用要素が見つかりません');
                }

                const keyword = input.value.trim() || 'テスト';
                
                // 既存のシャボン玉をクリア
                bubbleArea.innerHTML = '';
                
                // テスト用関連語
                const testWords = ['関連語1', '関連語2', '関連語3', '関連語4'];
                
                testWords.forEach((word, index) => {
                    setTimeout(() => {
                        createTestBubble(word, bubbleArea, index);
                    }, index * 300);
                });
                
                debugLog(`${keyword}のシャボン玉生成完了`);
                
            } catch (error) {
                debugLog(`シャボン玉テストエラー: ${error.message}`);
                console.error('シャボン玉テストエラー詳細:', error);
            }
        }

        function createTestBubble(word, container, index) {
            try {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                bubble.textContent = word;
                
                // サイズ設定
                const size = 60 + (index * 10);
                bubble.style.width = size + 'px';
                bubble.style.height = size + 'px';
                bubble.style.fontSize = '12px';
                
                // 位置設定（重複回避簡易版）
                const x = 50 + (index * 70);
                const y = 50 + (index % 2) * 80;
                bubble.style.left = x + 'px';
                bubble.style.top = y + 'px';
                
                // クリックイベント
                bubble.addEventListener('click', function() {
                    debugLog(`シャボン玉「${word}」クリック`);
                    bubble.style.animation = 'none';
                    bubble.style.transform = 'scale(0)';
                    bubble.style.transition = 'transform 0.3s';
                    
                    setTimeout(() => {
                        if (bubble.parentNode) {
                            bubble.remove();
                        }
                    }, 300);
                });
                
                container.appendChild(bubble);
                debugLog(`シャボン玉「${word}」生成完了`);
                
            } catch (error) {
                debugLog(`シャボン玉生成エラー: ${error.message}`);
                console.error('シャボン玉生成エラー詳細:', error);
            }
        }

        // グローバルエラーハンドリング
        window.addEventListener('error', function(event) {
            debugLog(`グローバルエラー: ${event.error.message}`);
            console.error('グローバルエラー詳細:', event.error);
        });

        debugLog('スクリプト読み込み完了');
    </script>
</body>
</html>
